<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.26">
<meta name="keywords" content="Java,JDK,Java source,Collection,ArrayList,Map,List,HashMap,ArrayDeque,Deque,Set,HashSet,LinkedList,Queue,TreeMap,TreeSet,Vector,Stack">
<meta name="author" content="Dç“œå“¥">
<meta name="copyright" content="Apache-2.0">
<meta property="og:title" content="java.lang.reflect.Proxy">
<title>JDK æºç åˆ†æ: 73. Proxy</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<link rel="stylesheet" href="assets/styles/asciidoctor.css">
<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css">
<link rel="stylesheet" href="assets/styles/rouge-github.css">
<style>
    a {
        text-decoration: none;
    }

    .img_bk {
        text-align: center;
    }

    p > code, strong > code, div.admonitionblock tr > td.content > code {
        color: #d14 !important;
        background-color: #f5f5f5 !important;
        border: 1px solid #e1e1e8;
        white-space: nowrap;
        border-radius: 3px;
    }
</style>
<link rel="stylesheet" href="assets/styles/asciidoctor-tabs.css">
<style>.toc-current{color:#d14;font-size:130%;font-weight: bold;} .toc-root{font-family: "Open Sans","DejaVu Sans",sans-serif;
                       font-size: 0.9em;} #content{display: flex; flex-direction: column; flex: 1 1 auto;}
             .nav-footer{text-align: center; margin-top: auto;}
             .nav-footer > p > a {white-space: nowrap;}</style>
</head>
<body id="java.lang.reflect.Proxy" class="book toc2 toc-left">
<div id="header">
<h1>JDK æºç åˆ†æ: 73. Proxy</h1>
<div class="details">
<span id="author" class="author">Dç“œå“¥</span><br>
<span id="email" class="email"><a href="https://www.diguage.com" class="bare">https://www.diguage.com</a></span><br>
<span id="revdate">2025-11-25</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<p><span class="toc-root"><a href="index.html">JDK æºç åˆ†æ</a></span></p><ul class="sectlevel1">
<li><a href="preface.html">å‰è¨€ï¼šJDK &amp; STL æºç åˆ†æè®¡åˆ’</a>
</li>
<li><a href="overview.html">1. é›†åˆç±»æ¦‚è¿°</a>
</li>
<li><a href="java.util.Iterator.html">2. è¿­ä»£å™¨ Iteratorã€ Enumerationã€ Spliterator ä¸ Iterable</a>
</li>
<li><a href="java.util.Collection.html">3. Collection</a>
</li>
<li><a href="java.util.AbstractCollection.html">4. AbstractCollection</a>
</li>
<li><a href="java.util.List.html">5. List</a>
</li>
<li><a href="java.util.AbstractList.html">6. AbstractList</a>
</li>
<li><a href="java.util.AbstractSequentialList.html">7. AbstractSequentialList</a>
</li>
<li><a href="java.util.ArrayList.html">8. <code>ArrayList</code></a>
</li>
<li><a href="java.util.LinkedList.html">9. LinkedList</a>
</li>
<li><a href="java.util.Stack.html">10. Stack</a>
</li>
<li><a href="java.util.Vector.html">11. Vector</a>
</li>
<li><a href="java.util.Set.html">12. Set</a>
</li>
<li><a href="java.util.AbstractSet.html">13. AbstractSet</a>
</li>
<li><a href="java.util.SortedSet.html">14. SortedSet</a>
</li>
<li><a href="java.util.NavigableSet.html">15. NavigableSet</a>
</li>
<li><a href="java.util.HashSet.html">16. HashSet</a>
</li>
<li><a href="java.util.TreeSet.html">17. TreeSet</a>
</li>
<li><a href="java.util.LinkedHashSet.html">18. LinkedHashSet</a>
</li>
<li><a href="java.util.BitSet.html">19. BitSet</a>
</li>
<li><a href="java.util.EnumSet.html">20. EnumSet</a>
</li>
<li><a href="java.util.Map.html">21. Map</a>
</li>
<li><a href="java.util.SortedMap.html">22. SortedMap</a>
</li>
<li><a href="java.util.NavigableMap.html">23. NavigableMap</a>
</li>
<li><a href="java.util.AbstractMap.html">24. AbstractMap</a>
</li>
<li><a href="java.util.HashMap.html">25. HashMap</a>
</li>
<li><a href="java.util.TreeMap.html">26. TreeMap</a>
</li>
<li><a href="java.util.LinkedHashMap.html">27. LinkedHashMap</a>
</li>
<li><a href="java.util.Dictionary.html">28. Dictionary</a>
</li>
<li><a href="java.util.Hashtable.html">29. Hashtable</a>
</li>
<li><a href="java.util.EnumMap.html">30. EnumMap</a>
</li>
<li><a href="java.util.WeakHashMap.html">31. WeakHashMap</a>
</li>
<li><a href="java.util.IdentityHashMap.html">32. IdentityHashMap</a>
</li>
<li><a href="java.util.Queue.html">33. Queue</a>
</li>
<li><a href="java.util.Deque.html">34. Deque</a>
</li>
<li><a href="java.util.AbstractQueue.html">35. AbstractQueue</a>
</li>
<li><a href="java.util.ArrayDeque.html">36. ArrayDeque</a>
</li>
<li><a href="java.util.PriorityQueue.html">37. PriorityQueue</a>
</li>
<li><a href="java.util.Array.html">38. å·¥å…·ç±» <code>Arrays</code></a>
</li>
<li><a href="java.util.Collection.html">39. å·¥å…·ç±» <code>Collections</code></a>
</li>
<li><a href="concurrent.overview.html">40. å¹¶å‘åº“æ¦‚è¿°</a>
</li>
<li><a href="java.lang.Thread.html">41. Thread</a>
</li>
<li><a href="java.util.concurrent.locks.LockSupport.html">42. LockSupport</a>
</li>
<li><a href="java.util.concurrent.locks.AbstractQueuedSynchronizer.html">43. AbstractQueuedSynchronizer</a>
</li>
<li><a href="java.util.concurrent.locks.ReentrantLock.html">44. ReentrantLock</a>
</li>
<li><a href="java.util.concurrent.locks.ReentrantReadWriteLock.html">45. ReentrantReadWriteLock</a>
</li>
<li><a href="java.util.concurrent.locks.StampedLock.html">46. StampedLock</a>
</li>
<li><a href="java.util.concurrent.Semaphore.html">47. Semaphore</a>
</li>
<li><a href="java.util.concurrent.CountDownLatch.html">48. CountDownLatch</a>
</li>
<li><a href="java.util.concurrent.CyclicBarrier.html">49. CyclicBarrier</a>
</li>
<li><a href="java.util.concurrent.Phaser.html">50. Phaser</a>
</li>
<li><a href="java.util.concurrent.Exchanger.html">51. Exchanger</a>
</li>
<li><a href="java.lang.ThreadLocal.html">52. ThreadLocal</a>
</li>
<li><a href="java.util.concurrent.atomic.AtomicInteger.html">53. AtomicInteger</a>
</li>
<li><a href="java.util.concurrent.atomic.LongAdder.html">54. LongAdder</a>
</li>
<li><a href="java.util.concurrent.Future.html">55. JUC åŒ…åŸºç¡€ç±»åˆ†æ</a>
</li>
<li><a href="java.util.concurrent.FutureTask.html">56. FutureTask</a>
</li>
<li><a href="java.util.concurrent.CompletableFuture.html">57. CompletableFuture</a>
</li>
<li><a href="java.util.concurrent.ThreadPoolExecutor.html">58. ThreadPoolExecutor æºç åˆ†æ</a>
</li>
<li><a href="java.util.concurrent.ForkJoinTask.html">59. ForkJoinTask</a>
</li>
<li><a href="java.util.concurrent.ForkJoinPool.html">60. ForkJoinPool</a>
</li>
<li><a href="java.util.concurrent.ConcurrentHashMap.html">61. <code>ConcurrentHashMap</code></a>
</li>
<li><a href="java.util.concurrent.ConcurrentSkipListMap.html">62. <code>ConcurrentSkipListMap</code></a>
</li>
<li><a href="java.util.concurrent.CopyOnWriteArrayList.html">63. CopyOnWriteArrayList</a>
</li>
<li><a href="java.util.concurrent.ConcurrentLinkedQueue.html">64. ConcurrentLinkedQueue</a>
</li>
<li><a href="java.util.concurrent.ArrayBlockingQueue.html">65. ArrayBlockingQueue</a>
</li>
<li><a href="java.util.concurrent.LinkedBlockingQueue.html">66. LinkedBlockingQueue</a>
</li>
<li><a href="java.util.concurrent.PriorityBlockingQueue.html">67. PriorityBlockingQueue</a>
</li>
<li><a href="java.util.concurrent.DelayQueue.html">68. DelayQueue</a>
</li>
<li><a href="java.util.concurrent.ScheduledThreadPoolExecutor.html">69. <code>ScheduledThreadPoolExecutor</code></a>
</li>
<li><a href="java.util.concurrent.Flow.html">70. <code>Flow</code></a>
</li>
<li><a href="java.lang.ClassLoader.html">71. ClassLoader</a>
</li>
<li><a href="java.lang.reflect.Field.html">72. Field</a>
</li>
<li><a href="java.lang.reflect.Proxy.html"><span class="toc-current">73. Proxy</span></a>
</li>
<li><a href="java.net.ServerSocket.html">74. ServerSocket</a>
</li>
<li><a href="java.util.ServiceLoader.html">75. <code>ServiceLoader</code></a>
</li>
<li><a href="java.lang.String.html">76. <code>String</code></a>
</li>
<li><a href="java.util.Date.html">77. <code>Date</code></a>
</li>
<li><a href="java.io.Serializable.html">78. <code>Serializable</code></a>
</li>
<li><a href="java.regex.Pattern.html">79. <code>Pattern</code></a>
</li>
<li><a href="_netty.html">80. Netty</a>
</li>
</ul>
</div>
</div>
<div id="content"><div class="sect2"><h3 id="_å‹æƒ…æ”¯æŒ">å‹æƒ…æ”¯æŒ</h3><div class="paragraph"><p>å¦‚æœæ‚¨è§‰å¾—è¿™ä¸ªç¬”è®°å¯¹æ‚¨æœ‰æ‰€å¸®åŠ©ï¼Œçœ‹åœ¨Dç“œå“¥ç è¿™ä¹ˆå¤šå­—çš„è¾›è‹¦ä¸Šï¼Œè¯·å‹æƒ…æ”¯æŒä¸€ä¸‹ï¼ŒDç“œå“¥æ„Ÿæ¿€ä¸å°½ï¼ŒğŸ˜œ</p></div><table class="tableblock frame-none grid-all stretch"><colgroup><col style="width: 50%;"><col style="width: 50%;"></colgroup><tbody><tr><td class="tableblock halign-center valign-top"><p class="tableblock"><span class="image"><img src="assets/images/alipay.png" alt="æ”¯ä»˜å®" width="85%" title="æ”¯ä»˜å®"></span></p></td><td class="tableblock halign-center valign-top"><p class="tableblock"><span class="image"><img src="assets/images/wxpay.jpg" alt="å¾®ä¿¡" width="85%" title="å¾®ä¿¡"></span></p></td></tr></tbody></table><div class="paragraph"><p>æœ‰äº›æ‰“èµçš„æœ‹å‹å¸Œæœ›å¯ä»¥åŠ ä¸ªå¥½å‹ï¼Œæ¬¢è¿å…³æ³¨D ç“œå“¥çš„å¾®ä¿¡å…¬ä¼—å·ï¼Œè¿™æ ·å°±å¯ä»¥é€šè¿‡å…¬ä¼—å·çš„å›å¤ç›´æ¥ç»™æˆ‘å‘ä¿¡æ¯ã€‚</p></div><div class="paragraph"><p><span class="image"><img src="assets/images/wx-jikerizhi.png" alt="wx jikerizhi" width="98%"></span></p></div><div class="admonitionblock tip"><table><tbody><tr><td class="icon"><i class="fa icon-tip" title="Tip"></i></td><td class="content"><strong>å…¬ä¼—å·çš„å¾®ä¿¡å·æ˜¯: <code>jikerizhi</code></strong>ã€‚<em>å› ä¸ºä¼—æ‰€å‘¨çŸ¥çš„åŸå› ï¼Œæœ‰æ—¶å›¾ç‰‡åŠ è½½ä¸å‡ºæ¥ã€‚ å¦‚æœå›¾ç‰‡åŠ è½½ä¸å‡ºæ¥å¯ä»¥ç›´æ¥é€šè¿‡æœç´¢å¾®ä¿¡å·æ¥æŸ¥æ‰¾æˆ‘çš„å…¬ä¼—å·ã€‚</em></td></tr></tbody></table></div></div>
<div class="sect1">
<h2 id="java.lang.reflect.Proxy"><a class="anchor" href="#java.lang.reflect.Proxy"></a>73. Proxy</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="java"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
</pre></td><td class="code"><pre><span class="kn">package</span> <span class="nn">com.diguage.truman.reflect</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.junit.jupiter.api.Test</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.lang.reflect.InvocationHandler</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.lang.reflect.Method</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.lang.reflect.Proxy</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Arrays</span><span class="o">;</span>

<span class="cm">/**
 * @author Dç“œå“¥, https://www.diguage.com/
 * @since 2020-04-02 09:37
 */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ProxyTest</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">LogProxy</span> <span class="kd">implements</span> <span class="nc">InvocationHandler</span> <span class="o">{</span>
        <span class="kd">private</span> <span class="nc">Object</span> <span class="n">realObject</span><span class="o">;</span>

        <span class="kd">public</span> <span class="nf">LogProxy</span><span class="o">(</span><span class="nc">Object</span> <span class="n">realObject</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">this</span><span class="o">.</span><span class="na">realObject</span> <span class="o">=</span> <span class="n">realObject</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="nc">Object</span> <span class="nf">invoke</span><span class="o">(</span><span class="nc">Object</span> <span class="n">proxy</span><span class="o">,</span> <span class="nc">Method</span> <span class="n">method</span><span class="o">,</span> <span class="nc">Object</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span>
                <span class="kd">throws</span> <span class="nc">Throwable</span> <span class="o">{</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Proxy: "</span> <span class="o">+</span> <span class="n">proxy</span><span class="o">.</span><span class="na">getClass</span><span class="o">().</span><span class="na">getName</span><span class="o">());</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"start to invoke: "</span>
                    <span class="o">+</span> <span class="n">realObject</span><span class="o">.</span><span class="na">getClass</span><span class="o">().</span><span class="na">getName</span><span class="o">()</span> <span class="o">+</span> <span class="s">"#"</span> <span class="o">+</span> <span class="n">method</span><span class="o">.</span><span class="na">getName</span><span class="o">()</span>
                    <span class="o">+</span> <span class="s">" args ="</span> <span class="o">+</span> <span class="nc">Arrays</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span><span class="n">args</span><span class="o">));</span>
            <span class="k">return</span> <span class="n">method</span><span class="o">.</span><span class="na">invoke</span><span class="o">(</span><span class="n">realObject</span><span class="o">,</span> <span class="n">args</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">interface</span> <span class="nc">UserGetService</span> <span class="o">{</span>
        <span class="nc">String</span> <span class="nf">getById</span><span class="o">(</span><span class="nc">Integer</span> <span class="n">id</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">static</span> <span class="kd">interface</span> <span class="nc">UserPostService</span> <span class="o">{</span>
        <span class="nc">String</span> <span class="nf">postUser</span><span class="o">(</span><span class="nc">String</span> <span class="n">name</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">UserGetServiceImpl</span> <span class="kd">implements</span> <span class="nc">UserGetService</span><span class="o">,</span> <span class="nc">UserPostService</span> <span class="o">{</span>
        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="nc">String</span> <span class="nf">getById</span><span class="o">(</span><span class="nc">Integer</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="s">"Dç“œå“¥-"</span> <span class="o">+</span> <span class="n">id</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="nc">String</span> <span class="nf">postUser</span><span class="o">(</span><span class="nc">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="s">"119-"</span> <span class="o">+</span> <span class="n">name</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// æ³¨æ„ï¼šè¿™é‡Œä¸èƒ½ä½¿ç”¨ JUnit æ¥è¿è¡Œï¼ŒJUnit ä¹Ÿæ˜¯é€šè¿‡ä»£ç†å¯åŠ¨çš„ï¼Œ</span>
        <span class="c1">// å…ˆäºæˆ‘ä»¬çš„æµ‹è¯•è¿è¡Œï¼Œå¯¼è‡´è®¾ç½®æ— æ•ˆã€‚</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">getProperties</span><span class="o">()</span>
                <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"jdk.proxy.ProxyGenerator.saveGeneratedFiles"</span><span class="o">,</span> <span class="s">"true"</span><span class="o">);</span>

        <span class="nc">UserGetServiceImpl</span> <span class="n">userService</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">UserGetServiceImpl</span><span class="o">();</span>
        <span class="nc">ClassLoader</span> <span class="n">classLoader</span> <span class="o">=</span> <span class="nc">UserGetService</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">getClassLoader</span><span class="o">();</span>
        <span class="nc">Class</span><span class="o">&lt;?&gt;[]</span> <span class="n">interfaces</span> <span class="o">=</span> <span class="nc">UserGetServiceImpl</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">getInterfaces</span><span class="o">();</span>
        <span class="nc">Object</span> <span class="n">proxy</span> <span class="o">=</span> <span class="nc">Proxy</span><span class="o">.</span><span class="na">newProxyInstance</span><span class="o">(</span><span class="n">classLoader</span><span class="o">,</span>
                <span class="n">interfaces</span><span class="o">,</span> <span class="k">new</span> <span class="nc">LogProxy</span><span class="o">(</span><span class="n">userService</span><span class="o">));</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"UserName = "</span>
                <span class="o">+</span> <span class="o">((</span><span class="nc">UserGetService</span><span class="o">)</span> <span class="n">proxy</span><span class="o">).</span><span class="na">getById</span><span class="o">(</span><span class="mi">119</span><span class="o">));</span>

        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"UserCode = "</span>
                <span class="o">+</span> <span class="o">((</span><span class="nc">UserPostService</span><span class="o">)</span> <span class="n">proxy</span><span class="o">).</span><span class="na">postUser</span><span class="o">(</span><span class="s">"diguage"</span><span class="o">));</span>

        <span class="nc">Object</span> <span class="n">proxy2</span> <span class="o">=</span> <span class="nc">Proxy</span><span class="o">.</span><span class="na">newProxyInstance</span><span class="o">(</span><span class="n">classLoader</span><span class="o">,</span>
                <span class="n">interfaces</span><span class="o">,</span> <span class="k">new</span> <span class="nc">LogProxy</span><span class="o">(</span><span class="n">userService</span><span class="o">));</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"UserName = "</span>
                <span class="o">+</span> <span class="o">((</span><span class="nc">UserGetService</span><span class="o">)</span> <span class="n">proxy2</span><span class="o">).</span><span class="na">getById</span><span class="o">(</span><span class="mi">119</span><span class="o">));</span>

        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"UserCode = "</span>
                <span class="o">+</span> <span class="o">((</span><span class="nc">UserPostService</span><span class="o">)</span> <span class="n">proxy2</span><span class="o">).</span><span class="na">postUser</span><span class="o">(</span><span class="s">"diguage"</span><span class="o">));</span>
    <span class="o">}</span>

    <span class="nd">@Test</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">testGetCallerMethodName</span><span class="o">()</span> <span class="o">{</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">getCallerMethod</span><span class="o">());</span>

        <span class="nc">String</span> <span class="n">methodName</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Object</span><span class="o">()</span> <span class="o">{</span>
        <span class="o">}.</span><span class="na">getClass</span><span class="o">().</span><span class="na">getEnclosingMethod</span><span class="o">().</span><span class="na">getName</span><span class="o">();</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">methodName</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">getCallerMethod</span><span class="o">()</span> <span class="o">{</span>
        <span class="nc">String</span> <span class="n">methodName</span> <span class="o">=</span> <span class="nc">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">()</span>
                <span class="o">.</span><span class="na">getStackTrace</span><span class="o">()[</span><span class="mi">2</span><span class="o">]</span> <span class="c1">// æ³¨æ„ä¸‹æ ‡å€¼</span>
                <span class="o">.</span><span class="na">getMethodName</span><span class="o">();</span>
        <span class="k">return</span> <span class="n">methodName</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="./assets/images/Proxy-newProxyInstance-sequence-diagram.png" alt="Proxy newProxyInstance sequence diagram">
</div>
</div>
<div class="paragraph">
<p>è·Ÿç€ä»£ç æ•´ä½“èµ°ä¸‹æ¥ï¼Œæ‰€è°“çš„"åŠ¨æ€ä»£ç†"ï¼Œå…¶å®æ˜¯åœ¨ <code>java.lang.reflect.ProxyGenerator.generateProxyClass(java.lang.String, java.lang.Class&lt;?&gt;[], int)</code> ä¸­ç”Ÿæˆäº†ä¸€ä¸ªå®ç°äº†æ¥å£çš„ä»£ç†ç±»ã€‚ç”Ÿæˆå­—èŠ‚ç çš„é€»è¾‘å°è£…åœ¨äº† <code>java.lang.reflect.ProxyGenerator.generateClassFile</code> ä¸­ï¼ŒæŒ‰ç…§å­—èŠ‚ç è§„èŒƒä¸­è§„å®šçš„æ ¼å¼ï¼ˆé­”æ•°ã€ç‰ˆæœ¬å·ã€å¸¸é‡æ± ã€è®¿é—®æ ‡è¯†ç¬¦ã€å½“å‰ç±»ç´¢å¼•ã€çˆ¶ç±»ç´¢å¼•ã€æ¥å£ç´¢å¼•ã€å­—æ®µè¡¨ã€æ–¹æ³•è¡¨ã€é™„åŠ å±æ€§ï¼‰ï¼Œä¸€ç‚¹ä¸€ç‚¹è¿½åŠ å†…å®¹ã€‚</p>
</div>
<div class="paragraph">
<p>ç”Ÿæˆå‡ºæ¥çš„ç±»ï¼Œç»§æ‰¿äº† <code>java.lang.reflect.Proxy</code>ï¼ŒåŒæ—¶å®ç°äº†å‚æ•°ä¸­ä¼ é€’çš„æ¥å£ã€‚åœ¨ç”Ÿæˆçš„ç±»ä¸­ï¼Œ</p>
</div>
<div class="ulist">
<ul>
<li>
<p>åŒ…å«ä¸€ä¸ªå‚æ•°ä¸º <code>InvocationHandler</code> çš„æ„é€ å‡½æ•°ï¼Œç”¨äºä¿å­˜ä»£ç†ä¸šåŠ¡çš„å®ç°ï¼›</p>
</li>
<li>
<p>æ¯ä¸€ä¸ªæ–¹æ³•éƒ½ç”¨ä¸€ä¸ªé™æ€ <code>Method</code> æ¥è¡¨ç¤ºï¼›</p>
</li>
<li>
<p>é™¤äº†æ¥å£ä¸­çš„æ–¹æ³•ï¼Œè¿˜ä¼šç”Ÿæˆ <code>boolean equals(Object obj)</code>ï¼Œ<code>int hashCode()</code> å’Œ <code>String toString()</code> ä¸‰ä¸ªæ–¹æ³•ã€‚</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>è°ƒç”¨æ—¶ï¼Œé€šè¿‡ <code>InvocationHandler</code> å¯¹è±¡çš„ <code>Object invoke(Object proxy, Method method, Object[] args)</code> æ–¹æ³•æ¥è°ƒèµ·ä»£ç†å’Œç›®æ ‡å¯¹è±¡çš„æ–¹æ³•ã€‚å…¶ä¸­ï¼Œè¿™é‡Œçš„ <code>Object proxy</code> å°±æ˜¯ç”Ÿæˆçš„ç±»æœ¬èº«çš„å¯¹è±¡ï¼›<code>Method method</code> å°±æ˜¯ä¸Šè¿°ç”Ÿæˆçš„é™æ€ <code>Method</code> å¯¹è±¡ï¼›<code>Object[] args</code> å°±æ˜¯å®é™…è°ƒç”¨çš„å‚æ•°ã€‚</p>
</div>
<div class="listingblock">
<div class="title">åç¼–è¯‘çš„ç¤ºä¾‹ç±»</div>
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="java"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
</pre></td><td class="code"><pre><span class="kn">package</span> <span class="nn">com.sun.proxy</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.diguage.proxy.UserService</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.lang.reflect.InvocationHandler</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.lang.reflect.Method</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.lang.reflect.Proxy</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.lang.reflect.UndeclaredThrowableException</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">final</span> <span class="kd">class</span> <span class="err">$</span><span class="nc">Proxy0</span> <span class="kd">extends</span> <span class="nc">Proxy</span> <span class="kd">implements</span> <span class="nc">UserService</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="nc">Method</span> <span class="n">m0</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="nc">Method</span> <span class="n">m1</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="nc">Method</span> <span class="n">m2</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="nc">Method</span> <span class="n">m3</span><span class="o">;</span>

    <span class="kd">public</span> <span class="n">$Proxy0</span><span class="o">(</span><span class="nc">InvocationHandler</span> <span class="n">var1</span><span class="o">)</span> <span class="kd">throws</span>  <span class="o">{</span>
        <span class="kd">super</span><span class="o">(</span><span class="n">var1</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">final</span> <span class="kt">int</span> <span class="nf">hashCode</span><span class="o">()</span> <span class="kd">throws</span>  <span class="o">{</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="k">return</span> <span class="o">(</span><span class="nc">Integer</span><span class="o">)</span><span class="kd">super</span><span class="o">.</span><span class="na">h</span><span class="o">.</span><span class="na">invoke</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="n">m0</span><span class="o">,</span> <span class="o">(</span><span class="nc">Object</span><span class="o">[])</span><span class="kc">null</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">RuntimeException</span> <span class="o">|</span> <span class="nc">Error</span> <span class="n">var2</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">throw</span> <span class="n">var2</span><span class="o">;</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Throwable</span> <span class="n">var3</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">UndeclaredThrowableException</span><span class="o">(</span><span class="n">var3</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">final</span> <span class="kt">boolean</span> <span class="nf">equals</span><span class="o">(</span><span class="nc">Object</span> <span class="n">var1</span><span class="o">)</span> <span class="kd">throws</span>  <span class="o">{</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="k">return</span> <span class="o">(</span><span class="nc">Boolean</span><span class="o">)</span><span class="kd">super</span><span class="o">.</span><span class="na">h</span><span class="o">.</span><span class="na">invoke</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="n">m1</span><span class="o">,</span> <span class="k">new</span> <span class="nc">Object</span><span class="o">[]{</span><span class="n">var1</span><span class="o">});</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">RuntimeException</span> <span class="o">|</span> <span class="nc">Error</span> <span class="n">var3</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">throw</span> <span class="n">var3</span><span class="o">;</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Throwable</span> <span class="n">var4</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">UndeclaredThrowableException</span><span class="o">(</span><span class="n">var4</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">final</span> <span class="nc">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="kd">throws</span>  <span class="o">{</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="k">return</span> <span class="o">(</span><span class="nc">String</span><span class="o">)</span><span class="kd">super</span><span class="o">.</span><span class="na">h</span><span class="o">.</span><span class="na">invoke</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="n">m2</span><span class="o">,</span> <span class="o">(</span><span class="nc">Object</span><span class="o">[])</span><span class="kc">null</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">RuntimeException</span> <span class="o">|</span> <span class="nc">Error</span> <span class="n">var2</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">throw</span> <span class="n">var2</span><span class="o">;</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Throwable</span> <span class="n">var3</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">UndeclaredThrowableException</span><span class="o">(</span><span class="n">var3</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">final</span> <span class="nc">String</span> <span class="nf">getById</span><span class="o">(</span><span class="nc">Integer</span> <span class="n">var1</span><span class="o">)</span> <span class="kd">throws</span>  <span class="o">{</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="k">return</span> <span class="o">(</span><span class="nc">String</span><span class="o">)</span><span class="kd">super</span><span class="o">.</span><span class="na">h</span><span class="o">.</span><span class="na">invoke</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="n">m3</span><span class="o">,</span> <span class="k">new</span> <span class="nc">Object</span><span class="o">[]{</span><span class="n">var1</span><span class="o">});</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">RuntimeException</span> <span class="o">|</span> <span class="nc">Error</span> <span class="n">var3</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">throw</span> <span class="n">var3</span><span class="o">;</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Throwable</span> <span class="n">var4</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">UndeclaredThrowableException</span><span class="o">(</span><span class="n">var4</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">static</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="n">m0</span> <span class="o">=</span> <span class="nc">Class</span><span class="o">.</span><span class="na">forName</span><span class="o">(</span><span class="s">"java.lang.Object"</span><span class="o">).</span><span class="na">getMethod</span><span class="o">(</span><span class="s">"hashCode"</span><span class="o">);</span><i class="conum" data-value="1"></i><b>(1)</b>
            <span class="n">m1</span> <span class="o">=</span> <span class="nc">Class</span><span class="o">.</span><span class="na">forName</span><span class="o">(</span><span class="s">"java.lang.Object"</span><span class="o">).</span><span class="na">getMethod</span><span class="o">(</span><span class="s">"equals"</span><span class="o">,</span>
                     <span class="nc">Class</span><span class="o">.</span><span class="na">forName</span><span class="o">(</span><span class="s">"java.lang.Object"</span><span class="o">));</span>
            <span class="n">m2</span> <span class="o">=</span> <span class="nc">Class</span><span class="o">.</span><span class="na">forName</span><span class="o">(</span><span class="s">"java.lang.Object"</span><span class="o">).</span><span class="na">getMethod</span><span class="o">(</span><span class="s">"toString"</span><span class="o">);</span>
            <span class="n">m3</span> <span class="o">=</span> <span class="nc">Class</span><span class="o">.</span><span class="na">forName</span><span class="o">(</span><span class="s">"com.diguage.proxy.UserService"</span><span class="o">)</span>
                     <span class="o">.</span><span class="na">getMethod</span><span class="o">(</span><span class="s">"getById"</span><span class="o">,</span> <span class="nc">Class</span><span class="o">.</span><span class="na">forName</span><span class="o">(</span><span class="s">"java.lang.Integer"</span><span class="o">));</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">NoSuchMethodException</span> <span class="n">var2</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">NoSuchMethodError</span><span class="o">(</span><span class="n">var2</span><span class="o">.</span><span class="na">getMessage</span><span class="o">());</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">ClassNotFoundException</span> <span class="n">var3</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">NoClassDefFoundError</span><span class="o">(</span><span class="n">var3</span><span class="o">.</span><span class="na">getMessage</span><span class="o">());</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>ä¸ºäº†æ’ç‰ˆï¼Œåšäº†å°è°ƒæ•´ã€‚</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>è¿˜æœ‰ä¸¤ç‚¹å€¼å¾—æ³¨æ„ï¼š</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>è¿è¡Œä»£ç†æ—¶ï¼Œå¦‚æœæƒ³è¦ä¿å­˜ç”Ÿæˆçš„ä»£ç†ç±»å­—èŠ‚ç ï¼Œéœ€è¦ç³»ç»Ÿå±æ€§ <code>jdk.proxy.ProxyGenerator.saveGeneratedFiles</code> è®¾ç½®ä¸º <code>true</code>ã€‚è¿™ä¸ªå±æ€§è¢«è§£æåèµ‹å€¼ç»™äº† <code>java.lang.reflect.ProxyGenerator.saveGeneratedFiles</code> å­—æ®µï¼Œè¿™ä¸ªå­—æ®µæ˜¯ <code>final</code> çš„ã€‚æ‰€ä»¥ï¼Œéœ€è¦åœ¨è¿è¡Œä»£ç ä¹‹åˆå°±è¦è®¾ç½®è¿™ä¸ªå±æ€§ã€‚æ‰€ä»¥ï¼Œæœ€å¥½ä½¿ç”¨ <code>main</code> æ–¹æ³•æ¥è¿è¡Œæµ‹è¯•ã€‚å¦åˆ™ï¼Œæœ‰å¯èƒ½è®¾ç½®å¤±æ•ˆã€‚</p>
</li>
<li>
<p>å¦‚æœä»£ç æ˜¯åœ¨ Maven é¡¹ç›®ä¸­è¿è¡Œï¼Œå¦‚æœæ¥å£éƒ½æ˜¯ <code>public</code> ä¿®é¥°ï¼Œç”Ÿæˆçš„ç±»ä¼šè¢«ä¿å­˜åœ¨ <code>${project.basedir}/com/sun/proxy/</code> ç›®å½•ä¸‹ï¼›å¦‚æœæœ‰æ¥å£æ˜¯åŒ…ç§æœ‰çš„ï¼Œåˆ™ç”Ÿæˆçš„ç±»ä¸ºæ¥å£æ‰€åœ¨çš„åŒ…ã€‚å¦‚æœç›®å½•ä¸å­˜åœ¨ï¼Œåˆ™ä¼šè‡ªåŠ¨åˆ›å»ºã€‚</p>
</li>
<li>
<p>æœ€å¤šå¯ä»¥æœ‰ <code>65535</code> ä¸ªæ¥å£ï¼›æœ‰ä¸¤ä¸ªè§£é‡Šï¼š</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>ä»£ç ä¸­æœ‰æ˜ç¡®é™åˆ¶ï¼šåœ¨ <code>java.lang.reflect.Proxy.ProxyBuilder.ProxyBuilder(java.lang.ClassLoader, java.util.List&lt;java.lang.Class&lt;?&gt;&gt;)</code> ä¸­æœ‰ <code>interfaces.size() &gt; 65535</code> çš„åˆ¤æ–­è¯­å¥ã€‚</p>
</li>
<li>
<p>å­—èŠ‚ç ä¸­ï¼Œå¯¹äºæ¥å£æ•°é‡æ˜¯ç”¨ä¸€ä¸ª <code>u2</code> å˜é‡è¡¨ç¤ºçš„ï¼Œè¯¥å˜é‡çš„æœ€å¤§å€¼æ˜¯ <code>2<sup>16</sup> - 1 = 65535</code>ã€‚</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>æ³¨è§£åº•å±‚ä¹Ÿæ˜¯åŸºäºåŠ¨æ€ä»£ç†å®ç°çš„ã€‚</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="java"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
</pre></td><td class="code"><pre><span class="kn">package</span> <span class="nn">com.diguage.truman.reflect</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.lang.annotation.Documented</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.lang.annotation.ElementType</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.lang.annotation.Retention</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.lang.annotation.RetentionPolicy</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.lang.annotation.Target</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Arrays</span><span class="o">;</span>

<span class="cm">/**
 * @author Dç“œå“¥, https://www.diguage.com/
 * @since 2020-04-08 23:34
 */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ProxyAnnoTest</span> <span class="o">{</span>
    <span class="nd">@Diguage</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">AnnoTest</span> <span class="o">{</span>
    <span class="o">}</span>

    <span class="nd">@Diguage</span><span class="o">(</span><span class="s">"https://github.com/diguage"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">AnnoTest2</span> <span class="o">{</span>
    <span class="o">}</span>

    <span class="nd">@Retention</span><span class="o">(</span><span class="nc">RetentionPolicy</span><span class="o">.</span><span class="na">RUNTIME</span><span class="o">)</span>
    <span class="nd">@Documented</span>
    <span class="nd">@Target</span><span class="o">(</span><span class="nc">ElementType</span><span class="o">.</span><span class="na">TYPE</span><span class="o">)</span>
    <span class="kd">static</span> <span class="nd">@interface</span> <span class="nc">Diguage</span> <span class="o">{</span>
        <span class="nc">String</span> <span class="nf">value</span><span class="o">()</span> <span class="k">default</span> <span class="s">"https://www.diguage.com"</span><span class="o">;</span>

        <span class="nc">String</span> <span class="nf">name</span><span class="o">()</span> <span class="k">default</span> <span class="s">"Dç“œå“¥"</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">getProperties</span><span class="o">()</span>
                <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"jdk.proxy.ProxyGenerator.saveGeneratedFiles"</span><span class="o">,</span> <span class="s">"true"</span><span class="o">);</span>

        <span class="nc">Class</span><span class="o">&lt;</span><span class="nc">AnnoTest</span><span class="o">&gt;</span> <span class="n">clazz</span> <span class="o">=</span> <span class="nc">AnnoTest</span><span class="o">.</span><span class="na">class</span><span class="o">;</span>
        <span class="nc">Diguage</span> <span class="n">annotation</span> <span class="o">=</span> <span class="n">clazz</span><span class="o">.</span><span class="na">getAnnotation</span><span class="o">(</span><span class="nc">Diguage</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">annotation</span> <span class="o">+</span> <span class="s">" : "</span> <span class="o">+</span> <span class="n">annotation</span><span class="o">.</span><span class="na">hashCode</span><span class="o">());</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Name: "</span> <span class="o">+</span> <span class="n">annotation</span><span class="o">.</span><span class="na">name</span><span class="o">());</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Value: "</span> <span class="o">+</span> <span class="n">annotation</span><span class="o">.</span><span class="na">value</span><span class="o">());</span>

        <span class="nc">Class</span><span class="o">&lt;?</span> <span class="kd">extends</span> <span class="nc">Diguage</span><span class="o">&gt;</span> <span class="n">annoClass</span> <span class="o">=</span> <span class="n">annotation</span><span class="o">.</span><span class="na">getClass</span><span class="o">();</span>


        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"\n----Class----"</span><span class="o">);</span>
        <span class="nc">String</span> <span class="n">className</span> <span class="o">=</span> <span class="n">annoClass</span><span class="o">.</span><span class="na">getName</span><span class="o">();</span>

        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"\n----SuperClass----"</span><span class="o">);</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">annoClass</span><span class="o">.</span><span class="na">getSuperclass</span><span class="o">().</span><span class="na">getName</span><span class="o">());</span>

        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"\n----Interfaces----"</span><span class="o">);</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="nc">Arrays</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span><span class="n">annoClass</span><span class="o">.</span><span class="na">getInterfaces</span><span class="o">()));</span>

        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"\n----Methods----"</span><span class="o">);</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="nc">Arrays</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span><span class="n">annoClass</span><span class="o">.</span><span class="na">getDeclaredMethods</span><span class="o">())</span>
                <span class="o">.</span><span class="na">replaceAll</span><span class="o">(</span><span class="s">", p"</span><span class="o">,</span> <span class="s">",\n p"</span><span class="o">));</span>

        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"\n\n=============="</span><span class="o">);</span>
        <span class="nc">Diguage</span> <span class="n">anno2</span> <span class="o">=</span> <span class="nc">AnnoTest2</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">getAnnotation</span><span class="o">(</span><span class="nc">Diguage</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">anno2</span> <span class="o">+</span> <span class="s">" : "</span> <span class="o">+</span> <span class="n">anno2</span><span class="o">.</span><span class="na">hashCode</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>æ¯ä¸ªæ³¨è§£éƒ½æ˜¯ä¸€ä¸ªæ¥å£å£°æ˜ï¼Œç„¶ååŸºäºè¿™ä¸ªæ¥å£ä½¿ç”¨åŠ¨æ€ä»£ç†ç”Ÿæˆä¸€ä¸ªä»£ç†ç±»ã€‚è€Œè¢«æ ‡æ³¨çš„æ³¨è§£ï¼Œå°±æ˜¯ä¸€ä¸ªä»£ç†ç±»çš„å®ä¾‹å¯¹è±¡ã€‚</p>
</div>
<div class="paragraph">
<p>ä»£ç†ç±»ä¸­çš„ <code>InvocationHandler</code> åˆ™æ˜¯ <code>AnnotationInvocationHandler</code> å®ä¾‹ï¼Œå®ä¾‹å˜é‡ <code>Map&lt;String, Object&gt; memberValues</code> ä¿å­˜ç€æ³¨è§£ä¸­æˆå‘˜å±æ€§çš„åç§°å’Œå€¼çš„æ˜ å°„ï¼Œæ³¨è§£æˆå‘˜å±æ€§çš„åç§°å®é™…ä¸Šå°±å¯¹åº”ç€æ¥å£ä¸­æŠ½è±¡æ–¹æ³•çš„åç§°ã€‚</p>
</div>
<div class="paragraph">
<p>æ€»ç»“</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>ç”¨åå°„ + å­—èŠ‚ç ç”ŸæˆæŠ€æœ¯æ¥ç”Ÿæˆå­—èŠ‚ç ï¼Œç„¶ååŠ è½½å‡ºæ¥ä»£ç†å¯¹è±¡ã€‚</p>
</li>
<li>
<p>ä»javaçš„è§’åº¦æ¥çœ‹è¿™æœ¬è¯­è¨€,å°±æ˜¯ä¸€ä¸ªåŠ¨æ€æ€§è¯­è¨€,ä¸€åˆ‡çš„åŠ¨æ€æ€§æ¥æºäºç±»çš„åŠ è½½æ–¹å¼,
åœ¨ç¨‹åºè¿è¡ŒæœŸé—´,å¯ä»¥å¾ˆå¤§ç¨‹åº¦ä¸Šä¿®æ”¹class</p>
</li>
<li>
<p><code>newProxyInstance(ClassLoader loader, Class&lt;?&gt;[] interfaces, InvocationHandler h)</code> å®é™…ä¸Šä»ç”Ÿæˆçš„ Class æ–‡ä»¶å’Œè¿™ä¸ªä¼ é€’å‚æ•°æ¥çœ‹ jdk Proxy ä»…ä»…å¯¹äºæ¥å£è¿›è¡Œä»£ç†, å³ç”Ÿæˆå®ç°äº†æ¥å£çš„ä¸´æ—¶ç±»å¯¹è±¡.</p>
</li>
<li>
<p>ç”±äºç”Ÿæˆçš„ç±»ï¼Œç»§æ‰¿äº† <code>java.lang.reflect.Proxy</code> ç±»ï¼Œè€Œ Java æ˜¯å•ç»§æ‰¿çš„ã€‚æ‰€ä»¥ï¼ŒåŠ¨æ€ä»£ç†åªèƒ½ä»£ç†ç”Ÿæˆæ¥å£ï¼Œä¸èƒ½ä»£ç†ç±»ã€‚</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>æ—¢ç„¶éƒ½ç”Ÿæˆä»£ç†ç±»äº†ï¼Œä¸ºä»€ä¹ˆä¸ç›´æ¥ç»§æ‰¿ä»£ç†ç±»å‘¢ï¼Ÿè¿™æ ·å°±å¯ä»¥å¯¹ä»£ç†ç±»æ‰€æœ‰çš„æ–¹æ³•è¿›è¡Œå¢å¼ºäº†ã€‚</p>
</div>
<div class="sect2">
<h3 id="_æ€è€ƒé¢˜_2"><a class="anchor" href="#_æ€è€ƒé¢˜_2"></a>73.1. æ€è€ƒé¢˜</h3>
<div class="paragraph">
<p>å¦‚ä½•è‡ªå·±å†™ä»£ç æ¥å®ç°ä»£ç ç”Ÿæˆã€åŠ è½½ç±»çš„åŠ¨æ€ä»£ç†ï¼Ÿ</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>å¦‚ä½•ç”Ÿæˆä»£ç†ç±»ï¼Ÿ-- å¯ä»¥è€ƒè™‘ç›´æ¥ç”Ÿæˆ Java ä»£ç ï¼Œç„¶åè°ƒç”¨ <code>JavaCompiler compiler = ToolProvider.getSystemJavaCompiler();</code> è·å–ç¼–è¯‘å™¨æ¥ç¼–è¯‘ Java ä»£ç ã€‚</p>
</li>
<li>
<p>å¦‚ä½•åŠ è½½ç±»ï¼Ÿ-- å¯ä»¥ä½¿ç”¨ <code>java.net.URLClassLoader</code> æ¥åŠ è½½å­—èŠ‚ç æ–‡ä»¶ã€‚</p>
</li>
<li>
<p>å¦‚ä½•æŠ½è±¡ä»£ç†åŠ¨ä½œï¼Ÿ</p>
</li>
<li>
<p>å¦‚ä½•åœ¨æ–¹æ³•å†…è·å–å‚æ•°åˆ—è¡¨ï¼Ÿ</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_cglib"><a class="anchor" href="#_cglib"></a>73.2. CGLIB</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>é€šè¿‡ç”Ÿæˆå­ç±»çš„æ–¹å¼æ¥äº§ç”Ÿä»£ç†ï¼ŒæŸäº›æƒ…å†µæ¯”åŠ¨æ€ä»£ç†è¿è¡Œé€Ÿåº¦è¦å¿«ä¸€äº›ã€‚</p>
</li>
<li>
<p>ä¸èƒ½ä»£ç† <code>final</code> ä¿®é¥°çš„ç±»ã€‚</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_å‚è€ƒèµ„æ–™_24"><a class="anchor" href="#_å‚è€ƒèµ„æ–™_24"></a>73.3. å‚è€ƒèµ„æ–™</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="https://www.cnblogs.com/gonjan-blog/p/6685611.html">javaåŠ¨æ€ä»£ç†å®ç°ä¸åŸç†è¯¦ç»†åˆ†æ - Gonjian - åšå®¢å›­</a></p>
</li>
<li>
<p><a href="https://www.fancylight.top/2019/05/22/java%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86/#%E4%BB%A3%E7%90%86%E7%B1%BB%E6%96%87%E4%BB%B6">javaåŠ¨æ€ä»£ç† | åšå®¢</a></p>
</li>
<li>
<p><a href="https://tech.meituan.com/2019/09/05/java-bytecode-enhancement.html">å­—èŠ‚ç å¢å¼ºæŠ€æœ¯æ¢ç´¢ - ç¾å›¢æŠ€æœ¯å›¢é˜Ÿ</a></p>
</li>
<li>
<p><a href="https://www.geeksforgeeks.org/get-name-of-current-method-being-executed-in-java/">Get name of current method being executed in Java - GeeksforGeeks</a></p>
</li>
<li>
<p><a href="http://www.throwable.club/2018/12/08/java-reflection-dynamic-proxy/">æ·±å…¥åˆ†æJavaåå°„(å››)-åŠ¨æ€ä»£ç† - Throwable&#8217;s Blog</a></p>
</li>
<li>
<p><a href="http://www.throwable.club/2018/12/16/cglib-dynamic-proxy-analyze/">CGLIBåŠ¨æ€ä»£ç†åŸç†åˆ†æ - Throwable&#8217;s Blog</a></p>
</li>
<li>
<p><a href="http://www.throwable.club/2020/03/16/annotation-implementation/">JDKä¸­æ³¨è§£çš„åº•å±‚å®ç° - Throwable&#8217;s Blog</a></p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="paragraph nav-footer">
<p>â†Â Previous:Â <a href="java.lang.reflect.Field.html">Field</a>Â | â†‘Â Up:Â <a href="index.html">JDK æºç åˆ†æ</a>Â | Next:Â <a href="java.net.ServerSocket.html">ServerSocket</a>Â â†’</p>
</div>
<script src="https://giscus.app/client.js" data-repo="diguage/jdk-source-analysis" data-repo-id="MDEwOlJlcG9zaXRvcnk3MjM5MzE5Mw==" data-category="General" data-category-id="MDE4OkRpc2N1c3Npb25DYXRlZ29yeTMyMDM2MDQx" data-mapping="og:title" data-strict="0" data-reactions-enabled="1" data-emit-metadata="1" data-input-position="top" data-theme="preferred_color_scheme" data-lang="zh-CN" data-loading="lazy" crossorigin="anonymous" async></script>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2025-11-25 13:40:54 UTC
</div>
</div>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  messageStyle: "none",
  tex2jax: {
    inlineMath: [["\\(", "\\)"]],
    displayMath: [["\\[", "\\]"]],
    ignoreClass: "nostem|nolatexmath"
  },
  asciimath2jax: {
    delimiters: [["\\$", "\\$"]],
    ignoreClass: "nostem|noasciimath"
  },
  TeX: { equationNumbers: { autoNumber: "none" } }
})
MathJax.Hub.Register.StartupHook("AsciiMath Jax Ready", function () {
  MathJax.InputJax.AsciiMath.postfilterHooks.Add(function (data, node) {
    if ((node = data.script.parentNode) && (node = node.parentNode) && node.classList.contains("stemblock")) {
      data.math.root.display = "block"
    }
    return data
  })
})
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/MathJax.js?config=TeX-MML-AM_CHTML"></script>
<script src="assets/scripts/asciidoctor-tabs.js"></script>
<script src="assets/scripts/scroll-toc.js"></script></body>
</html>