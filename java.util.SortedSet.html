<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.26">
<meta name="keywords" content="Java,JDK,Java source,Collection,ArrayList,Map,List,HashMap,ArrayDeque,Deque,Set,HashSet,LinkedList,Queue,TreeMap,TreeSet,Vector,Stack">
<meta name="author" content="Dç“œå“¥">
<meta name="copyright" content="Apache-2.0">
<meta property="og:title" content="java.util.SortedSet">
<title>JDK æºç åˆ†æ: 14. SortedSet</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<link rel="stylesheet" href="assets/styles/asciidoctor.css">
<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css">
<link rel="stylesheet" href="assets/styles/rouge-github.css">
<style>
    a {
        text-decoration: none;
    }

    .img_bk {
        text-align: center;
    }

    p > code, strong > code, div.admonitionblock tr > td.content > code {
        color: #d14 !important;
        background-color: #f5f5f5 !important;
        border: 1px solid #e1e1e8;
        white-space: nowrap;
        border-radius: 3px;
    }
</style>
<link rel="stylesheet" href="assets/styles/asciidoctor-tabs.css">
<style>.toc-current{color:#d14;font-size:130%;font-weight: bold;} .toc-root{font-family: "Open Sans","DejaVu Sans",sans-serif;
                       font-size: 0.9em;} #content{display: flex; flex-direction: column; flex: 1 1 auto;}
             .nav-footer{text-align: center; margin-top: auto;}
             .nav-footer > p > a {white-space: nowrap;}</style>
</head>
<body id="java.util.SortedSet" class="book toc2 toc-left">
<div id="header">
<h1>JDK æºç åˆ†æ: 14. SortedSet</h1>
<div class="details">
<span id="author" class="author">Dç“œå“¥</span><br>
<span id="email" class="email"><a href="https://www.diguage.com" class="bare">https://www.diguage.com</a></span><br>
<span id="revdate">2025-11-25</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<p><span class="toc-root"><a href="index.html">JDK æºç åˆ†æ</a></span></p><ul class="sectlevel1">
<li><a href="preface.html">å‰è¨€ï¼šJDK &amp; STL æºç åˆ†æè®¡åˆ’</a>
</li>
<li><a href="overview.html">1. é›†åˆç±»æ¦‚è¿°</a>
</li>
<li><a href="java.util.Iterator.html">2. è¿­ä»£å™¨ Iteratorã€ Enumerationã€ Spliterator ä¸ Iterable</a>
</li>
<li><a href="java.util.Collection.html">3. Collection</a>
</li>
<li><a href="java.util.AbstractCollection.html">4. AbstractCollection</a>
</li>
<li><a href="java.util.List.html">5. List</a>
</li>
<li><a href="java.util.AbstractList.html">6. AbstractList</a>
</li>
<li><a href="java.util.AbstractSequentialList.html">7. AbstractSequentialList</a>
</li>
<li><a href="java.util.ArrayList.html">8. <code>ArrayList</code></a>
</li>
<li><a href="java.util.LinkedList.html">9. LinkedList</a>
</li>
<li><a href="java.util.Stack.html">10. Stack</a>
</li>
<li><a href="java.util.Vector.html">11. Vector</a>
</li>
<li><a href="java.util.Set.html">12. Set</a>
</li>
<li><a href="java.util.AbstractSet.html">13. AbstractSet</a>
</li>
<li><a href="java.util.SortedSet.html"><span class="toc-current">14. SortedSet</span></a>
</li>
<li><a href="java.util.NavigableSet.html">15. NavigableSet</a>
</li>
<li><a href="java.util.HashSet.html">16. HashSet</a>
</li>
<li><a href="java.util.TreeSet.html">17. TreeSet</a>
</li>
<li><a href="java.util.LinkedHashSet.html">18. LinkedHashSet</a>
</li>
<li><a href="java.util.BitSet.html">19. BitSet</a>
</li>
<li><a href="java.util.EnumSet.html">20. EnumSet</a>
</li>
<li><a href="java.util.Map.html">21. Map</a>
</li>
<li><a href="java.util.SortedMap.html">22. SortedMap</a>
</li>
<li><a href="java.util.NavigableMap.html">23. NavigableMap</a>
</li>
<li><a href="java.util.AbstractMap.html">24. AbstractMap</a>
</li>
<li><a href="java.util.HashMap.html">25. HashMap</a>
</li>
<li><a href="java.util.TreeMap.html">26. TreeMap</a>
</li>
<li><a href="java.util.LinkedHashMap.html">27. LinkedHashMap</a>
</li>
<li><a href="java.util.Dictionary.html">28. Dictionary</a>
</li>
<li><a href="java.util.Hashtable.html">29. Hashtable</a>
</li>
<li><a href="java.util.EnumMap.html">30. EnumMap</a>
</li>
<li><a href="java.util.WeakHashMap.html">31. WeakHashMap</a>
</li>
<li><a href="java.util.IdentityHashMap.html">32. IdentityHashMap</a>
</li>
<li><a href="java.util.Queue.html">33. Queue</a>
</li>
<li><a href="java.util.Deque.html">34. Deque</a>
</li>
<li><a href="java.util.AbstractQueue.html">35. AbstractQueue</a>
</li>
<li><a href="java.util.ArrayDeque.html">36. ArrayDeque</a>
</li>
<li><a href="java.util.PriorityQueue.html">37. PriorityQueue</a>
</li>
<li><a href="java.util.Array.html">38. å·¥å…·ç±» <code>Arrays</code></a>
</li>
<li><a href="java.util.Collection.html">39. å·¥å…·ç±» <code>Collections</code></a>
</li>
<li><a href="concurrent.overview.html">40. å¹¶å‘åº“æ¦‚è¿°</a>
</li>
<li><a href="java.lang.Thread.html">41. Thread</a>
</li>
<li><a href="java.util.concurrent.locks.LockSupport.html">42. LockSupport</a>
</li>
<li><a href="java.util.concurrent.locks.AbstractQueuedSynchronizer.html">43. AbstractQueuedSynchronizer</a>
</li>
<li><a href="java.util.concurrent.locks.ReentrantLock.html">44. ReentrantLock</a>
</li>
<li><a href="java.util.concurrent.locks.ReentrantReadWriteLock.html">45. ReentrantReadWriteLock</a>
</li>
<li><a href="java.util.concurrent.locks.StampedLock.html">46. StampedLock</a>
</li>
<li><a href="java.util.concurrent.Semaphore.html">47. Semaphore</a>
</li>
<li><a href="java.util.concurrent.CountDownLatch.html">48. CountDownLatch</a>
</li>
<li><a href="java.util.concurrent.CyclicBarrier.html">49. CyclicBarrier</a>
</li>
<li><a href="java.util.concurrent.Phaser.html">50. Phaser</a>
</li>
<li><a href="java.util.concurrent.Exchanger.html">51. Exchanger</a>
</li>
<li><a href="java.lang.ThreadLocal.html">52. ThreadLocal</a>
</li>
<li><a href="java.util.concurrent.atomic.AtomicInteger.html">53. AtomicInteger</a>
</li>
<li><a href="java.util.concurrent.atomic.LongAdder.html">54. LongAdder</a>
</li>
<li><a href="java.util.concurrent.Future.html">55. JUC åŒ…åŸºç¡€ç±»åˆ†æ</a>
</li>
<li><a href="java.util.concurrent.FutureTask.html">56. FutureTask</a>
</li>
<li><a href="java.util.concurrent.CompletableFuture.html">57. CompletableFuture</a>
</li>
<li><a href="java.util.concurrent.ThreadPoolExecutor.html">58. ThreadPoolExecutor æºç åˆ†æ</a>
</li>
<li><a href="java.util.concurrent.ForkJoinTask.html">59. ForkJoinTask</a>
</li>
<li><a href="java.util.concurrent.ForkJoinPool.html">60. ForkJoinPool</a>
</li>
<li><a href="java.util.concurrent.ConcurrentHashMap.html">61. <code>ConcurrentHashMap</code></a>
</li>
<li><a href="java.util.concurrent.ConcurrentSkipListMap.html">62. <code>ConcurrentSkipListMap</code></a>
</li>
<li><a href="java.util.concurrent.CopyOnWriteArrayList.html">63. CopyOnWriteArrayList</a>
</li>
<li><a href="java.util.concurrent.ConcurrentLinkedQueue.html">64. ConcurrentLinkedQueue</a>
</li>
<li><a href="java.util.concurrent.ArrayBlockingQueue.html">65. ArrayBlockingQueue</a>
</li>
<li><a href="java.util.concurrent.LinkedBlockingQueue.html">66. LinkedBlockingQueue</a>
</li>
<li><a href="java.util.concurrent.PriorityBlockingQueue.html">67. PriorityBlockingQueue</a>
</li>
<li><a href="java.util.concurrent.DelayQueue.html">68. DelayQueue</a>
</li>
<li><a href="java.util.concurrent.ScheduledThreadPoolExecutor.html">69. <code>ScheduledThreadPoolExecutor</code></a>
</li>
<li><a href="java.util.concurrent.Flow.html">70. <code>Flow</code></a>
</li>
<li><a href="java.lang.ClassLoader.html">71. ClassLoader</a>
</li>
<li><a href="java.lang.reflect.Field.html">72. Field</a>
</li>
<li><a href="java.lang.reflect.Proxy.html">73. Proxy</a>
</li>
<li><a href="java.net.ServerSocket.html">74. ServerSocket</a>
</li>
<li><a href="java.util.ServiceLoader.html">75. <code>ServiceLoader</code></a>
</li>
<li><a href="java.lang.String.html">76. <code>String</code></a>
</li>
<li><a href="java.util.Date.html">77. <code>Date</code></a>
</li>
<li><a href="java.io.Serializable.html">78. <code>Serializable</code></a>
</li>
<li><a href="java.regex.Pattern.html">79. <code>Pattern</code></a>
</li>
<li><a href="_netty.html">80. Netty</a>
</li>
</ul>
</div>
</div>
<div id="content"><div class="sect2"><h3 id="_å‹æƒ…æ”¯æŒ">å‹æƒ…æ”¯æŒ</h3><div class="paragraph"><p>å¦‚æœæ‚¨è§‰å¾—è¿™ä¸ªç¬”è®°å¯¹æ‚¨æœ‰æ‰€å¸®åŠ©ï¼Œçœ‹åœ¨Dç“œå“¥ç è¿™ä¹ˆå¤šå­—çš„è¾›è‹¦ä¸Šï¼Œè¯·å‹æƒ…æ”¯æŒä¸€ä¸‹ï¼ŒDç“œå“¥æ„Ÿæ¿€ä¸å°½ï¼ŒğŸ˜œ</p></div><table class="tableblock frame-none grid-all stretch"><colgroup><col style="width: 50%;"><col style="width: 50%;"></colgroup><tbody><tr><td class="tableblock halign-center valign-top"><p class="tableblock"><span class="image"><img src="assets/images/alipay.png" alt="æ”¯ä»˜å®" width="85%" title="æ”¯ä»˜å®"></span></p></td><td class="tableblock halign-center valign-top"><p class="tableblock"><span class="image"><img src="assets/images/wxpay.jpg" alt="å¾®ä¿¡" width="85%" title="å¾®ä¿¡"></span></p></td></tr></tbody></table><div class="paragraph"><p>æœ‰äº›æ‰“èµçš„æœ‹å‹å¸Œæœ›å¯ä»¥åŠ ä¸ªå¥½å‹ï¼Œæ¬¢è¿å…³æ³¨D ç“œå“¥çš„å¾®ä¿¡å…¬ä¼—å·ï¼Œè¿™æ ·å°±å¯ä»¥é€šè¿‡å…¬ä¼—å·çš„å›å¤ç›´æ¥ç»™æˆ‘å‘ä¿¡æ¯ã€‚</p></div><div class="paragraph"><p><span class="image"><img src="assets/images/wx-jikerizhi.png" alt="wx jikerizhi" width="98%"></span></p></div><div class="admonitionblock tip"><table><tbody><tr><td class="icon"><i class="fa icon-tip" title="Tip"></i></td><td class="content"><strong>å…¬ä¼—å·çš„å¾®ä¿¡å·æ˜¯: <code>jikerizhi</code></strong>ã€‚<em>å› ä¸ºä¼—æ‰€å‘¨çŸ¥çš„åŸå› ï¼Œæœ‰æ—¶å›¾ç‰‡åŠ è½½ä¸å‡ºæ¥ã€‚ å¦‚æœå›¾ç‰‡åŠ è½½ä¸å‡ºæ¥å¯ä»¥ç›´æ¥é€šè¿‡æœç´¢å¾®ä¿¡å·æ¥æŸ¥æ‰¾æˆ‘çš„å…¬ä¼—å·ã€‚</em></td></tr></tbody></table></div></div>
<div class="sect1">
<h2 id="java.util.SortedSet"><a class="anchor" href="#java.util.SortedSet"></a>14. SortedSet</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_redis_çš„_skiplist"><a class="anchor" href="#_redis_çš„_skiplist"></a>14.1. Redis çš„ SkipList</h3>
<div class="paragraph">
<p>è·³è·ƒè¡¨æ˜¯ä¸€ç§æœ‰åºæ•°æ®ç»“æ„ï¼Œæ”¯æŒå¹³å‡ O(logN)ã€æœ€å O(N) å¤æ‚åº¦çš„èŠ‚ç‚¹æŸ¥æ‰¾ï¼›å¤§éƒ¨åˆ†æƒ…å†µæ•ˆç‡å¯ä»¥å’Œå¹³è¡¡æ ‘ç›¸åª²ç¾ï¼Œå®ç°å´æ¯”å¹³è¡¡æ ‘ç®€å•ã€‚</p>
</div>
<div class="paragraph">
<p>è·³è·ƒè¡¨å°±æ˜¯ Redis ä¸­æœ‰åºé›†åˆé”®çš„åº•å±‚å®ç°ä¹‹ä¸€ã€‚</p>
</div>
<div class="listingblock">
<div class="title">server.h</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="c"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
</pre></td><td class="code"><pre><span class="k">typedef</span> <span class="k">struct</span> <span class="n">zskiplistNode</span> <span class="p">{</span>
    <span class="n">sds</span> <span class="n">ele</span><span class="p">;</span>
    <span class="kt">double</span> <span class="n">score</span><span class="p">;</span>
    <span class="k">struct</span> <span class="n">zskiplistNode</span> <span class="o"><strong></span><span class="n">backward</span><span class="p">;</span>
    <span class="k">struct</span> <span class="n">zskiplistLevel</span> <span class="p">{</span>
        <span class="k">struct</span> <span class="n">zskiplistNode</span> <span class="o"></strong></span><span class="n">forward</span><span class="p">;</span>
        <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">span</span><span class="p">;</span>
    <span class="p">}</span> <span class="n">level</span><span class="p">[];</span>
<span class="p">}</span> <span class="n">zskiplistNode</span><span class="p">;</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="n">zskiplist</span> <span class="p">{</span>
    <span class="k">struct</span> <span class="n">zskiplistNode</span> <span class="o"><strong></span><span class="n">header</span><span class="p">,</span> <span class="o"></strong></span><span class="n">tail</span><span class="p">;</span>
    <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">length</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">level</span><span class="p">;</span>
<span class="p">}</span> <span class="n">zskiplist</span><span class="p">;</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="n">zset</span> <span class="p">{</span>
    <span class="n">dict</span> <span class="o"><strong></span><span class="n">dict</span><span class="p">;</span>
    <span class="n">zskiplist</span> <span class="o"></strong></span><span class="n">zsl</span><span class="p">;</span>
<span class="p">}</span> <span class="n">zset</span><span class="p">;</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>skiplistï¼Œé¡¾åæ€ä¹‰ï¼Œé¦–å…ˆå®ƒæ˜¯ä¸€ä¸ªlistã€‚å®é™…ä¸Šï¼Œå®ƒæ˜¯åœ¨æœ‰åºé“¾è¡¨çš„åŸºç¡€ä¸Šå‘å±•èµ·æ¥çš„ã€‚</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="./assets/images/redis/skiplist.png" alt="skiplist" width="95%">
</div>
</div>
<div class="paragraph">
<p>å½“æˆ‘ä»¬æƒ³æŸ¥æ‰¾æ•°æ®çš„æ—¶å€™ï¼Œå¯ä»¥å…ˆæ²¿ç€è·¨åº¦å¤§çš„é“¾è¿›è¡ŒæŸ¥æ‰¾ã€‚å½“ç¢°åˆ°æ¯”å¾…æŸ¥æ•°æ®å¤§çš„èŠ‚ç‚¹æ—¶ï¼Œå†å›åˆ°è·¨åº¦å°çš„é“¾è¡¨ä¸­è¿›è¡ŒæŸ¥æ‰¾ã€‚</p>
</div>
<div class="paragraph">
<p>skiplistæ­£æ˜¯å—è¿™ç§å¤šå±‚é“¾è¡¨çš„æƒ³æ³•çš„å¯å‘è€Œè®¾è®¡å‡ºæ¥çš„ã€‚æŒ‰ç…§ä¸Šé¢ç”Ÿæˆé“¾è¡¨çš„æ–¹å¼ï¼Œä¸Šé¢æ¯ä¸€å±‚é“¾è¡¨çš„èŠ‚ç‚¹ä¸ªæ•°ï¼Œæ˜¯ä¸‹é¢ä¸€å±‚çš„èŠ‚ç‚¹ä¸ªæ•°çš„ä¸€åŠï¼Œè¿™æ ·æŸ¥æ‰¾è¿‡ç¨‹å°±éå¸¸ç±»ä¼¼äºä¸€ä¸ªäºŒåˆ†æŸ¥æ‰¾ï¼Œä½¿å¾—æŸ¥æ‰¾çš„æ—¶é—´å¤æ‚åº¦å¯ä»¥é™ä½åˆ° O(logN)ã€‚ä½†æ˜¯ï¼Œå­˜åœ¨çš„ä¸€ä¸ªé—®é¢˜æ˜¯ï¼šå¦‚æœæ’å…¥æ–°èŠ‚ç‚¹åå°±ä¼šæ‰“ä¹±ä¸Šä¸‹ç›¸é‚»ä¸¤å±‚èŠ‚ç‚¹æ˜¯ 2:1 çš„å¯¹åº”å…³ç³»ã€‚å¦‚æœè¦ç»´æŒï¼Œåˆ™éœ€è¦è°ƒæ•´åé¢æ‰€æœ‰çš„èŠ‚ç‚¹ã€‚</p>
</div>
<div class="paragraph">
<p>skiplistä¸ºäº†é¿å…è¿™ä¸€é—®é¢˜ï¼Œå®ƒä¸è¦æ±‚ä¸Šä¸‹ç›¸é‚»ä¸¤å±‚é“¾è¡¨ä¹‹é—´çš„èŠ‚ç‚¹ä¸ªæ•°æœ‰ä¸¥æ ¼çš„å¯¹åº”å…³ç³»ï¼Œè€Œæ˜¯ä¸ºæ¯ä¸ªèŠ‚ç‚¹éšæœºå‡ºä¸€ä¸ªå±‚æ•°(level)ã€‚</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="./assets/images/redis/redis-skiplist-insertions.png" alt="redis skiplist insertions" width="95%">
</div>
</div>
<div class="paragraph">
<p>æ’å…¥æ“ä½œåªéœ€è¦ä¿®æ”¹æ’å…¥èŠ‚ç‚¹å‰åçš„æŒ‡é’ˆï¼Œè€Œä¸éœ€è¦å¯¹å¾ˆå¤šèŠ‚ç‚¹éƒ½è¿›è¡Œè°ƒæ•´ã€‚è¿™å°±é™ä½äº†æ’å…¥æ“ä½œçš„å¤æ‚åº¦ã€‚å®é™…ä¸Šï¼Œè¿™æ˜¯ skiplist çš„ä¸€ä¸ªå¾ˆé‡è¦çš„ç‰¹æ€§ï¼Œè¿™è®©å®ƒåœ¨æ’å…¥æ€§èƒ½ä¸Šæ˜æ˜¾ä¼˜äºå¹³è¡¡æ ‘çš„æ–¹æ¡ˆã€‚</p>
</div>
<div class="paragraph">
<p>skiplistï¼Œç¿»è¯‘æˆä¸­æ–‡ï¼Œå¯ä»¥ç¿»è¯‘æˆâ€œè·³è¡¨â€æˆ–â€œè·³è·ƒè¡¨â€ï¼ŒæŒ‡çš„å°±æ˜¯é™¤äº†æœ€ä¸‹é¢ç¬¬1å±‚é“¾è¡¨ä¹‹å¤–ï¼Œå®ƒä¼šäº§ç”Ÿè‹¥å¹²å±‚ç¨€ç–çš„é“¾è¡¨ï¼Œè¿™äº›é“¾è¡¨é‡Œé¢çš„æŒ‡é’ˆæ•…æ„è·³è¿‡äº†ä¸€äº›èŠ‚ç‚¹ï¼ˆè€Œä¸”è¶Šé«˜å±‚çš„é“¾è¡¨è·³è¿‡çš„èŠ‚ç‚¹è¶Šå¤šï¼‰ã€‚è¿™å°±ä½¿å¾—æˆ‘ä»¬åœ¨æŸ¥æ‰¾æ•°æ®çš„æ—¶å€™èƒ½å¤Ÿå…ˆåœ¨é«˜å±‚çš„é“¾è¡¨ä¸­è¿›è¡ŒæŸ¥æ‰¾ï¼Œç„¶åé€å±‚é™ä½ï¼Œæœ€ç»ˆé™åˆ°ç¬¬1å±‚é“¾è¡¨æ¥ç²¾ç¡®åœ°ç¡®å®šæ•°æ®ä½ç½®ã€‚åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬è·³è¿‡äº†ä¸€äº›èŠ‚ç‚¹ï¼Œä»è€Œä¹Ÿå°±åŠ å¿«äº†æŸ¥æ‰¾é€Ÿåº¦ã€‚</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="olist arabic">
<ol class="arabic">
<li>
<p>åœ¨ä¸­é—´æ’å…¥ä¸€ä¸ªæœ‰æ¯”è¾ƒé«˜ Level çš„èŠ‚ç‚¹ï¼Œå¦‚ä½•ç»´æŠ¤å‰é¢èŠ‚ç‚¹åˆ°è¿™ä¸ªèŠ‚ç‚¹çš„è¿™äº›é“¾æ¥ï¼Ÿ</p>
</li>
<li>
<p>åœ¨å¹³è¡¡æ ‘ç§ï¼Œå¦‚ä½•åšèŒƒå›´æŸ¥æ‰¾ï¼Ÿå…ˆç¡®å®šè¾¹ç•Œï¼Œç„¶åå…¶ä»–èŠ‚ç‚¹æ€ä¹ˆæŸ¥æ‰¾ï¼Ÿ</p>
</li>
</ol>
</div>
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="./assets/images/redis/redis_skiplist_example.png" alt="redis skiplist example" width="95%">
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>skiplist ä¸­ key å…è®¸é‡å¤ã€‚</p>
</li>
<li>
<p>åœ¨æ¯”è¾ƒæ—¶ï¼Œä¸ä»…æ¯”è¾ƒåˆ†æ•°ï¼ˆå³keyï¼‰ï¼Œè¿˜è¦æ¯”è¾ƒæ•°æ®è‡ªèº«ã€‚</p>
</li>
<li>
<p>ç¬¬ä¸€å±‚é“¾è¡¨æ˜¯åŒå‘é“¾è¡¨ï¼Œå¹¶ä¸”åå‘æŒ‡é’ˆåªæœ‰ä¸€ä¸ªã€‚</p>
</li>
<li>
<p>åœ¨ skiplist ä¸­å¯ä»¥å¾ˆæ–¹ä¾¿è®¡ç®—æ¯ä¸ªå…ƒç´ çš„æ’åã€‚</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Redis ä¸­çš„æœ‰åºé›†åˆï¼ˆsorted setï¼‰ï¼Œæ˜¯åœ¨ skiplist, dict å’Œ ziplist åŸºç¡€ä¸Šæ„å»ºèµ·æ¥çš„:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>å½“æ•°æ®è¾ƒå°‘æ—¶ï¼Œsorted setæ˜¯ç”±ä¸€ä¸ª ziplist æ¥å®ç°çš„ã€‚å…¶ä¸­é›†åˆå…ƒç´ æŒ‰ç…§åˆ†å€¼ä»å°åˆ°å¤§æ’åºã€‚</p>
</li>
<li>
<p>å½“æ•°æ®å¤šçš„æ—¶å€™ï¼Œsorted set æ˜¯ç”±ä¸€ä¸ªå« zset çš„æ•°æ®ç»“æ„æ¥å®ç°çš„ï¼Œè¿™ä¸ª zset åŒ…å«ä¸€ä¸ª dict + ä¸€ä¸ª skiplistã€‚dict ç”¨æ¥æŸ¥è¯¢æ•°æ®åˆ°åˆ†æ•°(score)çš„å¯¹åº”å…³ç³»ï¼Œè€Œ skiplist ç”¨æ¥æ ¹æ®åˆ†æ•°æŸ¥è¯¢æ•°æ®ï¼ˆå¯èƒ½æ˜¯èŒƒå›´æŸ¥æ‰¾ï¼‰ã€‚</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>è½¬æ¢çš„æ¡ä»¶æ˜¯ï¼š</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>æœ‰åºé›†åˆä¿å­˜çš„å…ƒç´ æ•°é‡å°äº 128 ä¸ªï¼›ï¼ˆé€šè¿‡å‚æ•° <code>zset-max-ziplist-entries</code> æ¥è°ƒèŠ‚ï¼Œé»˜è®¤ä¸º 128ã€‚ï¼‰</p>
</li>
<li>
<p>æœ‰åºé›†åˆä¿å­˜çš„æ‰€æœ‰å…ƒç´ æˆå‘˜çš„é•¿åº¦éƒ½è¦å°äº 64 ä¸ªå­—èŠ‚ï¼›ï¼ˆé€šè¿‡å‚æ•° <code>zset-max-ziplist-value</code> æ¥è°ƒèŠ‚ï¼Œé»˜è®¤ä¸º 64ã€‚ï¼‰</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>åœ¨ <code>t_zset.c/zsetConvert</code> ä¸­æ‰§è¡Œè½¬æ¢æ“ä½œã€‚</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
</pre></td><td class="code"><pre><span class="nv">$ </span>redis-cli <span class="nt">--raw</span>

127.0.0.1:6379&gt; ZADD NameRanking 1 <span class="s2">"Dç“œå“¥"</span>
1

127.0.0.1:6379&gt; ZADD NameRanking 2 <span class="s2">"https://www.diguage.com"</span>
1

127.0.0.1:6379&gt; ZADD NameRanking 3 <span class="s2">"https://github.com/diguage"</span>
1

127.0.0.1:6379&gt; ZRANGE NameRanking 0 <span class="nt">-1</span> WITHSCORES
Dç“œå“¥
1
https://www.diguage.com
2
https://github.com/diguage
3

127.0.0.1:6379&gt; TYPE NameRanking
zset

127.0.0.1:6379&gt; OBJECT encoding NameRanking
ziplist

127.0.0.1:6379&gt; ZADD NameRanking 4 <span class="s2">"1234567890123456789012345678901234567890123456789012345678901234"</span>
1

127.0.0.1:6379&gt; ZRANGE NameRanking 0 <span class="nt">-1</span> WITHSCORES
Dç“œå“¥
1
https://www.diguage.com
2
https://github.com/diguage
3
1234567890123456789012345678901234567890123456789012345678901234
4

127.0.0.1:6379&gt; OBJECT encoding NameRanking
ziplist

127.0.0.1:6379&gt; ZADD NameRanking 5 <span class="s2">"12345678901234567890123456789012345678901234567890123456789012345"</span>
1

127.0.0.1:6379&gt; ZRANGE NameRanking 0 <span class="nt">-1</span> WITHSCORES
Dç“œå“¥
1
https://www.diguage.com
2
https://github.com/diguage
3
1234567890123456789012345678901234567890123456789012345678901234
4
12345678901234567890123456789012345678901234567890123456789012345
5

127.0.0.1:6379&gt; OBJECT encoding NameRanking
skiplist

127.0.0.1:6379&gt; TYPE NameRanking
zset
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>åœ¨ JDK ä¸­ï¼Œä¹Ÿæœ‰ skiplist çš„å®ç°ï¼Œåœ¨ <code>ConcurrentSkipListMap</code> ä¸­ã€‚ä¸è¿‡ï¼Œå®ƒä¸æ˜¯ä½œä¸ºä¸€ä¸ªç‹¬ç«‹çš„ <code>Collection</code> æ¥å®ç°çš„ï¼Œè€Œæ˜¯ä½œä¸º <code>Map</code> çš„ä¸€éƒ¨åˆ†æ¥å®ç°çš„ã€‚</p>
</div>
</div>
<div class="sect2">
<h3 id="_å‚è€ƒèµ„æ–™_4"><a class="anchor" href="#_å‚è€ƒèµ„æ–™_4"></a>14.2. å‚è€ƒèµ„æ–™</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="https://www.diguage.com/post/redis-core-data-structure-2/" target="_blank" rel="noopener">Redis æ ¸å¿ƒæ•°æ®ç»“æ„ï¼ˆäºŒï¼‰ - "åœ°ç“œå“¥"åšå®¢ç½‘</a>&#8201;&#8212;&#8201;æœ¬æ–‡ä¸­çš„ Redis å†…å®¹æ˜¯è¿™ç¯‡æ–‡ç« çš„ä¸€ä¸ªæ‹·è´ã€‚è¯·ä»¥åŸæ–‡ä¸ºå‡†å¤‡ï¼Œæœ¬æ–‡å°½é‡åŒæ­¥æ›´æ–°ã€‚</p>
</li>
<li>
<p><a href="ftp://ftp.cs.umd.edu/pub/skipLists/skiplists.pdf">William Pughã€ŠSkip Lists: A Probabilistic Alternative to Balanced Treesã€‹</a></p>
</li>
<li>
<p><a href="https://mp.weixin.qq.com/s?__biz=MzA4NTg1MjM0Mg==&amp;mid=2657261425&amp;idx=1&amp;sn=d840079ea35875a8c8e02d9b3e44cf95&amp;scene=21#wechat_redirect">Redisä¸ºä»€ä¹ˆç”¨è·³è¡¨è€Œä¸ç”¨å¹³è¡¡æ ‘ï¼Ÿ- å¼ é“è•¾</a></p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="paragraph nav-footer">
<p>â†Â Previous:Â <a href="java.util.AbstractSet.html">AbstractSet</a>Â | â†‘Â Up:Â <a href="index.html">JDK æºç åˆ†æ</a>Â | Next:Â <a href="java.util.NavigableSet.html">NavigableSet</a>Â â†’</p>
</div>
<script src="https://giscus.app/client.js" data-repo="diguage/jdk-source-analysis" data-repo-id="MDEwOlJlcG9zaXRvcnk3MjM5MzE5Mw==" data-category="General" data-category-id="MDE4OkRpc2N1c3Npb25DYXRlZ29yeTMyMDM2MDQx" data-mapping="og:title" data-strict="0" data-reactions-enabled="1" data-emit-metadata="1" data-input-position="top" data-theme="preferred_color_scheme" data-lang="zh-CN" data-loading="lazy" crossorigin="anonymous" async></script>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2025-11-25 13:40:54 UTC
</div>
</div>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  messageStyle: "none",
  tex2jax: {
    inlineMath: [["\\(", "\\)"]],
    displayMath: [["\\[", "\\]"]],
    ignoreClass: "nostem|nolatexmath"
  },
  asciimath2jax: {
    delimiters: [["\\$", "\\$"]],
    ignoreClass: "nostem|noasciimath"
  },
  TeX: { equationNumbers: { autoNumber: "none" } }
})
MathJax.Hub.Register.StartupHook("AsciiMath Jax Ready", function () {
  MathJax.InputJax.AsciiMath.postfilterHooks.Add(function (data, node) {
    if ((node = data.script.parentNode) && (node = node.parentNode) && node.classList.contains("stemblock")) {
      data.math.root.display = "block"
    }
    return data
  })
})
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/MathJax.js?config=TeX-MML-AM_CHTML"></script>
<script src="assets/scripts/asciidoctor-tabs.js"></script>
<script src="assets/scripts/scroll-toc.js"></script></body>
</html>