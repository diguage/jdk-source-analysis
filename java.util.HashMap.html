<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.26">
<meta name="keywords" content="Java,JDK,Java source,Collection,ArrayList,Map,List,HashMap,ArrayDeque,Deque,Set,HashSet,LinkedList,Queue,TreeMap,TreeSet,Vector,Stack">
<meta name="author" content="Dç“œå“¥">
<meta name="copyright" content="Apache-2.0">
<meta property="og:title" content="java.util.HashMap">
<title>JDK æºç åˆ†æ: 25. HashMap</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<link rel="stylesheet" href="assets/styles/asciidoctor.css">
<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css">
<link rel="stylesheet" href="assets/styles/rouge-github.css">
<style>
    a {
        text-decoration: none;
    }

    .img_bk {
        text-align: center;
    }

    p > code, strong > code, div.admonitionblock tr > td.content > code {
        color: #d14 !important;
        background-color: #f5f5f5 !important;
        border: 1px solid #e1e1e8;
        white-space: nowrap;
        border-radius: 3px;
    }
</style>
<link rel="stylesheet" href="assets/styles/asciidoctor-tabs.css">
<style>.toc-current{color:#d14;font-size:130%;font-weight: bold;} .toc-root{font-family: "Open Sans","DejaVu Sans",sans-serif;
                       font-size: 0.9em;} #content{display: flex; flex-direction: column; flex: 1 1 auto;}
             .nav-footer{text-align: center; margin-top: auto;}
             .nav-footer > p > a {white-space: nowrap;}</style>
</head>
<body id="java.util.HashMap" class="book toc2 toc-left">
<div id="header">
<h1>JDK æºç åˆ†æ: 25. HashMap</h1>
<div class="details">
<span id="author" class="author">Dç“œå“¥</span><br>
<span id="email" class="email"><a href="https://www.diguage.com" class="bare">https://www.diguage.com</a></span><br>
<span id="revdate">2025-11-25</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<p><span class="toc-root"><a href="index.html">JDK æºç åˆ†æ</a></span></p><ul class="sectlevel1">
<li><a href="preface.html">å‰è¨€ï¼šJDK &amp; STL æºç åˆ†æè®¡åˆ’</a>
</li>
<li><a href="overview.html">1. é›†åˆç±»æ¦‚è¿°</a>
</li>
<li><a href="java.util.Iterator.html">2. è¿­ä»£å™¨ Iteratorã€ Enumerationã€ Spliterator ä¸ Iterable</a>
</li>
<li><a href="java.util.Collection.html">3. Collection</a>
</li>
<li><a href="java.util.AbstractCollection.html">4. AbstractCollection</a>
</li>
<li><a href="java.util.List.html">5. List</a>
</li>
<li><a href="java.util.AbstractList.html">6. AbstractList</a>
</li>
<li><a href="java.util.AbstractSequentialList.html">7. AbstractSequentialList</a>
</li>
<li><a href="java.util.ArrayList.html">8. <code>ArrayList</code></a>
</li>
<li><a href="java.util.LinkedList.html">9. LinkedList</a>
</li>
<li><a href="java.util.Stack.html">10. Stack</a>
</li>
<li><a href="java.util.Vector.html">11. Vector</a>
</li>
<li><a href="java.util.Set.html">12. Set</a>
</li>
<li><a href="java.util.AbstractSet.html">13. AbstractSet</a>
</li>
<li><a href="java.util.SortedSet.html">14. SortedSet</a>
</li>
<li><a href="java.util.NavigableSet.html">15. NavigableSet</a>
</li>
<li><a href="java.util.HashSet.html">16. HashSet</a>
</li>
<li><a href="java.util.TreeSet.html">17. TreeSet</a>
</li>
<li><a href="java.util.LinkedHashSet.html">18. LinkedHashSet</a>
</li>
<li><a href="java.util.BitSet.html">19. BitSet</a>
</li>
<li><a href="java.util.EnumSet.html">20. EnumSet</a>
</li>
<li><a href="java.util.Map.html">21. Map</a>
</li>
<li><a href="java.util.SortedMap.html">22. SortedMap</a>
</li>
<li><a href="java.util.NavigableMap.html">23. NavigableMap</a>
</li>
<li><a href="java.util.AbstractMap.html">24. AbstractMap</a>
</li>
<li><a href="java.util.HashMap.html"><span class="toc-current">25. HashMap</span></a>
</li>
<li><a href="java.util.TreeMap.html">26. TreeMap</a>
</li>
<li><a href="java.util.LinkedHashMap.html">27. LinkedHashMap</a>
</li>
<li><a href="java.util.Dictionary.html">28. Dictionary</a>
</li>
<li><a href="java.util.Hashtable.html">29. Hashtable</a>
</li>
<li><a href="java.util.EnumMap.html">30. EnumMap</a>
</li>
<li><a href="java.util.WeakHashMap.html">31. WeakHashMap</a>
</li>
<li><a href="java.util.IdentityHashMap.html">32. IdentityHashMap</a>
</li>
<li><a href="java.util.Queue.html">33. Queue</a>
</li>
<li><a href="java.util.Deque.html">34. Deque</a>
</li>
<li><a href="java.util.AbstractQueue.html">35. AbstractQueue</a>
</li>
<li><a href="java.util.ArrayDeque.html">36. ArrayDeque</a>
</li>
<li><a href="java.util.PriorityQueue.html">37. PriorityQueue</a>
</li>
<li><a href="java.util.Array.html">38. å·¥å…·ç±» <code>Arrays</code></a>
</li>
<li><a href="java.util.Collection.html">39. å·¥å…·ç±» <code>Collections</code></a>
</li>
<li><a href="concurrent.overview.html">40. å¹¶å‘åº“æ¦‚è¿°</a>
</li>
<li><a href="java.lang.Thread.html">41. Thread</a>
</li>
<li><a href="java.util.concurrent.locks.LockSupport.html">42. LockSupport</a>
</li>
<li><a href="java.util.concurrent.locks.AbstractQueuedSynchronizer.html">43. AbstractQueuedSynchronizer</a>
</li>
<li><a href="java.util.concurrent.locks.ReentrantLock.html">44. ReentrantLock</a>
</li>
<li><a href="java.util.concurrent.locks.ReentrantReadWriteLock.html">45. ReentrantReadWriteLock</a>
</li>
<li><a href="java.util.concurrent.locks.StampedLock.html">46. StampedLock</a>
</li>
<li><a href="java.util.concurrent.Semaphore.html">47. Semaphore</a>
</li>
<li><a href="java.util.concurrent.CountDownLatch.html">48. CountDownLatch</a>
</li>
<li><a href="java.util.concurrent.CyclicBarrier.html">49. CyclicBarrier</a>
</li>
<li><a href="java.util.concurrent.Phaser.html">50. Phaser</a>
</li>
<li><a href="java.util.concurrent.Exchanger.html">51. Exchanger</a>
</li>
<li><a href="java.lang.ThreadLocal.html">52. ThreadLocal</a>
</li>
<li><a href="java.util.concurrent.atomic.AtomicInteger.html">53. AtomicInteger</a>
</li>
<li><a href="java.util.concurrent.atomic.LongAdder.html">54. LongAdder</a>
</li>
<li><a href="java.util.concurrent.Future.html">55. JUC åŒ…åŸºç¡€ç±»åˆ†æ</a>
</li>
<li><a href="java.util.concurrent.FutureTask.html">56. FutureTask</a>
</li>
<li><a href="java.util.concurrent.CompletableFuture.html">57. CompletableFuture</a>
</li>
<li><a href="java.util.concurrent.ThreadPoolExecutor.html">58. ThreadPoolExecutor æºç åˆ†æ</a>
</li>
<li><a href="java.util.concurrent.ForkJoinTask.html">59. ForkJoinTask</a>
</li>
<li><a href="java.util.concurrent.ForkJoinPool.html">60. ForkJoinPool</a>
</li>
<li><a href="java.util.concurrent.ConcurrentHashMap.html">61. <code>ConcurrentHashMap</code></a>
</li>
<li><a href="java.util.concurrent.ConcurrentSkipListMap.html">62. <code>ConcurrentSkipListMap</code></a>
</li>
<li><a href="java.util.concurrent.CopyOnWriteArrayList.html">63. CopyOnWriteArrayList</a>
</li>
<li><a href="java.util.concurrent.ConcurrentLinkedQueue.html">64. ConcurrentLinkedQueue</a>
</li>
<li><a href="java.util.concurrent.ArrayBlockingQueue.html">65. ArrayBlockingQueue</a>
</li>
<li><a href="java.util.concurrent.LinkedBlockingQueue.html">66. LinkedBlockingQueue</a>
</li>
<li><a href="java.util.concurrent.PriorityBlockingQueue.html">67. PriorityBlockingQueue</a>
</li>
<li><a href="java.util.concurrent.DelayQueue.html">68. DelayQueue</a>
</li>
<li><a href="java.util.concurrent.ScheduledThreadPoolExecutor.html">69. <code>ScheduledThreadPoolExecutor</code></a>
</li>
<li><a href="java.util.concurrent.Flow.html">70. <code>Flow</code></a>
</li>
<li><a href="java.lang.ClassLoader.html">71. ClassLoader</a>
</li>
<li><a href="java.lang.reflect.Field.html">72. Field</a>
</li>
<li><a href="java.lang.reflect.Proxy.html">73. Proxy</a>
</li>
<li><a href="java.net.ServerSocket.html">74. ServerSocket</a>
</li>
<li><a href="java.util.ServiceLoader.html">75. <code>ServiceLoader</code></a>
</li>
<li><a href="java.lang.String.html">76. <code>String</code></a>
</li>
<li><a href="java.util.Date.html">77. <code>Date</code></a>
</li>
<li><a href="java.io.Serializable.html">78. <code>Serializable</code></a>
</li>
<li><a href="java.regex.Pattern.html">79. <code>Pattern</code></a>
</li>
<li><a href="_netty.html">80. Netty</a>
</li>
</ul>
</div>
</div>
<div id="content"><div class="sect2"><h3 id="_å‹æƒ…æ”¯æŒ">å‹æƒ…æ”¯æŒ</h3><div class="paragraph"><p>å¦‚æœæ‚¨è§‰å¾—è¿™ä¸ªç¬”è®°å¯¹æ‚¨æœ‰æ‰€å¸®åŠ©ï¼Œçœ‹åœ¨Dç“œå“¥ç è¿™ä¹ˆå¤šå­—çš„è¾›è‹¦ä¸Šï¼Œè¯·å‹æƒ…æ”¯æŒä¸€ä¸‹ï¼ŒDç“œå“¥æ„Ÿæ¿€ä¸å°½ï¼ŒğŸ˜œ</p></div><table class="tableblock frame-none grid-all stretch"><colgroup><col style="width: 50%;"><col style="width: 50%;"></colgroup><tbody><tr><td class="tableblock halign-center valign-top"><p class="tableblock"><span class="image"><img src="assets/images/alipay.png" alt="æ”¯ä»˜å®" width="85%" title="æ”¯ä»˜å®"></span></p></td><td class="tableblock halign-center valign-top"><p class="tableblock"><span class="image"><img src="assets/images/wxpay.jpg" alt="å¾®ä¿¡" width="85%" title="å¾®ä¿¡"></span></p></td></tr></tbody></table><div class="paragraph"><p>æœ‰äº›æ‰“èµçš„æœ‹å‹å¸Œæœ›å¯ä»¥åŠ ä¸ªå¥½å‹ï¼Œæ¬¢è¿å…³æ³¨D ç“œå“¥çš„å¾®ä¿¡å…¬ä¼—å·ï¼Œè¿™æ ·å°±å¯ä»¥é€šè¿‡å…¬ä¼—å·çš„å›å¤ç›´æ¥ç»™æˆ‘å‘ä¿¡æ¯ã€‚</p></div><div class="paragraph"><p><span class="image"><img src="assets/images/wx-jikerizhi.png" alt="wx jikerizhi" width="98%"></span></p></div><div class="admonitionblock tip"><table><tbody><tr><td class="icon"><i class="fa icon-tip" title="Tip"></i></td><td class="content"><strong>å…¬ä¼—å·çš„å¾®ä¿¡å·æ˜¯: <code>jikerizhi</code></strong>ã€‚<em>å› ä¸ºä¼—æ‰€å‘¨çŸ¥çš„åŸå› ï¼Œæœ‰æ—¶å›¾ç‰‡åŠ è½½ä¸å‡ºæ¥ã€‚ å¦‚æœå›¾ç‰‡åŠ è½½ä¸å‡ºæ¥å¯ä»¥ç›´æ¥é€šè¿‡æœç´¢å¾®ä¿¡å·æ¥æŸ¥æ‰¾æˆ‘çš„å…¬ä¼—å·ã€‚</em></td></tr></tbody></table></div></div>
<div class="sect1">
<h2 id="java.util.HashMap"><a class="anchor" href="#java.util.HashMap"></a>25. HashMap</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_hashmap_é—®é¢˜é›†"><a class="anchor" href="#_hashmap_é—®é¢˜é›†"></a>25.1. HashMap é—®é¢˜é›†</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>å¦‚æœåˆ¤æ–­æ˜¯å¦åˆ°è¾¾å®¹é‡é˜ˆå€¼ï¼Ÿ</p>
</li>
<li>
<p>ä¸ºä»€ä¹ˆ</p>
</li>
<li>
<p>éå†æŸ¥æ‰¾æ—¶ï¼Œå¦‚æœä¿è¯å¯ä»¥è®©çº¢é»‘æ ‘çš„èŠ‚ç‚¹ä¹Ÿå¯ä»¥ä½¿ç”¨nextæ–¹æ³•æ¥æŸ¥æ‰¾ï¼Ÿ</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_redis_ä¸­çš„å­—å…¸"><a class="anchor" href="#_redis_ä¸­çš„å­—å…¸"></a>25.2. Redis ä¸­çš„å­—å…¸</h3>
<div class="paragraph">
<p>Redis åº•å±‚ä¸­çš„å­—å…¸å°±æ˜¯ä¸€ä¸ªå…¸å‹çš„ Hash å®ç°ã€‚</p>
</div>
<div class="listingblock">
<div class="title">dict.h</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="c"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
</pre></td><td class="code"><pre><span class="k">typedef</span> <span class="k">struct</span> <span class="n">dictEntry</span> <span class="p">{</span> <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="kt">void</span> <span class="o"><strong></span><span class="n">key</span><span class="p">;</span>
    <span class="k">union</span> <span class="p">{</span>
        <span class="kt">void</span> <span class="o"></strong></span><span class="n">val</span><span class="p">;</span>
        <span class="kt">uint64_t</span> <span class="n">u64</span><span class="p">;</span>
        <span class="kt">int64_t</span> <span class="n">s64</span><span class="p">;</span>
        <span class="kt">double</span> <span class="n">d</span><span class="p">;</span>
    <span class="p">}</span> <span class="n">v</span><span class="p">;</span>
    <span class="k">struct</span> <span class="n">dictEntry</span> <span class="o"><strong></span><span class="n">next</span><span class="p">;</span>
<span class="p">}</span> <span class="n">dictEntry</span><span class="p">;</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="n">dictType</span> <span class="p">{</span>
    <span class="kt">uint64_t</span> <span class="p">(</span><span class="o"></strong></span><span class="n">hashFunction</span><span class="p">)(</span><span class="k">const</span> <span class="kt">void</span> <span class="o"><strong></span><span class="n">key</span><span class="p">);</span>
    <span class="kt">void</span> <span class="o"></strong></span><span class="p">(</span><span class="o"><strong></span><span class="n">keyDup</span><span class="p">)(</span><span class="kt">void</span> <span class="o"></strong></span><span class="n">privdata</span><span class="p">,</span> <span class="k">const</span> <span class="kt">void</span> <span class="o"><strong></span><span class="n">key</span><span class="p">);</span>
    <span class="kt">void</span> <span class="o"></strong></span><span class="p">(</span><span class="o"><strong></span><span class="n">valDup</span><span class="p">)(</span><span class="kt">void</span> <span class="o"></strong></span><span class="n">privdata</span><span class="p">,</span> <span class="k">const</span> <span class="kt">void</span> <span class="o"><strong></span><span class="n">obj</span><span class="p">);</span>
    <span class="kt">int</span> <span class="p">(</span><span class="o"></strong></span><span class="n">keyCompare</span><span class="p">)(</span><span class="kt">void</span> <span class="o"><strong></span><span class="n">privdata</span><span class="p">,</span> <span class="k">const</span> <span class="kt">void</span> <span class="o"></strong></span><span class="n">key1</span><span class="p">,</span> <span class="k">const</span> <span class="kt">void</span> <span class="o"><strong></span><span class="n">key2</span><span class="p">);</span>
    <span class="kt">void</span> <span class="p">(</span><span class="o"></strong></span><span class="n">keyDestructor</span><span class="p">)(</span><span class="kt">void</span> <span class="o"><strong></span><span class="n">privdata</span><span class="p">,</span> <span class="kt">void</span> <span class="o"></strong></span><span class="n">key</span><span class="p">);</span>
    <span class="kt">void</span> <span class="p">(</span><span class="o"><strong></span><span class="n">valDestructor</span><span class="p">)(</span><span class="kt">void</span> <span class="o"></strong></span><span class="n">privdata</span><span class="p">,</span> <span class="kt">void</span> <span class="o"><strong></span><span class="n">obj</span><span class="p">);</span>
<span class="p">}</span> <span class="n">dictType</span><span class="p">;</span>

<span class="cm">/</strong> This is our hash table structure. Every dictionary has two of this as we
 * implement incremental rehashing, for the old to the new table. <strong>/</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="n">dictht</span> <span class="p">{</span>
    <span class="n">dictEntry</span> <span class="o"></strong>*</span><span class="n">table</span><span class="p">;</span> <i class="conum" data-value="2"></i><b>(2)</b>
    <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">size</span><span class="p">;</span>
    <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">sizemask</span><span class="p">;</span>
    <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">used</span><span class="p">;</span>
<span class="p">}</span> <span class="n">dictht</span><span class="p">;</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="n">dict</span> <span class="p">{</span>
    <span class="n">dictType</span> <span class="o"><strong></span><span class="n">type</span><span class="p">;</span>
    <span class="kt">void</span> <span class="o"></strong></span><span class="n">privdata</span><span class="p">;</span>
    <span class="n">dictht</span> <span class="n">ht</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span> <i class="conum" data-value="3"></i><b>(3)</b>
    <span class="kt">long</span> <span class="n">rehashidx</span><span class="p">;</span> <span class="cm">/* rehashing not in progress if rehashidx == -1 <strong>/</span>
    <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">iterators</span><span class="p">;</span> <span class="cm">/</strong> number of iterators currently running */</span>
<span class="p">}</span> <span class="n">dict</span><span class="p">;</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>dictEntry</code> ä¿å­˜ä¸€ä¸ªé”®å€¼å¯¹ã€‚</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>table</code> å±æ€§æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œæ•°ç»„ä¸­æ¯ä¸ªå…ƒç´ éƒ½æ˜¯ä¸€ä¸ªæŒ‡å‘ <code>dictEntry</code> ç»“æ„çš„æŒ‡é’ˆã€‚</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>é€šå¸¸ä½¿ç”¨ <code>ht[0]</code>ï¼Œ<code>ht[1]</code> åœ¨ Rehash æ—¶æ‰ä¼šç”¨åˆ°ã€‚</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>æ·»åŠ æ–°å…ƒç´ æ—¶ï¼Œå’Œ Java ä¸€æ ·ï¼Œè®¡ç®— Key çš„å“ˆå¸Œå€¼ï¼Œç„¶åå†æ ¹æ®å“ˆå¸Œå€¼ä¸é•¿åº¦æ©ç ï¼ˆ<code>sizemask</code>ï¼‰ç›¸ä¸å¾—åˆ°æ•°ç»„ä¸‹æ ‡ã€‚</p>
</div>
<div class="paragraph">
<p>Redis åº•å±‚ä½¿ç”¨ <a href="https://en.wikipedia.org/wiki/MurmurHash" target="_blank" rel="noopener">MurmurHash2</a> ç®—æ³•æ¥è®¡ç®—é”®çš„å“ˆå¸Œå€¼ã€‚</p>
</div>
<div class="sect3">
<h4 id="_rehash_æ“ä½œ"><a class="anchor" href="#_rehash_æ“ä½œ"></a>25.2.1. Rehash æ“ä½œ</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>è®¡ç®—æ–°çš„æ•°ç»„é•¿åº¦</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>å¦‚æœæ˜¯æ‰©å®¹ï¼Œåˆ™ <code>used * 2</code>ï¼›</p>
</li>
<li>
<p>å¦‚æœæ˜¯ç¼©å®¹ï¼Œåˆ™æ˜¯ç¬¬ä¸€ä¸ªå¤§äºç­‰äº <code>used</code> çš„ 2<sup>n</sup>ã€‚&#8201;&#8212;&#8201;è¿™ç‚¹å’Œ Java ä¸åŒï¼Œ<code>HashMap</code> ä¸­æ²¡æœ‰è‡ªåŠ¨ç¼©å®¹çš„æœºåˆ¶ã€‚</p>
</li>
</ol>
</div>
</li>
<li>
<p>å°† <code>ht[0]</code> ä¸­çš„æ‰€æœ‰é”®å€¼å¯¹é‡æ–° Rehashï¼Œé‡æ–°è®¡ç®—å“ˆå¸Œå€¼å’Œç´¢å¼•å€¼ï¼Œæ”¾ç½®åˆ° <code>ht[1]</code> ä¸Šï¼›</p>
</li>
<li>
<p>è¿ç§»å®Œæˆåï¼Œå°† <code>ht[1]</code> è®¾ç½®ä¸º <code>ht[0]</code>ï¼Œä¸º <code>ht[1]</code> åˆ›å»ºä¸€ä¸ªç©ºç™½å“ˆå¸Œè¡¨ã€‚</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>è¿˜æœ‰å‡ ç‚¹éœ€è¦ç‰¹åˆ«æ³¨æ„ï¼š</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>æ ¹æ®æ˜¯å¦æ­£åœ¨æ‰§è¡Œ <code>BGSAVE</code> æˆ– <code>BGREADWRITEAOF</code> å‘½ä»¤ï¼Œä½¿ç”¨ä¸åŒçš„è´Ÿè½½é˜ˆå€¼æ¥å†³å®šæ˜¯å¦å¼€å¯å¯¹å“ˆå¸Œè¡¨çš„è‡ªåŠ¨æ‰©å±•å·¥ä½œï¼›</p>
</li>
<li>
<p>å½“å“ˆå¸Œè¡¨è´Ÿè½½å› å­å°äº 0.1 æ—¶ï¼Œä¼šè‡ªåŠ¨å¼€å§‹å¯¹å“ˆå¸Œè¡¨ç¼©å®¹ï¼›</p>
</li>
<li>
<p>Rehash è¿‡ç¨‹æ˜¯æ¸è¿›å¼çš„ï¼š</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>å¼€å§‹ Rehash åï¼Œæ¯æ¬¡å¯¹è‡ªåŠ¨è¿›è¡Œçš„æ·»åŠ ã€åˆ é™¤ã€æŸ¥æ‰¾æˆ–æ›´æ–°æ—¶ï¼Œç¨‹åºä¼šè‡ªåŠ¨å°†å¯¹åº”çš„é”®å€¼å¯¹ä» <code>ht[0]</code> Rehash åˆ° <code>ht[1]</code> ä¸Šï¼›rehashidx å±æ€§å€¼å¢ä¸€ã€‚</p>
</li>
<li>
<p>è®°å¾—æœ‰åå°å®šæ—¶ä»»åŠ¡æ¥è‡ªåŠ¨æ‰©å±•çš„ï¼Œæ€ä¹ˆæ²¡æœ‰çœ‹åˆ°è¯´æ˜æ–‡æ¡£ï¼Ÿ</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>Redis åœ¨å“ˆå¸Œå¯¹è±¡ä¸Šçš„ç¼–ç æœ‰å¯èƒ½æ˜¯ï¼š</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>ziplist</p>
</li>
<li>
<p>hashtable</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>è½¬æ¢æ¡ä»¶æ˜¯ï¼š</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>å“ˆå¸Œå¯¹è±¡ä¿å­˜çš„æ‰€æœ‰é”®å€¼å¯¹è±¡å­—ç¬¦ä¸²é•¿åº¦éƒ½å°äº 64 ä¸ªå­—èŠ‚ï¼›ï¼ˆé€šè¿‡å‚æ•° <code>hash-max-ziplist-value</code> æ¥è°ƒèŠ‚ï¼Œé»˜è®¤ä¸º 64ï¼‰</p>
</li>
<li>
<p>å“ˆå¸Œå¯¹è±¡ä¿å­˜çš„é”®å€¼å¯¹æ•°é‡å°äº 512 ä¸ªï¼›ï¼ˆé€šè¿‡å‚æ•° <code>hash-max-ziplist-entries</code> æ¥è°ƒèŠ‚ï¼Œé»˜è®¤ä¸º 512ï¼‰</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
</pre></td><td class="code"><pre><span class="nv">$ </span>redis-cli <span class="nt">--raw</span>

127.0.0.1:6379&gt; HMSET profile name <span class="s2">"Dç“œå“¥"</span> site <span class="s2">"https://www.diguage.com"</span> job <span class="s2">"Developer"</span>
OK

127.0.0.1:6379&gt; TYPE profile
<span class="nb">hash

</span>127.0.0.1:6379&gt; OBJECT encoding profile
ziplist

127.0.0.1:6379&gt; HSET profile address <span class="s2">"1234567890123456789012345678901234567890123456789012345678901234"</span> <i class="conum" data-value="1"></i><b>(1)</b>
1

127.0.0.1:6379&gt; HVALS profile
Dç“œå“¥
https://www.diguage.com
Developer
1234567890123456789012345678901234567890123456789012345678901234
127.0.0.1:6379&gt; OBJECT encoding profile
ziplist

127.0.0.1:6379&gt; HSET profile address <span class="s2">"12345678901234567890123456789012345678901234567890123456789012345"</span> <i class="conum" data-value="2"></i><b>(2)</b>
0

127.0.0.1:6379&gt; HVALS profile
https://www.diguage.com
Dç“œå“¥
12345678901234567890123456789012345678901234567890123456789012345
Developer

127.0.0.1:6379&gt; OBJECT encoding profile
hashtable
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>è¿™æ˜¯ 64 ä¸ªå­—ç¬¦ã€‚</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>è¿™æ˜¯ 65 ä¸ªå­—ç¬¦ã€‚</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>é€šè¿‡ <code>t_hash.c/hashTypeConvertZiplist</code> æ–¹æ³•æ¥è½¬æ¢ã€‚</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_å‚è€ƒèµ„æ–™_5"><a class="anchor" href="#_å‚è€ƒèµ„æ–™_5"></a>25.3. å‚è€ƒèµ„æ–™</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="https://www.diguage.com/post/redis-core-data-structure-2/" target="_blank" rel="noopener">Redis æ ¸å¿ƒæ•°æ®ç»“æ„ï¼ˆäºŒï¼‰ - "åœ°ç“œå“¥"åšå®¢ç½‘</a>&#8201;&#8212;&#8201;æœ¬æ–‡ä¸­çš„ Redis å†…å®¹æ˜¯è¿™ç¯‡æ–‡ç« çš„ä¸€ä¸ªæ‹·è´ã€‚è¯·ä»¥åŸæ–‡ä¸ºå‡†å¤‡ï¼Œæœ¬æ–‡å°½é‡åŒæ­¥æ›´æ–°ã€‚</p>
</li>
<li>
<p><a href="https://mp.weixin.qq.com/s?__biz=MzA4NTg1MjM0Mg==&amp;mid=2657261203&amp;idx=1&amp;sn=f7ff61ce42e29b874a8026683875bbb1&amp;scene=21#wechat_redirect">Rediså†…éƒ¨æ•°æ®ç»“æ„è¯¦è§£(1)â€”â€”dict</a></p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_ç®€ä»‹"><a class="anchor" href="#_ç®€ä»‹"></a>25.4. ç®€ä»‹</h3>
<div class="paragraph">
<p>HashMapæ˜¯åŸºäºå“ˆå¸Œè¡¨å®ç°çš„ï¼Œç”¨æ¥å­˜å‚¨key-valueå½¢å¼çš„é”®å€¼å¯¹ï¼Œå…è®¸keyå’Œvalueéƒ½ä¸ºnullå€¼ï¼›
HashMapæ˜¯éçº¿ç¨‹å®‰å…¨çš„ï¼Œåªæ˜¯ç”¨äºå•çº¿ç¨‹ç¯å¢ƒä¸‹ï¼Œå¤šçº¿ç¨‹ç¯å¢ƒä¸‹å¯ä»¥é‡‡ç”¨concurrentå¹¶å‘åŒ…ä¸‹çš„concurrentHashMapï¼›
HashMapå®ç°äº†Serializableæ¥å£ï¼Œæ”¯æŒåºåˆ—åŒ–ï¼Œå®ç°äº†Cloneableæ¥å£ï¼Œèƒ½è¢«å…‹éš†ã€‚</p>
</div>
</div>
<div class="sect2">
<h3 id="_ç­¾å"><a class="anchor" href="#_ç­¾å"></a>25.5. ç­¾å</h3>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">HashMap</span><span class="o">&lt;</span><span class="no">K</span><span class="o">,</span><span class="no">V</span><span class="o">&gt;</span>
    <span class="kd">extends</span> <span class="nc">AbstractMap</span><span class="o">&lt;</span><span class="no">K</span><span class="o">,</span><span class="no">V</span><span class="o">&gt;</span>
    <span class="kd">implements</span> <span class="nc">Map</span><span class="o">&lt;</span><span class="no">K</span><span class="o">,</span><span class="no">V</span><span class="o">&gt;,</span> <span class="nc">Cloneable</span><span class="o">,</span> <span class="nc">Serializable</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>å¯ä»¥çœ‹åˆ°HashMap å®ç°äº†Cloneableå’ŒSerializableæ ‡è®°æ¥å£ï¼š</p>
</div>
<div class="ulist">
<ul>
<li>
<p>æ ‡è®°æ¥å£Cloneableï¼Œç”¨äºè¡¨æ˜HashMapå¯¹è±¡ä¼šé‡å†™java.lang.Object#clone()æ–¹æ³•ï¼ŒHashMapå®ç°çš„æ˜¯æµ…æ‹·è´ï¼ˆshallow copyï¼‰ã€‚</p>
</li>
<li>
<p>æ ‡è®°æ¥å£Serializableï¼Œç”¨äºè¡¨æ˜HashMapå¯¹è±¡å¯ä»¥è¢«åºåˆ—åŒ–ã€‚</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>HashMapç»§æ‰¿äº†AbstractMapæŠ½è±¡ç±»ï¼ŒåŒæ—¶ä¹Ÿå®ç°äº†Mapæ¥å£ã€‚</strong></p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
åœ¨è¯­æ³•å±‚é¢ç»§æ‰¿æ¥å£Mapæ˜¯å¤šä½™çš„ï¼Œè¿™ä¹ˆåšä»…ä»…æ˜¯ä¸ºäº†è®©é˜…è¯»ä»£ç çš„äººæ˜ç¡®çŸ¥é“HashMapæ˜¯å±äºMapä½“ç³»çš„ï¼Œèµ·åˆ°äº†æ–‡æ¡£çš„ä½œç”¨ã€‚
AbstractMapç›¸å½“äºä¸ªè¾…åŠ©ç±»ï¼ŒMapçš„ä¸€äº›æ“ä½œè¿™é‡Œé¢å·²ç»æä¾›äº†é»˜è®¤å®ç°ï¼Œåé¢å…·ä½“çš„å­ç±»å¦‚æœæ²¡æœ‰ç‰¹æ®Šè¡Œä¸ºï¼Œå¯ç›´æ¥ä½¿ç”¨AbstractMapæä¾›çš„å®ç°ã€‚
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>AbstractMapç›¸å½“äºä¸ªè¾…åŠ©ç±»ï¼ŒMapçš„ä¸€äº›æ“ä½œè¿™é‡Œé¢å·²ç»æä¾›äº†é»˜è®¤å®ç°ï¼Œåé¢å…·ä½“çš„å­ç±»å¦‚æœæ²¡æœ‰ç‰¹æ®Šè¡Œä¸ºï¼Œå¯ç›´æ¥ä½¿ç”¨AbstractMapæä¾›çš„å®ç°ã€‚</p>
</div>
<div class="paragraph">
<p>æ¥å£java.util.Map,ä¸»è¦æœ‰å››ä¸ªå¸¸ç”¨çš„å®ç°ç±»ï¼Œåˆ†åˆ«æ˜¯HashMapã€Hashtableã€LinkedHashMapå’ŒTreeMapï¼Œç±»ç»§æ‰¿å…³ç³»å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/map_structure.png" alt="map structure">
</div>
</div>
<div class="paragraph">
<p>ä¸‹é¢é’ˆå¯¹å„ä¸ªå®ç°ç±»çš„ç‰¹ç‚¹åšä¸€äº›è¯´æ˜ï¼š</p>
</div>
<div class="paragraph">
<p>(1) HashMapï¼šå®ƒæ ¹æ®é”®çš„hashCodeå€¼å­˜å‚¨æ•°æ®ï¼Œå¤§å¤šæ•°æƒ…å†µä¸‹å¯ä»¥ç›´æ¥å®šä½åˆ°å®ƒçš„å€¼ï¼Œå› è€Œå…·æœ‰å¾ˆå¿«çš„è®¿é—®é€Ÿåº¦ï¼Œä½†éå†é¡ºåºå´æ˜¯ä¸ç¡®å®šçš„ã€‚<br>
HashMapæœ€å¤šåªå…è®¸ä¸€æ¡è®°å½•çš„é”®ä¸ºnullï¼Œå…è®¸å¤šæ¡è®°å½•çš„å€¼ä¸ºnullã€‚HashMapéçº¿ç¨‹å®‰å…¨ï¼Œå³ä»»ä¸€æ—¶åˆ»å¯ä»¥æœ‰å¤šä¸ªçº¿ç¨‹åŒæ—¶å†™HashMapï¼Œ<br>
å¯èƒ½ä¼šå¯¼è‡´æ•°æ®çš„ä¸ä¸€è‡´ã€‚å¦‚æœéœ€è¦æ»¡è¶³çº¿ç¨‹å®‰å…¨ï¼Œå¯ä»¥ç”¨ Collectionsçš„synchronizedMapæ–¹æ³•ä½¿HashMapå…·æœ‰çº¿ç¨‹å®‰å…¨çš„èƒ½åŠ›ï¼Œ<br>
æˆ–è€…ä½¿ç”¨ConcurrentHashMapã€‚</p>
</div>
<div class="paragraph">
<p>(2) Hashtableï¼šHashtableæ˜¯é—ç•™ç±»ï¼Œå¾ˆå¤šæ˜ å°„çš„å¸¸ç”¨åŠŸèƒ½ä¸HashMapç±»ä¼¼ï¼Œä¸åŒçš„æ˜¯å®ƒæ‰¿è‡ªDictionaryç±»ï¼Œå¹¶ä¸”æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œ<br>
ä»»ä¸€æ—¶é—´åªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½å†™Hashtableï¼Œå¹¶å‘æ€§ä¸å¦‚ConcurrentHashMapï¼Œå› ä¸ºConcurrentHashMapå¼•å…¥äº†åˆ†æ®µé”ã€‚<br>
Hashtableä¸å»ºè®®åœ¨æ–°ä»£ç ä¸­ä½¿ç”¨ï¼Œä¸éœ€è¦çº¿ç¨‹å®‰å…¨çš„åœºåˆå¯ä»¥ç”¨HashMapæ›¿æ¢ï¼Œéœ€è¦çº¿ç¨‹å®‰å…¨çš„åœºåˆå¯ä»¥ç”¨ConcurrentHashMapæ›¿æ¢ã€‚<br></p>
</div>
<div class="paragraph">
<p>(3) LinkedHashMapï¼šLinkedHashMapæ˜¯HashMapçš„ä¸€ä¸ªå­ç±»ï¼Œä¿å­˜äº†è®°å½•çš„æ’å…¥é¡ºåºï¼Œåœ¨ç”¨Iteratoréå†LinkedHashMapæ—¶ï¼Œå…ˆå¾—åˆ°çš„è®°å½•è‚¯å®šæ˜¯å…ˆæ’å…¥çš„ï¼Œä¹Ÿå¯ä»¥åœ¨æ„é€ æ—¶å¸¦å‚æ•°ï¼ŒæŒ‰ç…§è®¿é—®æ¬¡åºæ’åºã€‚</p>
</div>
<div class="paragraph">
<p>(4) TreeMapï¼šTreeMapå®ç°SortedMapæ¥å£ï¼Œèƒ½å¤ŸæŠŠå®ƒä¿å­˜çš„è®°å½•æ ¹æ®é”®æ’åºï¼Œé»˜è®¤æ˜¯æŒ‰é”®å€¼çš„å‡åºæ’åºï¼Œä¹Ÿå¯ä»¥æŒ‡å®šæ’åºçš„æ¯”è¾ƒå™¨ï¼Œå½“ç”¨Iteratoréå†TreeMapæ—¶ï¼Œå¾—åˆ°çš„è®°å½•æ˜¯æ’è¿‡åºçš„ã€‚å¦‚æœä½¿ç”¨æ’åºçš„æ˜ å°„ï¼Œå»ºè®®ä½¿ç”¨TreeMapã€‚åœ¨ä½¿ç”¨TreeMapæ—¶ï¼Œkeyå¿…é¡»å®ç°Comparableæ¥å£æˆ–è€…åœ¨æ„é€ TreeMapä¼ å…¥è‡ªå®šä¹‰çš„Comparatorï¼Œå¦åˆ™ä¼šåœ¨è¿è¡Œæ—¶æŠ›å‡ºjava.lang.ClassCastExceptionç±»å‹çš„å¼‚å¸¸ã€‚</p>
</div>
<div class="paragraph">
<p>å¯¹äºä¸Šè¿°å››ç§Mapç±»å‹çš„ç±»ï¼Œè¦æ±‚æ˜ å°„ä¸­çš„keyæ˜¯ä¸å¯å˜å¯¹è±¡ã€‚ä¸å¯å˜å¯¹è±¡æ˜¯è¯¥å¯¹è±¡åœ¨åˆ›å»ºåå®ƒçš„å“ˆå¸Œå€¼ä¸ä¼šè¢«æ”¹å˜ã€‚å¦‚æœå¯¹è±¡çš„å“ˆå¸Œå€¼å‘ç”Ÿå˜åŒ–ï¼ŒMapå¯¹è±¡å¾ˆå¯èƒ½å°±å®šä½ä¸åˆ°æ˜ å°„çš„ä½ç½®äº†ã€‚</p>
</div>
<div class="paragraph">
<p>é€šè¿‡ä¸Šé¢çš„æ¯”è¾ƒï¼Œæˆ‘ä»¬çŸ¥é“äº†HashMapæ˜¯Javaçš„Mapå®¶æ—ä¸­ä¸€ä¸ªæ™®é€šæˆå‘˜ï¼Œé‰´äºå®ƒå¯ä»¥æ»¡è¶³å¤§å¤šæ•°åœºæ™¯çš„ä½¿ç”¨æ¡ä»¶ï¼Œæ‰€ä»¥æ˜¯ä½¿ç”¨é¢‘åº¦æœ€é«˜çš„ä¸€ä¸ªã€‚ä¸‹æ–‡æˆ‘ä»¬ä¸»è¦ç»“åˆæºç ï¼Œä»å­˜å‚¨ç»“æ„ã€å¸¸ç”¨æ–¹æ³•åˆ†æã€æ‰©å®¹ç­‰æ–¹é¢äº†è§£ä¸€ä¸‹HashMapçš„å·¥ä½œåŸç†ã€‚</p>
</div>
</div>
<div class="sect2">
<h3 id="_å­˜å‚¨ç»“æ„"><a class="anchor" href="#_å­˜å‚¨ç»“æ„"></a>25.6. å­˜å‚¨ç»“æ„</h3>
<div class="paragraph">
<p>HashMapæ˜¯åŸºäºå“ˆå¸Œè¡¨å­˜å‚¨çš„ï¼Œåœ¨JDK1.6ï¼ŒJDK1.7ç‰ˆæœ¬é‡‡ç”¨æ•°ç»„(æ¡¶ä½) + é“¾è¡¨å®ç°å­˜å‚¨å…ƒç´ å’Œè§£å†³å†²çªï¼ŒåŒä¸€hashå€¼çš„é“¾è¡¨éƒ½å­˜å‚¨åœ¨ä¸€ä¸ªé“¾è¡¨é‡Œã€‚
ä½†æ˜¯å½“ä½äºä¸€ä¸ªæ¡¶ä¸­çš„å…ƒç´ è¾ƒå¤šï¼Œå³hashå€¼ç›¸ç­‰çš„å…ƒç´ è¾ƒå¤šæ—¶ï¼Œé€šè¿‡keyå€¼ä¾æ¬¡æŸ¥æ‰¾çš„æ•ˆç‡è¾ƒä½ã€‚ä½†æ˜¯åˆ°JDK1.8ç‰ˆæœ¬æ—¶HashMapé‡‡ç”¨ä½æ¡¶ + é“¾è¡¨ + çº¢é»‘æ ‘å®ç°ï¼Œ
å½“é“¾è¡¨é•¿åº¦è¶…è¿‡é˜ˆå€¼ï¼ˆ8ï¼‰æ—¶ï¼Œå°†é“¾è¡¨è½¬æ¢ä¸ºçº¢é»‘æ ‘ï¼Œè¿™æ ·å¤§å¤§å‡å°‘äº†æŸ¥æ‰¾æ—¶é—´ã€‚</p>
</div>
</div>
<div class="sect2">
<h3 id="_å®ç°åŸç†"><a class="anchor" href="#_å®ç°åŸç†"></a>25.7. å®ç°åŸç†</h3>
<div class="paragraph">
<p>é¦–å…ˆæœ‰ä¸€ä¸ªå…ƒç´ æ˜¯é“¾è¡¨çš„æ•°ç»„ï¼Œå½“æ·»åŠ ä¸€ä¸ªå…ƒç´ ï¼ˆkey-valueï¼‰æ—¶ï¼Œå°±é¦–å…ˆè®¡ç®—å…ƒç´ keyçš„hashå€¼ï¼Œä»¥æ­¤ç¡®å®šå…ƒç´ åœ¨æ•°ç»„ä¸­çš„ä½ç½®ï¼Œä½†æ˜¯å¯èƒ½å­˜åœ¨åŒä¸€hashå€¼çš„å…ƒç´ 
å·²ç»è¢«æ”¾åœ¨æ•°ç»„åŒä¸€ä½ç½®äº†ï¼ˆä¹Ÿå°±å‡ºç°äº†Hashå†²çªï¼‰ï¼Œè¿™æ—¶å°±æ·»åŠ åˆ°åŒä¸€hashå€¼çš„å…ƒç´ çš„åé¢ï¼Œä»–ä»¬åœ¨æ•°ç»„çš„åŒä¸€ä½ç½®ï¼Œä½†æ˜¯å½¢æˆäº†é“¾è¡¨ï¼ŒåŒä¸€ä¸ªé“¾è¡¨ä¸Šçš„Hashå€¼æ˜¯
ç›¸åŒçš„ï¼Œæ‰€ä»¥è¯´æ•°ç»„å­˜æ”¾çš„æ˜¯é“¾è¡¨ã€‚è€Œå½“é“¾è¡¨é•¿åº¦å¤ªé•¿æ—¶ï¼Œé“¾è¡¨å°±è½¬æ¢ä¸ºçº¢é»‘æ ‘ï¼Œè¿™æ ·å¤§å¤§æé«˜äº†æŸ¥æ‰¾çš„æ•ˆç‡ã€‚<br>
å½“é“¾è¡¨æ•°ç»„çš„å®¹é‡è¶…è¿‡åˆå§‹å®¹é‡çš„0.75ï¼ˆé˜€å€¼ï¼‰æ—¶ï¼Œå°†é“¾è¡¨æ•°ç»„æ‰©å¤§2å€ï¼Œç„¶åæŠŠåŸæ¥æ•°ç»„ä¸­çš„é“¾è¡¨é‡æ–°æ•£åˆ—ï¼ŒæŠŠåŸé“¾è¡¨æ•°ç»„ä¸­çš„å…ƒç´ è¿ç§»åˆ°æ–°çš„æ•°ç»„ä¸­ã€‚</p>
</div>
<div class="paragraph">
<p>HashMapåŸç†å›¾ï¼š</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/jdk1.8HashMap.png" alt="jdk1.8HashMap">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_æºç å‰–æ"><a class="anchor" href="#_æºç å‰–æ"></a>25.8. æºç å‰–æ</h3>
<div class="sect3">
<h4 id="_é‡è¦å±æ€§"><a class="anchor" href="#_é‡è¦å±æ€§"></a>25.8.1. é‡è¦å±æ€§</h4>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="cm">/**
 *  åºåˆ—å·
 */</span>
<span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">long</span> <span class="n">serialVersionUID</span> <span class="o">=</span> <span class="mi">362498820763181265L</span><span class="o">;</span>

<span class="cm">/**
 *  é»˜è®¤åˆå§‹å®¹é‡ï¼ˆå®¹é‡ä¸ºHashMapä¸­æ§½çš„æ•°ç›®ï¼‰æ˜¯16ï¼Œä¸”å¿…é¡»æ˜¯2çš„æ•´æ•°æ¬¡å¹‚ã€‚
 */</span>
<span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="no">DEFAULT_INITIAL_CAPACITY</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">4</span><span class="o">;</span> <span class="c1">// aka 16</span>

<span class="cm">/**
 * æœ€å¤§å®¹é‡ï¼ˆå¿…é¡»æ˜¯2çš„å¹‚ä¸”å°äº2çš„30æ¬¡æ–¹ï¼Œä¼ å…¥å®¹é‡è¿‡å¤§å°†è¢«è¿™ä¸ªå€¼æ›¿æ¢ï¼‰
 */</span>
<span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="no">MAXIMUM_CAPACITY</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">30</span><span class="o">;</span>

<span class="cm">/**
 * é»˜è®¤è£…è½½å› å­ä¸º0.75
 */</span>
<span class="kd">static</span> <span class="kd">final</span> <span class="kt">float</span> <span class="no">DEFAULT_LOAD_FACTOR</span> <span class="o">=</span> <span class="mf">0.75f</span><span class="o">;</span>

<span class="cm">/**
 * å½“putä¸€ä¸ªå…ƒç´ åˆ°æŸä¸ªæ¡¶ä½ï¼Œå…¶é“¾è¡¨é•¿åº¦è¾¾åˆ°8æ—¶å°†é“¾è¡¨è½¬æ¢ä¸ºçº¢é»‘æ ‘
 */</span>
<span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="no">TREEIFY_THRESHOLD</span> <span class="o">=</span> <span class="mi">8</span><span class="o">;</span>

<span class="cm">/**
 * ä¸€ä¸ªæ¡¶ä½ä¸Šçš„é“¾è¡¨é•¿åº¦å°äºè¿™ä¸ªå€¼æ—¶å°†çº¢é»‘æ ‘è½¬é“¾è¡¨
 */</span>
<span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="no">UNTREEIFY_THRESHOLD</span> <span class="o">=</span> <span class="mi">6</span><span class="o">;</span>

<span class="cm">/**
 * æ ‘çš„æœ€å°çš„å®¹é‡ï¼Œè‡³å°‘æ˜¯ 4 x TREEIFY_THRESHOLD = 32
 * ç„¶åä¸ºäº†é¿å…(resizing å’Œ treeification thresholds) è®¾ç½®æˆ64
 */</span>
<span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="no">MIN_TREEIFY_CAPACITY</span> <span class="o">=</span> <span class="mi">64</span><span class="o">;</span>

<span class="cm">/**
 * å®é™…å­˜æ”¾å…ƒç´ çš„ä¸ªæ•°ï¼Œä¸ç­‰äºæ•°ç»„çš„é•¿åº¦
 */</span>
<span class="kd">transient</span> <span class="kt">int</span> <span class="n">size</span><span class="o">;</span>

<span class="cm">/**
 * è¾¾åˆ°è¿™ä¸ªé˜ˆå€¼å°±è¦è¿›è¡Œæ‰©å®¹ï¼Œå…¶ç­‰äºå®¹é‡ * è£…è½½å› å­
 */</span>
<span class="kt">int</span> <span class="n">threshold</span><span class="o">;</span>

<span class="cm">/**
 * å®é™…è£…è½½å› å­
 */</span>
<span class="kd">final</span> <span class="kt">float</span> <span class="n">loadFactor</span><span class="o">;</span>

<span class="cm">/**
 * æ¯æ¬¡æ‰©å®¹å’Œæ›´æ”¹mapç»“æ„çš„è®¡æ•°å™¨
 * å¦‚æœåœ¨ä½¿ç”¨è¿­ä»£å™¨çš„è¿‡ç¨‹ä¸­æœ‰å…¶ä»–çº¿ç¨‹ä¿®æ”¹äº†mapï¼Œå°†æŠ›å‡ºConcurrentModificationExceptionï¼Œ
 * è¿™å°±æ˜¯æ‰€è°“fail-fastç­–ç•¥ï¼ˆé€Ÿé”™ï¼‰ï¼Œè¿™ä¸€ç­–ç•¥çš„å®ç°å°±æ˜¯é€šè¿‡modCount
 */</span>
<span class="kd">transient</span> <span class="kt">int</span> <span class="n">modCount</span><span class="o">;</span>

<span class="cm">/*
 * å­˜æ”¾å…·ä½“key-valueå¯¹å…ƒç´ çš„é›†å’Œ
 */</span>
<span class="kd">transient</span> <span class="nc">Set</span><span class="o">&lt;</span><span class="nc">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="no">K</span><span class="o">,</span><span class="no">V</span><span class="o">&gt;&gt;</span> <span class="n">entrySet</span><span class="o">;</span>

<span class="cm">/*
 * å­˜å‚¨å…ƒç´ çš„æ•°ç»„ï¼Œæ€»æ˜¯2çš„å¹‚æ¬¡å€
 */</span>
<span class="kd">transient</span> <span class="nc">Node</span><span class="o">&lt;</span><span class="no">K</span><span class="o">,</span><span class="no">V</span><span class="o">&gt;[]</span> <span class="n">table</span><span class="o">;</span></code></pre>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">åŠ è½½å› å­</div>
<div class="paragraph">
<p>åŠ è½½å› å­ï¼ˆé»˜è®¤0.75ï¼‰ï¼šä¸ºä»€ä¹ˆéœ€è¦ä½¿ç”¨åŠ è½½å› å­ï¼Œä¸ºä»€ä¹ˆéœ€è¦æ‰©å®¹å‘¢ï¼Ÿå› ä¸ºå¦‚æœåŠ è½½å› å­å¾ˆå¤§ï¼Œ
è¯´æ˜åˆ©ç”¨çš„ç©ºé—´å¾ˆå¤šï¼Œå¦‚æœä¸€ç›´ä¸è¿›è¡Œæ‰©å®¹çš„è¯ï¼Œé“¾è¡¨å°±ä¼šè¶Šæ¥è¶Šé•¿ï¼Œè¿™æ ·æŸ¥æ‰¾çš„æ•ˆç‡å¾ˆä½ï¼Œ
å› ä¸ºé“¾è¡¨çš„é•¿åº¦å¾ˆå¤§ï¼ˆå½“ç„¶æœ€æ–°ç‰ˆæœ¬ä½¿ç”¨äº†çº¢é»‘æ ‘åä¼šæ”¹è¿›å¾ˆå¤šï¼‰ï¼Œæ‰©å®¹ä¹‹åï¼Œå°†åŸæ¥é“¾è¡¨æ•°
ç»„çš„æ¯ä¸€ä¸ªé“¾è¡¨åˆ†æˆå¥‡å¶ä¸¤ä¸ªå­é“¾è¡¨åˆ†åˆ«æŒ‚åœ¨æ–°é“¾è¡¨æ•°ç»„çš„æ•£åˆ—ä½ç½®ï¼Œè¿™æ ·å°±å‡å°‘äº†æ¯ä¸ªé“¾è¡¨
çš„é•¿åº¦ï¼Œå¢åŠ æŸ¥æ‰¾æ•ˆç‡ã€‚HashMapæœ¬æ¥æ˜¯ä»¥ç©ºé—´æ¢æ—¶é—´ï¼Œæ‰€ä»¥è£…è½½å› å­æ²¡å¿…è¦å¤ªå¤§ã€‚ä½†æ˜¯è£…è½½å› å­å¤ªå°
åˆä¼šå¯¼è‡´ç©ºé—´æµªè´¹ã€‚å¦‚æœå…³æ³¨å†…å­˜ï¼Œè£…è½½å› å­å¯ä»¥ç¨å¤§ï¼Œå¦‚æœä¸»è¦å…³æ³¨æŸ¥æ‰¾æ€§èƒ½ï¼Œè£…è½½å› å­å¯ä»¥ç¨å°ã€‚</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_æ•°æ®ç»“æ„"><a class="anchor" href="#_æ•°æ®ç»“æ„"></a>25.8.2. æ•°æ®ç»“æ„</h4>
<div class="ulist">
<ul>
<li>
<p>æ¡¶ä½æ•°ç»„</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="cm">/**
 * 1.å­˜å‚¨å…ƒç´ ï¼ˆæ¡¶ä½ï¼‰çš„æ•°ç»„
 */</span>
<span class="kd">transient</span> <span class="nc">Node</span><span class="o">&lt;</span><span class="n">k</span><span class="o">,</span><span class="n">v</span><span class="o">&gt;[]</span> <span class="n">table</span><span class="o">;</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>æ•°ç»„å…ƒç´ Node&lt;K,V&gt;</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="c1">//Nodeæ˜¯å•å‘é“¾è¡¨ï¼Œå®ƒå®ç°äº†Map.Entryæ¥å£</span>
<span class="kd">static</span> <span class="kd">class</span> <span class="nc">Node</span><span class="o">&lt;</span><span class="no">K</span><span class="o">,</span><span class="no">V</span><span class="o">&gt;</span> <span class="kd">implements</span> <span class="nc">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="no">K</span><span class="o">,</span><span class="no">V</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="kd">final</span> <span class="kt">int</span> <span class="n">hash</span><span class="o">;</span>
    <span class="kd">final</span> <span class="no">K</span> <span class="n">key</span><span class="o">;</span>
    <span class="no">V</span> <span class="n">value</span><span class="o">;</span>
    <span class="nc">Node</span><span class="o">&lt;</span><span class="no">K</span><span class="o">,</span><span class="no">V</span><span class="o">&gt;</span> <span class="n">next</span><span class="o">;</span>  <span class="c1">//ä¸‹ä¸€ä¸ªèŠ‚ç‚¹</span>

    <span class="nc">Node</span><span class="o">(</span><span class="kt">int</span> <span class="n">hash</span><span class="o">,</span> <span class="no">K</span> <span class="n">key</span><span class="o">,</span> <span class="no">V</span> <span class="n">value</span><span class="o">,</span> <span class="nc">Node</span><span class="o">&lt;</span><span class="no">K</span><span class="o">,</span><span class="no">V</span><span class="o">&gt;</span> <span class="n">next</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">hash</span> <span class="o">=</span> <span class="n">hash</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">key</span> <span class="o">=</span> <span class="n">key</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">next</span> <span class="o">=</span> <span class="n">next</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">final</span> <span class="no">K</span> <span class="nf">getKey</span><span class="o">()</span>        <span class="o">{</span> <span class="k">return</span> <span class="n">key</span><span class="o">;</span> <span class="o">}</span>
    <span class="kd">public</span> <span class="kd">final</span> <span class="no">V</span> <span class="nf">getValue</span><span class="o">()</span>      <span class="o">{</span> <span class="k">return</span> <span class="n">value</span><span class="o">;</span> <span class="o">}</span>
    <span class="kd">public</span> <span class="kd">final</span> <span class="nc">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">key</span> <span class="o">+</span> <span class="s">"="</span> <span class="o">+</span> <span class="n">value</span><span class="o">;</span> <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">final</span> <span class="kt">int</span> <span class="nf">hashCode</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="nc">Objects</span><span class="o">.</span><span class="na">hashCode</span><span class="o">(</span><span class="n">key</span><span class="o">)</span> <span class="o">^</span> <span class="nc">Objects</span><span class="o">.</span><span class="na">hashCode</span><span class="o">(</span><span class="n">value</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">final</span> <span class="no">V</span> <span class="nf">setValue</span><span class="o">(</span><span class="no">V</span> <span class="n">newValue</span><span class="o">)</span> <span class="o">{</span>
        <span class="no">V</span> <span class="n">oldValue</span> <span class="o">=</span> <span class="n">value</span><span class="o">;</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">newValue</span><span class="o">;</span>
        <span class="k">return</span> <span class="n">oldValue</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">final</span> <span class="kt">boolean</span> <span class="nf">equals</span><span class="o">(</span><span class="nc">Object</span> <span class="n">o</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">o</span> <span class="o">==</span> <span class="k">this</span><span class="o">)</span>
            <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">o</span> <span class="k">instanceof</span> <span class="nc">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">)</span> <span class="o">{</span>
            <span class="nc">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;?,?&gt;</span> <span class="n">e</span> <span class="o">=</span> <span class="o">(</span><span class="nc">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;?,?&gt;)</span><span class="n">o</span><span class="o">;</span>
            <span class="k">if</span> <span class="o">(</span><span class="nc">Objects</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">key</span><span class="o">,</span> <span class="n">e</span><span class="o">.</span><span class="na">getKey</span><span class="o">())</span> <span class="o">&amp;&amp;</span>
                    <span class="nc">Objects</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">value</span><span class="o">,</span> <span class="n">e</span><span class="o">.</span><span class="na">getValue</span><span class="o">()))</span>
                <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
å…¶å®Nodeå°±æ˜¯ä¸€ä¸ªåŸºäºå•å‘é“¾è¡¨æ•°æ®ç»“æ„çš„å­˜å‚¨keyå’Œvalueçš„ä¸€ä¸ªå¯¹è±¡ã€‚nextæŒ‡å‘ä¸‹ä¸€ä¸ªNode.å®ç°äº†Map.Entryæ¥å£
</td>
</tr>
</table>
</div>
<div class="ulist">
<ul>
<li>
<p>çº¢é»‘æ ‘</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">static</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">TreeNode</span><span class="o">&lt;</span><span class="no">K</span><span class="o">,</span><span class="no">V</span><span class="o">&gt;</span> <span class="kd">extends</span> <span class="nc">LinkedHashMap</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="no">K</span><span class="o">,</span><span class="no">V</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="nc">TreeNode</span><span class="o">&lt;</span><span class="n">k</span><span class="o">,</span><span class="n">v</span><span class="o">&gt;</span> <span class="n">parent</span><span class="o">;</span>  <span class="c1">//çˆ¶èŠ‚ç‚¹</span>
    <span class="nc">TreeNode</span><span class="o">&lt;</span><span class="n">k</span><span class="o">,</span><span class="n">v</span><span class="o">&gt;</span> <span class="n">left</span><span class="o">;</span>    <span class="c1">//å·¦å­æ ‘</span>
    <span class="nc">TreeNode</span><span class="o">&lt;</span><span class="n">k</span><span class="o">,</span><span class="n">v</span><span class="o">&gt;</span> <span class="n">right</span><span class="o">;</span>   <span class="c1">//å³å­æ ‘</span>
    <span class="nc">TreeNode</span><span class="o">&lt;</span><span class="n">k</span><span class="o">,</span><span class="n">v</span><span class="o">&gt;</span> <span class="n">prev</span><span class="o">;</span>    <span class="c1">// needed to unlink next upon deletion</span>
    <span class="kt">boolean</span> <span class="n">red</span><span class="o">;</span>           <span class="c1">//é¢œè‰²å±æ€§</span>
    <span class="nc">TreeNode</span><span class="o">(</span><span class="kt">int</span> <span class="n">hash</span><span class="o">,</span> <span class="no">K</span> <span class="n">key</span><span class="o">,</span> <span class="no">V</span> <span class="n">val</span><span class="o">,</span> <span class="nc">Node</span><span class="o">&lt;</span><span class="no">K</span><span class="o">,</span><span class="no">V</span><span class="o">&gt;</span> <span class="n">next</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">(</span><span class="n">hash</span><span class="o">,</span> <span class="n">key</span><span class="o">,</span> <span class="n">val</span><span class="o">,</span> <span class="n">next</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="cm">/**
     * è¿”å›å½“å‰èŠ‚ç‚¹çš„æ ¹èŠ‚ç‚¹
     */</span>
    <span class="kd">final</span> <span class="nc">TreeNode</span><span class="o">&lt;</span><span class="no">K</span><span class="o">,</span><span class="no">V</span><span class="o">&gt;</span> <span class="nf">root</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">for</span> <span class="o">(</span><span class="nc">TreeNode</span><span class="o">&lt;</span><span class="no">K</span><span class="o">,</span><span class="no">V</span><span class="o">&gt;</span> <span class="n">r</span> <span class="o">=</span> <span class="k">this</span><span class="o">,</span> <span class="n">p</span><span class="o">;;)</span> <span class="o">{</span>
            <span class="k">if</span> <span class="o">((</span><span class="n">p</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="na">parent</span><span class="o">)</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span>
                <span class="k">return</span> <span class="n">r</span><span class="o">;</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">p</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span></code></pre>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">transient å…³é”®å­—</div>
<div class="paragraph">
<p>Javaåºåˆ—åŒ–ä¼šæŠŠæŸä¸€ä¸ªç±»å­˜å‚¨ä»¥æ–‡ä»¶å½¢å¼å­˜å‚¨åœ¨ç‰©ç†ç©ºé—´ï¼Œä½†æ˜¯ä»¥æ–‡ä»¶å½¢å¼å­˜å‚¨æŸäº›ä¿¡æ¯æ—¶ï¼Œå®¹æ˜“æ¶‰åŠåˆ°å®‰å…¨é—®é¢˜ï¼Œå› ä¸ºæ•°æ®ä½äºJavaè¿è¡Œç¯å¢ƒä¹‹å¤–ï¼Œ
ä¸åœ¨Javaå®‰å…¨æœºåˆ¶çš„æ§åˆ¶ä¹‹ä¸­ã€‚å¯¹äºè¿™äº›éœ€è¦ä¿å¯†çš„å­—æ®µï¼Œä¸åº”ä¿å­˜åœ¨æ°¸ä¹…ä»‹è´¨ä¸­ ï¼Œæˆ–è€…ä¸åº”ç®€å•åœ°ä¸åŠ å¤„ç†åœ°ä¿å­˜ä¸‹æ¥ ï¼Œä¸ºäº†ä¿è¯å®‰å…¨æ€§ã€‚
åº”è¯¥åœ¨è¿™äº›å­—æ®µå‰åŠ ä¸Štransientå…³é”®å­—ã€‚å®ƒçš„æ„æ€æ˜¯ä¸´æ—¶çš„ï¼Œå³ä¸ä¼šéšç±»ä¸€èµ·åºåˆ—åŒ–åˆ°æœ¬åœ°ï¼Œæ‰€ä»¥å½“è¿˜åŸåï¼Œè¿™ä¸ªå…³é”®å­—å®šä¹‰çš„å˜é‡ä¹Ÿå°±ä¸å†å­˜åœ¨ã€‚</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_æ„é€ å‡½æ•°"><a class="anchor" href="#_æ„é€ å‡½æ•°"></a>25.8.3. æ„é€ å‡½æ•°</h4>
<div class="ulist">
<ul>
<li>
<p>é»˜è®¤æ„é€ å‡½æ•°HashMap()</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">public</span> <span class="nf">HashMap</span><span class="o">()</span> <span class="o">{</span>
  <span class="c1">//åˆå§‹è¯åŠ è½½å› å­ä¸ºé»˜è®¤0.75ï¼›å…¶ä»–å±æ€§å‡ä¸ºé»˜è®¤</span>
  <span class="k">this</span><span class="o">.</span><span class="na">loadFactor</span> <span class="o">=</span> <span class="no">DEFAULT_LOAD_FACTOR</span><span class="o">;</span> <span class="c1">// all other fields defaulted</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
è¿™æ˜¯ä¸€ä¸ªé»˜è®¤æ„é€ å™¨ï¼Œæ½œåœ¨çš„é—®é¢˜æ˜¯åˆå§‹å®¹é‡16å¤ªå°äº†ï¼Œå¯èƒ½ä¸­é—´éœ€è¦ä¸æ–­æ‰©å®¹çš„é—®é¢˜ï¼Œä¼šå½±å“æ’å…¥çš„æ•ˆç‡ã€‚
</td>
</tr>
</table>
</div>
<div class="ulist">
<ul>
<li>
<p>æŒ‡å®šåˆå§‹å®¹é‡å’ŒåŠ è½½å› å­çš„æ„é€ å‡½æ•°HashMap(int, float)</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">public</span> <span class="nf">HashMap</span><span class="o">(</span><span class="kt">int</span> <span class="n">initialCapacity</span><span class="o">,</span> <span class="kt">float</span> <span class="n">loadFactor</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">//åˆå§‹å®¹é‡ä¸èƒ½å°äº0</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">initialCapacity</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="o">)</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nf">IllegalArgumentException</span><span class="o">(</span><span class="s">"Illegal initial capacity: "</span> <span class="o">+</span>
                <span class="n">initialCapacity</span><span class="o">);</span>
    <span class="c1">// åˆå§‹å®¹é‡ä¸èƒ½å¤§äºæœ€å¤§å€¼ï¼Œå¦åˆ™ä¸ºæœ€å¤§å€¼</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">initialCapacity</span> <span class="o">&gt;</span> <span class="no">MAXIMUM_CAPACITY</span><span class="o">)</span>
        <span class="n">initialCapacity</span> <span class="o">=</span> <span class="no">MAXIMUM_CAPACITY</span><span class="o">;</span>
    <span class="c1">// å¡«å……å› å­ä¸èƒ½å°äºæˆ–ç­‰äº0ï¼Œä¸èƒ½ä¸ºéæ•°å­—</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">loadFactor</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="o">||</span> <span class="nc">Float</span><span class="o">.</span><span class="na">isNaN</span><span class="o">(</span><span class="n">loadFactor</span><span class="o">))</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nf">IllegalArgumentException</span><span class="o">(</span><span class="s">"Illegal load factor: "</span> <span class="o">+</span>
                <span class="n">loadFactor</span><span class="o">);</span>
    <span class="c1">//åˆå§‹è¯åŠ è½½å› å­</span>
    <span class="k">this</span><span class="o">.</span><span class="na">loadFactor</span> <span class="o">=</span> <span class="n">loadFactor</span><span class="o">;</span>
    <span class="c1">//åˆå§‹åŒ–(é˜€å€¼)thresholdï¼Œæ•°ç»„å…ƒç´ æ•°é‡è¾¾åˆ°è¯¥å€¼æ—¶ä¼šæ‰©å®¹</span>
    <span class="k">this</span><span class="o">.</span><span class="na">threshold</span> <span class="o">=</span> <span class="n">tableSizeFor</span><span class="o">(</span><span class="n">initialCapacity</span><span class="o">);</span>
<span class="o">}</span>

<span class="cm">/**
 * tableSizeForçš„åŠŸèƒ½ä¸»è¦æ˜¯ç”¨æ¥ä¿è¯å®¹é‡åº”è¯¥å¤§äºcap,ä¸”ä¸º2çš„æ•´æ•°
 */</span>
<span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="nf">tableSizeFor</span><span class="o">(</span><span class="kt">int</span> <span class="n">cap</span><span class="o">)</span> <span class="o">{</span>
      <span class="kt">int</span> <span class="n">n</span> <span class="o">=</span> <span class="n">cap</span> <span class="o">-</span> <span class="mi">1</span><span class="o">;</span>
      <span class="n">n</span> <span class="o">|=</span> <span class="n">n</span> <span class="o">&gt;&gt;&gt;</span> <span class="mi">1</span><span class="o">;</span>
      <span class="n">n</span> <span class="o">|=</span> <span class="n">n</span> <span class="o">&gt;&gt;&gt;</span> <span class="mi">2</span><span class="o">;</span>
      <span class="n">n</span> <span class="o">|=</span> <span class="n">n</span> <span class="o">&gt;&gt;&gt;</span> <span class="mi">4</span><span class="o">;</span>
      <span class="n">n</span> <span class="o">|=</span> <span class="n">n</span> <span class="o">&gt;&gt;&gt;</span> <span class="mi">8</span><span class="o">;</span>
      <span class="n">n</span> <span class="o">|=</span> <span class="n">n</span> <span class="o">&gt;&gt;&gt;</span> <span class="mi">16</span><span class="o">;</span>
      <span class="k">return</span> <span class="o">(</span><span class="n">n</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="o">)</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">:</span> <span class="o">(</span><span class="n">n</span> <span class="o">&gt;=</span> <span class="no">MAXIMUM_CAPACITY</span><span class="o">)</span> <span class="o">?</span> <span class="no">MAXIMUM_CAPACITY</span> <span class="o">:</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="o">;</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="qlist qanda">
<ol>
<li>
<p><em>è¿™é‡Œå¯èƒ½è¿˜æœ‰ä¸€ä¸ªç–‘é—®ï¼Œæ˜æ˜ç»™çš„æ˜¯åˆå§‹å®¹é‡ï¼Œä¸ºä»€ä¹ˆè¦è®¡ç®—é˜€å€¼ï¼Œè€Œä¸æ˜¯å®¹é‡å‘¢ï¼Ÿ</em></p>
<p>å…¶å®è¿™ä¹Ÿæ˜¯jdk1.8çš„æ”¹å˜ï¼Œå®ƒå°†tableçš„åˆå§‹åŒ–æ”¾å…¥äº†resize()ä¸­ï¼Œè€Œä¸”å‹æ ¹å°±æ²¡æœ‰capacityè¿™ä¸ªå±æ€§ï¼Œ
æ‰€ä»¥è¿™é‡Œåªèƒ½é‡æ–°è®¡ç®—thresholdï¼Œè€Œresize()åé¢å°±ä¼šæ ¹æ®thresholdæ¥é‡æ–°è®¡ç®—capacityï¼Œæ¥è¿›è¡Œ
tableæ•°ç»„çš„åˆå§‹åŒ–ï¼Œç„¶ååœ¨é‡æ–°æŒ‰ç…§è£…è½½å› å­è®¡ç®—thresholdã€‚</p>
</li>
</ol>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
å¯ä»¥æŒ‡å®šåˆå§‹å®¹é‡ï¼Œä»¥åŠè£…è½½å› å­ï¼Œä½†æ˜¯ä¸€èˆ¬æƒ…å†µä¸‹æŒ‡å®šè£…è½½å› å­æ„ä¹‰ä¸å¤§ï¼Œé‡‡ç”¨é»˜è®¤0.75å°±å¯ä»¥ã€‚
</td>
</tr>
</table>
</div>
<div class="ulist">
<ul>
<li>
<p>æŒ‡å®šåˆå§‹å®¹é‡çš„æ„é€ å‡½æ•°HashMap(int initialCapacity)</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">public</span> <span class="nf">HashMap</span><span class="o">(</span><span class="kt">int</span> <span class="n">initialCapacity</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">(</span><span class="n">initialCapacity</span><span class="o">,</span> <span class="no">DEFAULT_LOAD_FACTOR</span><span class="o">);</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
ç”¨è¿™ç§æ„é€ å‡½æ•°åˆ›å»ºHashMapçš„å¯¹è±¡ï¼Œå¦‚æœçŸ¥é“mapè¦å­˜æ”¾çš„å…ƒç´ ä¸ªæ•°ï¼Œå¯ä»¥ç›´æ¥æŒ‡å®šå®¹é‡çš„å¤§å°ï¼Œ
å‡é™¤ä¸åœçš„æ‰©å®¹ï¼Œæé«˜æ•ˆç‡
</td>
</tr>
</table>
</div>
<div class="ulist">
<ul>
<li>
<p>å°†å·²æœ‰Mapæ”¾å…¥å½“å‰mapçš„æ„é€ å‡½æ•°HashMap(Map&lt;? extends K, ? extends V&gt; m)</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">public</span> <span class="nf">HashMap</span><span class="o">(</span><span class="nc">Map</span><span class="o">&lt;?</span> <span class="kd">extends</span> <span class="no">K</span><span class="o">,</span> <span class="o">?</span> <span class="kd">extends</span> <span class="no">V</span><span class="o">&gt;</span> <span class="n">m</span><span class="o">)</span> <span class="o">{</span>
   <span class="k">this</span><span class="o">.</span><span class="na">loadFactor</span> <span class="o">=</span> <span class="no">DEFAULT_LOAD_FACTOR</span><span class="o">;</span>  <span class="c1">//åˆå§‹åŒ–åŠ è½½å› å­</span>
   <span class="n">putMapEntries</span><span class="o">(</span><span class="n">m</span><span class="o">,</span> <span class="kc">false</span><span class="o">);</span>
<span class="o">}</span>

<span class="c1">// å…¶å®å°±æ˜¯ä¸€ä¸ªä¸€ä¸ªå–å‡ºmä¸­çš„å…ƒç´ è°ƒç”¨putVal,ä¸€ä¸ªä¸ªæ”¾å…¥tableä¸­çš„è¿‡ç¨‹ã€‚</span>
<span class="kd">final</span> <span class="kt">void</span> <span class="nf">putMapEntries</span><span class="o">(</span><span class="nc">Map</span><span class="o">&lt;?</span> <span class="kd">extends</span> <span class="no">K</span><span class="o">,</span> <span class="o">?</span> <span class="kd">extends</span> <span class="no">V</span><span class="o">&gt;</span> <span class="n">m</span><span class="o">,</span> <span class="kt">boolean</span> <span class="n">evict</span><span class="o">)</span> <span class="o">{</span>
    <span class="kt">int</span> <span class="n">s</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="na">size</span><span class="o">();</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">s</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">table</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span> <span class="c1">// pre-size</span>
            <span class="kt">float</span> <span class="n">ft</span> <span class="o">=</span> <span class="o">((</span><span class="kt">float</span><span class="o">)</span><span class="n">s</span> <span class="o">/</span> <span class="n">loadFactor</span><span class="o">)</span> <span class="o">+</span> <span class="mf">1.0</span><span class="no">F</span><span class="o">;</span>
            <span class="kt">int</span> <span class="n">t</span> <span class="o">=</span> <span class="o">((</span><span class="n">ft</span> <span class="o">&lt;</span> <span class="o">(</span><span class="kt">float</span><span class="o">)</span><span class="no">MAXIMUM_CAPACITY</span><span class="o">)</span> <span class="o">?</span>
                    <span class="o">(</span><span class="kt">int</span><span class="o">)</span><span class="n">ft</span> <span class="o">:</span> <span class="no">MAXIMUM_CAPACITY</span><span class="o">);</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">t</span> <span class="o">&gt;</span> <span class="n">threshold</span><span class="o">)</span>
                <span class="n">threshold</span> <span class="o">=</span> <span class="n">tableSizeFor</span><span class="o">(</span><span class="n">t</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="k">else</span> <span class="nf">if</span> <span class="o">(</span><span class="n">s</span> <span class="o">&gt;</span> <span class="n">threshold</span><span class="o">)</span>   <span class="c1">//å¦‚æœmä¸­çš„å…ƒç´ ä¸ªæ•°å¤§äºé˜€å€¼ï¼Œè°ƒç”¨resizeè¿›è¡Œæ‰©å®¹</span>
            <span class="n">resize</span><span class="o">();</span>
        <span class="k">for</span> <span class="o">(</span><span class="nc">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;?</span> <span class="kd">extends</span> <span class="no">K</span><span class="o">,</span> <span class="o">?</span> <span class="kd">extends</span> <span class="no">V</span><span class="o">&gt;</span> <span class="n">e</span> <span class="o">:</span> <span class="n">m</span><span class="o">.</span><span class="na">entrySet</span><span class="o">())</span> <span class="o">{</span>
            <span class="no">K</span> <span class="n">key</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="na">getKey</span><span class="o">();</span>
            <span class="no">V</span> <span class="n">value</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="na">getValue</span><span class="o">();</span>
            <span class="n">putVal</span><span class="o">(</span><span class="n">hash</span><span class="o">(</span><span class="n">key</span><span class="o">),</span> <span class="n">key</span><span class="o">,</span> <span class="n">value</span><span class="o">,</span> <span class="kc">false</span><span class="o">,</span> <span class="n">evict</span><span class="o">);</span>  <span class="c1">//è°ƒç”¨putValå‘mapä¸­æ·»åŠ å…ƒç´ </span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_hashmapå­˜å–æœºåˆ¶"><a class="anchor" href="#_hashmapå­˜å–æœºåˆ¶"></a>25.8.4. HashMapå­˜å–æœºåˆ¶</h4>
<div class="sect4">
<h5 id="_1_æ·»åŠ å…ƒç´ "><a class="anchor" href="#_1_æ·»åŠ å…ƒç´ "></a>1.æ·»åŠ å…ƒç´ </h5>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">public</span> <span class="no">V</span> <span class="nf">put</span><span class="o">(</span><span class="no">K</span> <span class="n">key</span><span class="o">,</span> <span class="no">V</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="nf">putVal</span><span class="o">(</span><span class="n">hash</span><span class="o">(</span><span class="n">key</span><span class="o">),</span> <span class="n">key</span><span class="o">,</span> <span class="n">value</span><span class="o">,</span> <span class="kc">false</span><span class="o">,</span> <span class="kc">true</span><span class="o">);</span>    <span class="c1">//è°ƒç”¨putVal()æ–¹æ³•</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>JDK1.8è®¡ç®—hashå€¼</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="nf">hash</span><span class="o">(</span><span class="nc">Object</span> <span class="n">key</span><span class="o">)</span> <span class="o">{</span>
    <span class="kt">int</span> <span class="n">h</span><span class="o">;</span>
    <span class="k">return</span> <span class="o">(</span><span class="n">key</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">?</span> <span class="mi">0</span> <span class="o">:</span> <span class="o">(</span><span class="n">h</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="na">hashCode</span><span class="o">())</span> <span class="o">^</span> <span class="o">(</span><span class="n">h</span> <span class="o">&gt;&gt;&gt;</span> <span class="mi">16</span><span class="o">);</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>JDK1.7è®¡ç®—hashå€¼</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">final</span> <span class="kt">int</span> <span class="nf">hash</span><span class="o">(</span><span class="nc">Object</span> <span class="n">k</span><span class="o">)</span> <span class="o">{</span>
    <span class="kt">int</span> <span class="n">h</span> <span class="o">=</span> <span class="n">hashSeed</span><span class="o">;</span>
    <span class="k">if</span> <span class="o">(</span><span class="mi">0</span> <span class="o">!=</span> <span class="n">h</span> <span class="o">&amp;&amp;</span> <span class="n">k</span> <span class="k">instanceof</span> <span class="nc">String</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">sun</span><span class="o">.</span><span class="na">misc</span><span class="o">.</span><span class="na">Hashing</span><span class="o">.</span><span class="na">stringHash32</span><span class="o">((</span><span class="nc">String</span><span class="o">)</span> <span class="n">k</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="n">h</span> <span class="o">^=</span> <span class="n">k</span><span class="o">.</span><span class="na">hashCode</span><span class="o">();</span>
    <span class="n">h</span> <span class="o">^=</span> <span class="o">(</span><span class="n">h</span> <span class="o">&gt;&gt;&gt;</span> <span class="mi">20</span><span class="o">)</span> <span class="o">^</span> <span class="o">(</span><span class="n">h</span> <span class="o">&gt;&gt;&gt;</span> <span class="mi">12</span><span class="o">);</span>
    <span class="k">return</span> <span class="n">h</span> <span class="o">^</span> <span class="o">(</span><span class="n">h</span> <span class="o">&gt;&gt;&gt;</span> <span class="mi">7</span><span class="o">)</span> <span class="o">^</span> <span class="o">(</span><span class="n">h</span> <span class="o">&gt;&gt;&gt;</span> <span class="mi">4</span><span class="o">);</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
JDK1.8è®¡ç®—hashå€¼çš„æ–¹æ³•è¿›è¡Œäº†æ”¹è¿›ï¼Œå–å¾—keyçš„hashcodeåï¼Œé«˜16ä½ä¸ä½16ä½å¼‚æˆ–è¿ç®—é‡æ–°è®¡ç®—hashå€¼ã€‚
keyæœ‰å¯èƒ½æ˜¯nullï¼Œkeyä¸ºnullæ—¶ï¼Œhashå€¼ä¸º0ï¼Œæ”¾åœ¨æ•°ç»„çš„0ä½ç½®ã€‚
</td>
</tr>
</table>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">putVal()æ–¹æ³•</dt>
<dd>
<p>æ‰§è¡Œè¿‡ç¨‹å¦‚å›¾ï¼š</p>
</dd>
</dl>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/hashmap_put.png" alt="hashmap put">
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">final</span> <span class="no">V</span> <span class="nf">putVal</span><span class="o">(</span><span class="kt">int</span> <span class="n">hash</span><span class="o">,</span> <span class="no">K</span> <span class="n">key</span><span class="o">,</span> <span class="no">V</span> <span class="n">value</span><span class="o">,</span> <span class="kt">boolean</span> <span class="n">onlyIfAbsent</span><span class="o">,</span> <span class="kt">boolean</span> <span class="n">evict</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">Node</span><span class="o">&lt;</span><span class="no">K</span><span class="o">,</span><span class="no">V</span><span class="o">&gt;[]</span> <span class="n">tab</span><span class="o">;</span> <span class="nc">Node</span><span class="o">&lt;</span><span class="no">K</span><span class="o">,</span><span class="no">V</span><span class="o">&gt;</span> <span class="n">p</span><span class="o">;</span> <span class="kt">int</span> <span class="n">n</span><span class="o">,</span> <span class="n">i</span><span class="o">;</span>
    <span class="c1">//tableæœªåˆå§‹åŒ–æˆ–è€…é•¿åº¦ä¸º0ï¼Œè¿›è¡Œæ‰©å®¹</span>
    <span class="k">if</span> <span class="o">((</span><span class="n">tab</span> <span class="o">=</span> <span class="n">table</span><span class="o">)</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> <span class="o">(</span><span class="n">n</span> <span class="o">=</span> <span class="n">tab</span><span class="o">.</span><span class="na">length</span><span class="o">)</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span>
        <span class="c1">//å¯ä»¥çœ‹åˆ°putå…ƒç´ æ—¶ï¼Œå¦‚æœæ•°ç»„æ²¡æœ‰åˆå§‹åŒ–ï¼Œä¼šè°ƒç”¨resize()æ–¹æ³•è¿›è¡Œåˆå§‹åŒ–ã€‚åé¢åˆ†æresize()æ–¹æ³•</span>
        <span class="n">n</span> <span class="o">=</span> <span class="o">(</span><span class="n">tab</span> <span class="o">=</span> <span class="n">resize</span><span class="o">()).</span><span class="na">length</span><span class="o">;</span>

    <span class="cm">/*
     * è¿™é‡Œå°±æ˜¯HASHç®—æ³•äº†ï¼Œç”¨æ¥å®šä½æ¡¶ä½çš„æ–¹å¼ï¼Œå¯ä»¥çœ‹åˆ°æ˜¯é‡‡ç”¨å®¹é‡-1å’Œé”®çš„hashå€¼è¿›è¡Œä¸è¿ç®—
     * n-1,çš„åŸå› å°±æ˜¯nä¸€å®šæ˜¯ä¸€ä¸ª2çš„æ•´æ•°å¹‚ï¼Œè€Œ(n - 1) &amp; hashå…¶å®è´¨å°±æ˜¯n%hash,ä½†æ˜¯å–ä½™è¿ç®—
     * çš„æ•ˆç‡æ˜æ˜¾ä¸å¦‚ä½è¿ç®—ä¸ï¼Œå¹¶ä¸”(n - 1) &amp; hashä¹Ÿèƒ½ä¿è¯æ•£åˆ—å‡åŒ€ï¼Œä¸ä¼šäº§ç”Ÿåªæœ‰å¶æ•°ä½æœ‰å€¼çš„ç°è±¡
     */</span>
    <span class="k">if</span> <span class="o">((</span><span class="n">p</span> <span class="o">=</span> <span class="n">tab</span><span class="o">[</span><span class="n">i</span> <span class="o">=</span> <span class="o">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="o">)</span> <span class="o">&amp;</span> <span class="n">hash</span><span class="o">])</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span>
        <span class="cm">/*
         * å½“è¿™é‡Œæ˜¯ç©ºæ¡¶ä½æ—¶ï¼Œå°±ç›´æ¥æ„é€ æ–°çš„NodeèŠ‚ç‚¹ï¼Œå°†å…¶æ”¾å…¥æ¡¶ä½ä¸­(æ­¤æ—¶ï¼Œè¿™ä¸ªç»“ç‚¹æ˜¯æ”¾åœ¨æ•°ç»„ä¸­)
         * newNode()æ–¹æ³•ï¼Œå°±æ˜¯å¯¹new Node(,,,)çš„åŒ…è£…,åŒæ—¶ä¹Ÿå¯ä»¥çœ‹åˆ°Nodeä¸­çš„hashå€¼å°±æ˜¯é‡æ–°è®¡ç®—çš„hash(key)
         */</span>
        <span class="n">tab</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">=</span> <span class="n">newNode</span><span class="o">(</span><span class="n">hash</span><span class="o">,</span> <span class="n">key</span><span class="o">,</span> <span class="n">value</span><span class="o">,</span> <span class="kc">null</span><span class="o">);</span>
    <span class="k">else</span> <span class="o">{</span>
        <span class="c1">//æ¡¶ä¸­å·²ç»å­˜åœ¨å…ƒç´ </span>
        <span class="nc">Node</span><span class="o">&lt;</span><span class="no">K</span><span class="o">,</span><span class="no">V</span><span class="o">&gt;</span> <span class="n">e</span><span class="o">;</span> <span class="no">K</span> <span class="n">k</span><span class="o">;</span>
        <span class="c1">// æ¯”è¾ƒæ¡¶ä¸­ç¬¬ä¸€ä¸ªå…ƒç´ (æ•°ç»„ä¸­çš„ç»“ç‚¹)çš„hashå€¼ç›¸ç­‰ï¼Œkeyç›¸ç­‰</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">p</span><span class="o">.</span><span class="na">hash</span> <span class="o">==</span> <span class="n">hash</span> <span class="o">&amp;&amp;</span> <span class="o">((</span><span class="n">k</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="na">key</span><span class="o">)</span> <span class="o">==</span> <span class="n">key</span> <span class="o">||</span> <span class="o">(</span><span class="n">key</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="n">key</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">k</span><span class="o">))))</span>
            <span class="c1">//æ¯”è¾ƒæ¡¶ä¸­ç¬¬ä¸€ä¸ªå…ƒç´ (æ•°ç»„ä¸­çš„ç»“ç‚¹)çš„hashå€¼ç›¸ç­‰ï¼Œkeyç›¸ç­‰</span>
            <span class="n">e</span> <span class="o">=</span> <span class="n">p</span><span class="o">;</span>
        <span class="k">else</span> <span class="nf">if</span> <span class="o">(</span><span class="n">p</span> <span class="k">instanceof</span> <span class="nc">TreeNode</span><span class="o">)</span>
            <span class="c1">// hashå€¼ä¸ç›¸ç­‰ï¼Œå³keyä¸ç›¸ç­‰ï¼›ä¸ºçº¢é»‘æ ‘ç»“ç‚¹</span>
            <span class="n">e</span> <span class="o">=</span> <span class="o">((</span><span class="nc">TreeNode</span><span class="o">&lt;</span><span class="no">K</span><span class="o">,</span><span class="no">V</span><span class="o">&gt;)</span><span class="n">p</span><span class="o">).</span><span class="na">putTreeVal</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="n">tab</span><span class="o">,</span> <span class="n">hash</span><span class="o">,</span> <span class="n">key</span><span class="o">,</span> <span class="n">value</span><span class="o">);</span>  <span class="c1">// æ”¾å…¥æ ‘ä¸­</span>
        <span class="k">else</span> <span class="o">{</span>
            <span class="c1">// ä¸ºé“¾è¡¨ç»“ç‚¹</span>
            <span class="c1">// åœ¨é“¾è¡¨æœ€æœ«æ’å…¥ç»“ç‚¹</span>
            <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">binCount</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="o">;</span> <span class="o">++</span><span class="n">binCount</span><span class="o">)</span> <span class="o">{</span>
              <span class="c1">// åˆ°è¾¾é“¾è¡¨çš„å°¾éƒ¨</span>
                <span class="k">if</span> <span class="o">((</span><span class="n">e</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="na">next</span><span class="o">)</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
                    <span class="c1">// åœ¨å°¾éƒ¨æ’å…¥æ–°ç»“ç‚¹</span>
                    <span class="n">p</span><span class="o">.</span><span class="na">next</span> <span class="o">=</span> <span class="n">newNode</span><span class="o">(</span><span class="n">hash</span><span class="o">,</span> <span class="n">key</span><span class="o">,</span> <span class="n">value</span><span class="o">,</span> <span class="kc">null</span><span class="o">);</span>
                    <span class="c1">// ç»“ç‚¹æ•°é‡è¾¾åˆ°é˜ˆå€¼ï¼Œè½¬åŒ–ä¸ºçº¢é»‘æ ‘</span>
                    <span class="k">if</span> <span class="o">(</span><span class="n">binCount</span> <span class="o">&gt;=</span> <span class="no">TREEIFY_THRESHOLD</span> <span class="o">-</span> <span class="mi">1</span><span class="o">)</span> <span class="c1">// -1 for 1st</span>
                        <span class="n">treeifyBin</span><span class="o">(</span><span class="n">tab</span><span class="o">,</span> <span class="n">hash</span><span class="o">);</span>
                    <span class="k">break</span><span class="o">;</span> <span class="c1">// è·³å‡ºå¾ªç¯</span>
                <span class="o">}</span>
                <span class="c1">// åˆ¤æ–­é“¾è¡¨ä¸­ç»“ç‚¹çš„keyå€¼ä¸æ’å…¥çš„å…ƒç´ çš„keyå€¼æ˜¯å¦ç›¸ç­‰</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">e</span><span class="o">.</span><span class="na">hash</span> <span class="o">==</span> <span class="n">hash</span> <span class="o">&amp;&amp;</span> <span class="o">((</span><span class="n">k</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="na">key</span><span class="o">)</span> <span class="o">==</span> <span class="n">key</span> <span class="o">||</span> <span class="o">(</span><span class="n">key</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="n">key</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">k</span><span class="o">))))</span>
                    <span class="k">break</span><span class="o">;</span>   <span class="c1">// ç›¸ç­‰ï¼Œè·³å‡ºå¾ªç¯</span>
                <span class="c1">// ç”¨äºéå†æ¡¶ä¸­çš„é“¾è¡¨ï¼Œä¸å‰é¢çš„e = p.nextç»„åˆï¼Œå¯ä»¥éå†é“¾è¡¨</span>
                <span class="n">p</span> <span class="o">=</span> <span class="n">e</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">}</span>
        <span class="c1">// è¡¨ç¤ºåœ¨æ¡¶ä¸­æ‰¾åˆ°keyå€¼ã€hashå€¼ä¸æ’å…¥å…ƒç´ ç›¸ç­‰çš„ç»“ç‚¹</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">e</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span> <span class="c1">// existing mapping for key</span>
            <span class="no">V</span> <span class="n">oldValue</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="na">value</span><span class="o">;</span>  <span class="c1">// è®°å½•eçš„value</span>
            <span class="c1">// onlyIfAbsentä¸ºfalseæˆ–è€…æ—§å€¼ä¸ºnull</span>
            <span class="k">if</span> <span class="o">(!</span><span class="n">onlyIfAbsent</span> <span class="o">||</span> <span class="n">oldValue</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span>
                <span class="n">e</span><span class="o">.</span><span class="na">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">;</span>  <span class="c1">//ç”¨æ–°å€¼æ›¿æ¢æ—§å€¼</span>
            <span class="n">afterNodeAccess</span><span class="o">(</span><span class="n">e</span><span class="o">);</span>   <span class="c1">// è®¿é—®åå›è°ƒ</span>
            <span class="k">return</span> <span class="n">oldValue</span><span class="o">;</span>      <span class="c1">// è¿”å›æ—§å€¼</span>
        <span class="o">}</span>
    <span class="o">}</span>
    <span class="c1">// ç»“æ„æ€§ä¿®æ”¹</span>
    <span class="o">++</span><span class="n">modCount</span><span class="o">;</span>
    <span class="c1">// å®é™…å¤§å°å¤§äºé˜ˆå€¼åˆ™æ‰©å®¹</span>
    <span class="k">if</span> <span class="o">(++</span><span class="n">size</span> <span class="o">&gt;</span> <span class="n">threshold</span><span class="o">)</span>
        <span class="n">resize</span><span class="o">();</span>
    <span class="n">afterNodeInsertion</span><span class="o">(</span><span class="n">evict</span><span class="o">);</span>  <span class="c1">// æ’å…¥åå›è°ƒ</span>
    <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>  <span class="c1">// è¿”å›null</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">resize()æ–¹æ³•</dt>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">final</span> <span class="nc">Node</span><span class="o">&lt;</span><span class="no">K</span><span class="o">,</span><span class="no">V</span><span class="o">&gt;[]</span> <span class="nf">resize</span><span class="o">()</span> <span class="o">{</span>
    <span class="c1">// å½“å‰tableä¿å­˜</span>
    <span class="nc">Node</span><span class="o">&lt;</span><span class="no">K</span><span class="o">,</span><span class="no">V</span><span class="o">&gt;[]</span> <span class="n">oldTab</span> <span class="o">=</span> <span class="n">table</span><span class="o">;</span>
    <span class="c1">// ä¿å­˜tableå¤§å°</span>
    <span class="kt">int</span> <span class="n">oldCap</span> <span class="o">=</span> <span class="o">(</span><span class="n">oldTab</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">?</span> <span class="mi">0</span> <span class="o">:</span> <span class="n">oldTab</span><span class="o">.</span><span class="na">length</span><span class="o">;</span>
    <span class="c1">// ä¿å­˜å½“å‰é˜ˆå€¼</span>
    <span class="kt">int</span> <span class="n">oldThr</span> <span class="o">=</span> <span class="n">threshold</span><span class="o">;</span>
    <span class="kt">int</span> <span class="n">newCap</span><span class="o">,</span> <span class="n">newThr</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
    <span class="c1">// ä¹‹å‰tableå¤§å°å¤§äº0</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">oldCap</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// ä¹‹å‰tableå¤§äºæœ€å¤§å®¹é‡</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">oldCap</span> <span class="o">&gt;=</span> <span class="no">MAXIMUM_CAPACITY</span><span class="o">)</span> <span class="o">{</span>
            <span class="c1">// é˜ˆå€¼ä¸ºæœ€å¤§æ•´å½¢</span>
            <span class="n">threshold</span> <span class="o">=</span> <span class="nc">Integer</span><span class="o">.</span><span class="na">MAX_VALUE</span><span class="o">;</span>
            <span class="k">return</span> <span class="n">oldTab</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="c1">// å®¹é‡ç¿»å€ï¼Œä½¿ç”¨å·¦ç§»ï¼Œæ•ˆç‡æ›´é«˜</span>
        <span class="k">else</span> <span class="nf">if</span> <span class="o">((</span><span class="n">newCap</span> <span class="o">=</span> <span class="n">oldCap</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="o">)</span> <span class="o">&lt;</span> <span class="no">MAXIMUM_CAPACITY</span> <span class="o">&amp;&amp;</span>
            <span class="n">oldCap</span> <span class="o">&gt;=</span> <span class="no">DEFAULT_INITIAL_CAPACITY</span><span class="o">)</span>
            <span class="c1">// é˜ˆå€¼ç¿»å€</span>
            <span class="n">newThr</span> <span class="o">=</span> <span class="n">oldThr</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="o">;</span> <span class="c1">// double threshold</span>
    <span class="o">}</span>
    <span class="c1">// ä¹‹å‰é˜ˆå€¼å¤§äº0</span>
    <span class="k">else</span> <span class="nf">if</span> <span class="o">(</span><span class="n">oldThr</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">)</span>
        <span class="n">newCap</span> <span class="o">=</span> <span class="n">oldThr</span><span class="o">;</span>
    <span class="c1">// oldCap = 0å¹¶ä¸”oldThr = 0ï¼Œä½¿ç”¨ç¼ºçœå€¼ï¼ˆå¦‚ä½¿ç”¨HashMap()æ„é€ å‡½æ•°ï¼Œä¹‹åå†æ’å…¥ä¸€ä¸ªå…ƒç´ ä¼šè°ƒç”¨resizeå‡½æ•°ï¼Œä¼šè¿›å…¥è¿™ä¸€æ­¥ï¼‰</span>
    <span class="k">else</span> <span class="o">{</span>
        <span class="n">newCap</span> <span class="o">=</span> <span class="no">DEFAULT_INITIAL_CAPACITY</span><span class="o">;</span>
        <span class="n">newThr</span> <span class="o">=</span> <span class="o">(</span><span class="kt">int</span><span class="o">)(</span><span class="no">DEFAULT_LOAD_FACTOR</span> <span class="o">*</span> <span class="no">DEFAULT_INITIAL_CAPACITY</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="c1">// æ–°é˜ˆå€¼ä¸º0</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">newThr</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
        <span class="kt">float</span> <span class="n">ft</span> <span class="o">=</span> <span class="o">(</span><span class="kt">float</span><span class="o">)</span><span class="n">newCap</span> <span class="o">*</span> <span class="n">loadFactor</span><span class="o">;</span>
        <span class="n">newThr</span> <span class="o">=</span> <span class="o">(</span><span class="n">newCap</span> <span class="o">&lt;</span> <span class="no">MAXIMUM_CAPACITY</span> <span class="o">&amp;&amp;</span> <span class="n">ft</span> <span class="o">&lt;</span> <span class="o">(</span><span class="kt">float</span><span class="o">)</span><span class="no">MAXIMUM_CAPACITY</span> <span class="o">?</span>
                  <span class="o">(</span><span class="kt">int</span><span class="o">)</span><span class="n">ft</span> <span class="o">:</span> <span class="nc">Integer</span><span class="o">.</span><span class="na">MAX_VALUE</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="n">threshold</span> <span class="o">=</span> <span class="n">newThr</span><span class="o">;</span>
    <span class="nd">@SuppressWarnings</span><span class="o">({</span><span class="s">"rawtypes"</span><span class="o">,</span><span class="s">"unchecked"</span><span class="o">})</span>
    <span class="c1">// åˆå§‹åŒ–table</span>
    <span class="nc">Node</span><span class="o">&lt;</span><span class="no">K</span><span class="o">,</span><span class="no">V</span><span class="o">&gt;[]</span> <span class="n">newTab</span> <span class="o">=</span> <span class="o">(</span><span class="nc">Node</span><span class="o">&lt;</span><span class="no">K</span><span class="o">,</span><span class="no">V</span><span class="o">&gt;[])</span><span class="k">new</span> <span class="nc">Node</span><span class="o">[</span><span class="n">newCap</span><span class="o">];</span>
    <span class="n">table</span> <span class="o">=</span> <span class="n">newTab</span><span class="o">;</span>
    <span class="c1">// ä¹‹å‰çš„tableå·²ç»åˆå§‹åŒ–è¿‡</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">oldTab</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// å¤åˆ¶å…ƒç´ ï¼Œé‡æ–°è¿›è¡Œhash</span>
        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">oldCap</span><span class="o">;</span> <span class="o">++</span><span class="n">j</span><span class="o">)</span> <span class="o">{</span>
            <span class="nc">Node</span><span class="o">&lt;</span><span class="no">K</span><span class="o">,</span><span class="no">V</span><span class="o">&gt;</span> <span class="n">e</span><span class="o">;</span>
            <span class="k">if</span> <span class="o">((</span><span class="n">e</span> <span class="o">=</span> <span class="n">oldTab</span><span class="o">[</span><span class="n">j</span><span class="o">])</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">oldTab</span><span class="o">[</span><span class="n">j</span><span class="o">]</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">e</span><span class="o">.</span><span class="na">next</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span>
                    <span class="n">newTab</span><span class="o">[</span><span class="n">e</span><span class="o">.</span><span class="na">hash</span> <span class="o">&amp;</span> <span class="o">(</span><span class="n">newCap</span> <span class="o">-</span> <span class="mi">1</span><span class="o">)]</span> <span class="o">=</span> <span class="n">e</span><span class="o">;</span>
                <span class="k">else</span> <span class="nf">if</span> <span class="o">(</span><span class="n">e</span> <span class="k">instanceof</span> <span class="nc">TreeNode</span><span class="o">)</span>
                    <span class="o">((</span><span class="nc">TreeNode</span><span class="o">&lt;</span><span class="no">K</span><span class="o">,</span><span class="no">V</span><span class="o">&gt;)</span><span class="n">e</span><span class="o">).</span><span class="na">split</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="n">newTab</span><span class="o">,</span> <span class="n">j</span><span class="o">,</span> <span class="n">oldCap</span><span class="o">);</span>
                <span class="k">else</span> <span class="o">{</span> <span class="c1">// preserve order</span>
                    <span class="nc">Node</span><span class="o">&lt;</span><span class="no">K</span><span class="o">,</span><span class="no">V</span><span class="o">&gt;</span> <span class="n">loHead</span> <span class="o">=</span> <span class="kc">null</span><span class="o">,</span> <span class="n">loTail</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
                    <span class="nc">Node</span><span class="o">&lt;</span><span class="no">K</span><span class="o">,</span><span class="no">V</span><span class="o">&gt;</span> <span class="n">hiHead</span> <span class="o">=</span> <span class="kc">null</span><span class="o">,</span> <span class="n">hiTail</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
                    <span class="nc">Node</span><span class="o">&lt;</span><span class="no">K</span><span class="o">,</span><span class="no">V</span><span class="o">&gt;</span> <span class="n">next</span><span class="o">;</span>
                    <span class="c1">// å°†åŒä¸€æ¡¶ä¸­çš„å…ƒç´ æ ¹æ®(e.hash &amp; oldCap)æ˜¯å¦ä¸º0è¿›è¡Œåˆ†å‰²ï¼Œåˆ†æˆä¸¤ä¸ªä¸åŒçš„é“¾è¡¨ï¼Œå®Œæˆrehash</span>
                    <span class="k">do</span> <span class="o">{</span>
                        <span class="n">next</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="na">next</span><span class="o">;</span>
                        <span class="k">if</span> <span class="o">((</span><span class="n">e</span><span class="o">.</span><span class="na">hash</span> <span class="o">&amp;</span> <span class="n">oldCap</span><span class="o">)</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
                            <span class="k">if</span> <span class="o">(</span><span class="n">loTail</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span>
                                <span class="n">loHead</span> <span class="o">=</span> <span class="n">e</span><span class="o">;</span>
                            <span class="k">else</span>
                                <span class="n">loTail</span><span class="o">.</span><span class="na">next</span> <span class="o">=</span> <span class="n">e</span><span class="o">;</span>
                            <span class="n">loTail</span> <span class="o">=</span> <span class="n">e</span><span class="o">;</span>
                        <span class="o">}</span>
                        <span class="k">else</span> <span class="o">{</span>
                            <span class="k">if</span> <span class="o">(</span><span class="n">hiTail</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span>
                                <span class="n">hiHead</span> <span class="o">=</span> <span class="n">e</span><span class="o">;</span>
                            <span class="k">else</span>
                                <span class="n">hiTail</span><span class="o">.</span><span class="na">next</span> <span class="o">=</span> <span class="n">e</span><span class="o">;</span>
                            <span class="n">hiTail</span> <span class="o">=</span> <span class="n">e</span><span class="o">;</span>
                        <span class="o">}</span>
                    <span class="o">}</span> <span class="k">while</span> <span class="o">((</span><span class="n">e</span> <span class="o">=</span> <span class="n">next</span><span class="o">)</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">);</span>
                    <span class="k">if</span> <span class="o">(</span><span class="n">loTail</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
                        <span class="n">loTail</span><span class="o">.</span><span class="na">next</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
                        <span class="n">newTab</span><span class="o">[</span><span class="n">j</span><span class="o">]</span> <span class="o">=</span> <span class="n">loHead</span><span class="o">;</span>
                    <span class="o">}</span>
                    <span class="k">if</span> <span class="o">(</span><span class="n">hiTail</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
                        <span class="n">hiTail</span><span class="o">.</span><span class="na">next</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
                        <span class="n">newTab</span><span class="o">[</span><span class="n">j</span> <span class="o">+</span> <span class="n">oldCap</span><span class="o">]</span> <span class="o">=</span> <span class="n">hiHead</span><span class="o">;</span>
                    <span class="o">}</span>
                <span class="o">}</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="n">newTab</span><span class="o">;</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
æ‰©å®¹å®é™…ä¸Šå°±æ˜¯åˆ›å»ºä¸€ä¸ªå®¹é‡æ˜¯åŸæ¥å®¹é‡ä¸¤å€çš„æ•°ç»„ï¼Œ
æŠŠåŸæ¥æ•°ç»„ä¸­çš„å…ƒç´ ç»è¿‡é‡æ–°æ•£åˆ—ï¼Œç„¶åæ·»åŠ åˆ°æ–°çš„æ•°ç»„ä¸­ã€‚
æ‰©å®¹ä¼šä¼´éšç€ä¸€æ¬¡é‡æ–°hashåˆ†é…ï¼Œå¹¶ä¸”ä¼šéå†hashè¡¨ä¸­æ‰€æœ‰
çš„å…ƒç´ ï¼Œæ˜¯éå¸¸è€—æ—¶çš„ã€‚åœ¨ç¼–å†™ç¨‹åºä¸­ï¼Œè¦å°½é‡é¿å…resizeã€‚
</td>
</tr>
</table>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">putAll()æ–¹æ³•</dt>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">public</span> <span class="kt">void</span> <span class="nf">putAll</span><span class="o">(</span><span class="nc">Map</span><span class="o">&lt;?</span> <span class="kd">extends</span> <span class="no">K</span><span class="o">,</span> <span class="o">?</span> <span class="kd">extends</span> <span class="no">V</span><span class="o">&gt;</span> <span class="n">m</span><span class="o">)</span> <span class="o">{</span>
  <span class="c1">//å†…éƒ¨ä¹Ÿæ˜¯è°ƒç”¨putVal()æ–¹æ³•ï¼Œå°†mä¸­çš„å…ƒç´ å¾ªç¯æ”¾å…¥tableä¸­</span>
  <span class="n">putMapEntries</span><span class="o">(</span><span class="n">m</span><span class="o">,</span> <span class="kc">true</span><span class="o">);</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_è·å–å…ƒç´ "><a class="anchor" href="#_è·å–å…ƒç´ "></a>è·å–å…ƒç´ </h5>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="cm">/**
 * é€šè¿‡keyè·å–value
 */</span>
<span class="kd">public</span> <span class="no">V</span> <span class="nf">get</span><span class="o">(</span><span class="nc">Object</span> <span class="n">key</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">Node</span><span class="o">&lt;</span><span class="no">K</span><span class="o">,</span><span class="no">V</span><span class="o">&gt;</span> <span class="n">e</span><span class="o">;</span>
    <span class="k">return</span> <span class="o">(</span><span class="n">e</span> <span class="o">=</span> <span class="n">getNode</span><span class="o">(</span><span class="n">hash</span><span class="o">(</span><span class="n">key</span><span class="o">),</span> <span class="n">key</span><span class="o">))</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">?</span> <span class="kc">null</span> <span class="o">:</span> <span class="n">e</span><span class="o">.</span><span class="na">value</span><span class="o">;</span>
<span class="o">}</span>

<span class="kd">final</span> <span class="nc">Node</span><span class="o">&lt;</span><span class="no">K</span><span class="o">,</span><span class="no">V</span><span class="o">&gt;</span> <span class="nf">getNode</span><span class="o">(</span><span class="kt">int</span> <span class="n">hash</span><span class="o">,</span> <span class="nc">Object</span> <span class="n">key</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">Node</span><span class="o">&lt;</span><span class="no">K</span><span class="o">,</span><span class="no">V</span><span class="o">&gt;[]</span> <span class="n">tab</span><span class="o">;</span> <span class="nc">Node</span><span class="o">&lt;</span><span class="no">K</span><span class="o">,</span><span class="no">V</span><span class="o">&gt;</span> <span class="n">first</span><span class="o">,</span> <span class="n">e</span><span class="o">;</span> <span class="kt">int</span> <span class="n">n</span><span class="o">;</span> <span class="no">K</span> <span class="n">k</span><span class="o">;</span>
    <span class="k">if</span> <span class="o">((</span><span class="n">tab</span> <span class="o">=</span> <span class="n">table</span><span class="o">)</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="o">(</span><span class="n">n</span> <span class="o">=</span> <span class="n">tab</span><span class="o">.</span><span class="na">length</span><span class="o">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span>
        <span class="o">(</span><span class="n">first</span> <span class="o">=</span> <span class="n">tab</span><span class="o">[(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="o">)</span> <span class="o">&amp;</span> <span class="n">hash</span><span class="o">])</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">//å¦‚æœNodeé“¾è¡¨çš„ç¬¬ä¸€ä¸ªå…ƒç´ ç›¸ç­‰</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">first</span><span class="o">.</span><span class="na">hash</span> <span class="o">==</span> <span class="n">hash</span> <span class="o">&amp;&amp;</span> <span class="c1">// always check first node</span>
            <span class="o">((</span><span class="n">k</span> <span class="o">=</span> <span class="n">first</span><span class="o">.</span><span class="na">key</span><span class="o">)</span> <span class="o">==</span> <span class="n">key</span> <span class="o">||</span> <span class="o">(</span><span class="n">key</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="n">key</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">k</span><span class="o">))))</span>
            <span class="k">return</span> <span class="n">first</span><span class="o">;</span>
        <span class="k">if</span> <span class="o">((</span><span class="n">e</span> <span class="o">=</span> <span class="n">first</span><span class="o">.</span><span class="na">next</span><span class="o">)</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="c1">//çº¢é»‘æ ‘æŸ¥æ‰¾</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">first</span> <span class="k">instanceof</span> <span class="nc">TreeNode</span><span class="o">)</span>
                <span class="k">return</span> <span class="o">((</span><span class="nc">TreeNode</span><span class="o">&lt;</span><span class="no">K</span><span class="o">,</span><span class="no">V</span><span class="o">&gt;)</span><span class="n">first</span><span class="o">).</span><span class="na">getTreeNode</span><span class="o">(</span><span class="n">hash</span><span class="o">,</span> <span class="n">key</span><span class="o">);</span>
            <span class="c1">//é“¾è¡¨æŸ¥æ‰¾</span>
            <span class="k">do</span> <span class="o">{</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">e</span><span class="o">.</span><span class="na">hash</span> <span class="o">==</span> <span class="n">hash</span> <span class="o">&amp;&amp;</span>
                    <span class="o">((</span><span class="n">k</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="na">key</span><span class="o">)</span> <span class="o">==</span> <span class="n">key</span> <span class="o">||</span> <span class="o">(</span><span class="n">key</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="n">key</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">k</span><span class="o">))))</span>
                    <span class="k">return</span> <span class="n">e</span><span class="o">;</span>
            <span class="o">}</span> <span class="k">while</span> <span class="o">((</span><span class="n">e</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="na">next</span><span class="o">)</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
    <span class="c1">//æ‰¾ä¸åˆ°è¿”å›null</span>
    <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
<span class="o">}</span>

<span class="cm">/**
 * åˆ¤æ–­æ˜¯å¦åŒ…å«æŒ‡å®škey
 */</span>
<span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">containsKey</span><span class="o">(</span><span class="nc">Object</span> <span class="n">key</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="nf">getNode</span><span class="o">(</span><span class="n">hash</span><span class="o">(</span><span class="n">key</span><span class="o">),</span> <span class="n">key</span><span class="o">)</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">;</span>  <span class="c1">//è¿”å›nodeæ˜¯å¦ä¸ºnull</span>
<span class="o">}</span>

<span class="cm">/**
 * åˆ¤æ–­æ˜¯å¦åŒ…å«æŒ‡å®švalue
 */</span>
<span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">containsValue</span><span class="o">(</span><span class="nc">Object</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">Node</span><span class="o">&lt;</span><span class="no">K</span><span class="o">,</span><span class="no">V</span><span class="o">&gt;[]</span> <span class="n">tab</span><span class="o">;</span> <span class="no">V</span> <span class="n">v</span><span class="o">;</span>
    <span class="k">if</span> <span class="o">((</span><span class="n">tab</span> <span class="o">=</span> <span class="n">table</span><span class="o">)</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="n">size</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">tab</span><span class="o">.</span><span class="na">length</span><span class="o">;</span> <span class="o">++</span><span class="n">i</span><span class="o">)</span> <span class="o">{</span>
            <span class="c1">//æŒ‰ç…§å•é“¾è¡¨çš„æ–¹å¼è¿›è¡Œéå†ï¼Œ</span>
            <span class="c1">//å› ä¸ºHashMapä¸­ TreeNode èŠ‚ç‚¹ä¹Ÿå­˜åœ¨nextæˆå‘˜ï¼Œå¯ä»¥ç”¨é“¾è¡¨çš„æ–¹å¼è¿›è¡Œéå†</span>
            <span class="k">for</span> <span class="o">(</span><span class="nc">Node</span><span class="o">&lt;</span><span class="no">K</span><span class="o">,</span><span class="no">V</span><span class="o">&gt;</span> <span class="n">e</span> <span class="o">=</span> <span class="n">tab</span><span class="o">[</span><span class="n">i</span><span class="o">];</span> <span class="n">e</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">;</span> <span class="n">e</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="na">next</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">if</span> <span class="o">((</span><span class="n">v</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="na">value</span><span class="o">)</span> <span class="o">==</span> <span class="n">value</span> <span class="o">||</span>
                        <span class="o">(</span><span class="n">value</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="n">value</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">v</span><span class="o">)))</span>
                    <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
getæ–¹æ³•ç›¸å¯¹putè¦ç®€å•çš„å¤šï¼Œåˆ†ææºç å¯ä»¥çœ‹å‡ºhashç®—æ³•çš„ç²¾é«“ï¼Œä¸ç”¨éå†å°±å¯ä»¥ç›´æ¥é€šè¿‡
è®¡ç®—keyçš„hashå€¼ï¼Œå¾—åˆ°æŸ¥æ‰¾å…ƒç´ åœ¨æ•°ç»„ä¸­çš„æ¡¶ä½ï¼Œç„¶åæ¯”è¾ƒhashå€¼ã€keyæ˜¯å¦ç›¸ç­‰æ¥è·å–nodeã€‚
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_ç§»é™¤å…ƒç´ "><a class="anchor" href="#_ç§»é™¤å…ƒç´ "></a>ç§»é™¤å…ƒç´ </h5>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">public</span> <span class="no">V</span> <span class="nf">remove</span><span class="o">(</span><span class="nc">Object</span> <span class="n">key</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">Node</span><span class="o">&lt;</span><span class="no">K</span><span class="o">,</span><span class="no">V</span><span class="o">&gt;</span> <span class="n">e</span><span class="o">;</span>
    <span class="k">return</span> <span class="o">(</span><span class="n">e</span> <span class="o">=</span> <span class="n">removeNode</span><span class="o">(</span><span class="n">hash</span><span class="o">(</span><span class="n">key</span><span class="o">),</span> <span class="n">key</span><span class="o">,</span> <span class="kc">null</span><span class="o">,</span> <span class="kc">false</span><span class="o">,</span> <span class="kc">true</span><span class="o">))</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">?</span> <span class="kc">null</span> <span class="o">:</span> <span class="n">e</span><span class="o">.</span><span class="na">value</span><span class="o">;</span>
<span class="o">}</span>

<span class="kd">final</span> <span class="nc">Node</span><span class="o">&lt;</span><span class="no">K</span><span class="o">,</span><span class="no">V</span><span class="o">&gt;</span> <span class="nf">removeNode</span><span class="o">(</span><span class="kt">int</span> <span class="n">hash</span><span class="o">,</span> <span class="nc">Object</span> <span class="n">key</span><span class="o">,</span> <span class="nc">Object</span> <span class="n">value</span><span class="o">,</span>
                           <span class="kt">boolean</span> <span class="n">matchValue</span><span class="o">,</span> <span class="kt">boolean</span> <span class="n">movable</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">Node</span><span class="o">&lt;</span><span class="no">K</span><span class="o">,</span><span class="no">V</span><span class="o">&gt;[]</span> <span class="n">tab</span><span class="o">;</span> <span class="nc">Node</span><span class="o">&lt;</span><span class="no">K</span><span class="o">,</span><span class="no">V</span><span class="o">&gt;</span> <span class="n">p</span><span class="o">;</span> <span class="kt">int</span> <span class="n">n</span><span class="o">,</span> <span class="n">index</span><span class="o">;</span>
    <span class="k">if</span> <span class="o">((</span><span class="n">tab</span> <span class="o">=</span> <span class="n">table</span><span class="o">)</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="o">(</span><span class="n">n</span> <span class="o">=</span> <span class="n">tab</span><span class="o">.</span><span class="na">length</span><span class="o">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span>
        <span class="o">(</span><span class="n">p</span> <span class="o">=</span> <span class="n">tab</span><span class="o">[</span><span class="n">index</span> <span class="o">=</span> <span class="o">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="o">)</span> <span class="o">&amp;</span> <span class="n">hash</span><span class="o">])</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">//nodeå°±æ˜¯è¦æŸ¥æ‰¾çš„ç»“ç‚¹</span>
        <span class="nc">Node</span><span class="o">&lt;</span><span class="no">K</span><span class="o">,</span><span class="no">V</span><span class="o">&gt;</span> <span class="n">node</span> <span class="o">=</span> <span class="kc">null</span><span class="o">,</span> <span class="n">e</span><span class="o">;</span> <span class="no">K</span> <span class="n">k</span><span class="o">;</span> <span class="no">V</span> <span class="n">v</span><span class="o">;</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">p</span><span class="o">.</span><span class="na">hash</span> <span class="o">==</span> <span class="n">hash</span> <span class="o">&amp;&amp;</span>
            <span class="o">((</span><span class="n">k</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="na">key</span><span class="o">)</span> <span class="o">==</span> <span class="n">key</span> <span class="o">||</span> <span class="o">(</span><span class="n">key</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="n">key</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">k</span><span class="o">))))</span>
            <span class="n">node</span> <span class="o">=</span> <span class="n">p</span><span class="o">;</span>
        <span class="k">else</span> <span class="nf">if</span> <span class="o">((</span><span class="n">e</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="na">next</span><span class="o">)</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">p</span> <span class="k">instanceof</span> <span class="nc">TreeNode</span><span class="o">)</span>
                <span class="n">node</span> <span class="o">=</span> <span class="o">((</span><span class="nc">TreeNode</span><span class="o">&lt;</span><span class="no">K</span><span class="o">,</span><span class="no">V</span><span class="o">&gt;)</span><span class="n">p</span><span class="o">).</span><span class="na">getTreeNode</span><span class="o">(</span><span class="n">hash</span><span class="o">,</span> <span class="n">key</span><span class="o">);</span>
            <span class="k">else</span> <span class="o">{</span>
                <span class="k">do</span> <span class="o">{</span>
                    <span class="k">if</span> <span class="o">(</span><span class="n">e</span><span class="o">.</span><span class="na">hash</span> <span class="o">==</span> <span class="n">hash</span> <span class="o">&amp;&amp;</span>
                        <span class="o">((</span><span class="n">k</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="na">key</span><span class="o">)</span> <span class="o">==</span> <span class="n">key</span> <span class="o">||</span>
                         <span class="o">(</span><span class="n">key</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="n">key</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">k</span><span class="o">))))</span> <span class="o">{</span>
                        <span class="n">node</span> <span class="o">=</span> <span class="n">e</span><span class="o">;</span>
                        <span class="k">break</span><span class="o">;</span>
                    <span class="o">}</span>
                    <span class="c1">//è¿™é‡Œpä¿å­˜çš„æ˜¯çˆ¶èŠ‚ç‚¹ï¼Œå› ä¸ºè¿™é‡Œæ¶‰åŠåˆ°é“¾è¡¨åˆ é™¤çš„æ“ä½œ</span>
                    <span class="n">p</span> <span class="o">=</span> <span class="n">e</span><span class="o">;</span>
                <span class="o">}</span> <span class="k">while</span> <span class="o">((</span><span class="n">e</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="na">next</span><span class="o">)</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">}</span>
        <span class="cm">/*
         * å½“matchValueä¸ºfalseæ—¶ï¼Œç›´æ¥çŸ­è·¯åé¢çš„è¿ç®—ï¼Œ
         * è¿›è¡Œåˆ é™¤æ“ä½œï¼Œè€Œä¸ç”¨å…³æ³¨valueå€¼æ˜¯å¦ç›¸ç­‰æˆ–è€…equals
         */</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">node</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="o">(!</span><span class="n">matchValue</span> <span class="o">||</span> <span class="o">(</span><span class="n">v</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="na">value</span><span class="o">)</span> <span class="o">==</span> <span class="n">value</span> <span class="o">||</span>
                             <span class="o">(</span><span class="n">value</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="n">value</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">v</span><span class="o">))))</span> <span class="o">{</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">node</span> <span class="k">instanceof</span> <span class="nc">TreeNode</span><span class="o">)</span>
                <span class="c1">//movableç”¨åœ¨æ ‘çš„åˆ é™¤ä¸Š</span>
                <span class="o">((</span><span class="nc">TreeNode</span><span class="o">&lt;</span><span class="no">K</span><span class="o">,</span><span class="no">V</span><span class="o">&gt;)</span><span class="n">node</span><span class="o">).</span><span class="na">removeTreeNode</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="n">tab</span><span class="o">,</span> <span class="n">movable</span><span class="o">);</span>
            <span class="k">else</span> <span class="nf">if</span> <span class="o">(</span><span class="n">node</span> <span class="o">==</span> <span class="n">p</span><span class="o">)</span>
                 <span class="c1">//è¦åˆ é™¤èŠ‚ç‚¹å°±æ˜¯é“¾è¡¨çš„å¤´èŠ‚ç‚¹ï¼Œåˆ™å°†å­èŠ‚ç‚¹æ”¾è¿›æ¡¶ä½</span>
                <span class="n">tab</span><span class="o">[</span><span class="n">index</span><span class="o">]</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="na">next</span><span class="o">;</span>
            <span class="k">else</span>
                <span class="c1">//åˆ é™¤èŠ‚ç‚¹åèŠ‚ç‚¹ï¼Œçˆ¶èŠ‚ç‚¹çš„nexté‡æ–°è¿æ¥</span>
                <span class="n">p</span><span class="o">.</span><span class="na">next</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="na">next</span><span class="o">;</span>
            <span class="o">++</span><span class="n">modCount</span><span class="o">;</span> <span class="c1">//åˆ é™¤æ“ä½œä¹Ÿæ˜¯è¦è®°å½•è¿›modCount</span>
            <span class="o">--</span><span class="n">size</span><span class="o">;</span>
            <span class="n">afterNodeRemoval</span><span class="o">(</span><span class="n">node</span><span class="o">);</span>
            <span class="k">return</span> <span class="n">node</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
<span class="o">}</span>

<span class="cm">/**
 * jdk1.8æ–°å¢çš„é‡è½½æ–¹æ³•ï¼ŒmatchValueä¸ºtrueæ—¶ï¼Œ
 * åªæœ‰å½“keyå’Œvalueéƒ½ç›¸ç­‰æ—¶ï¼Œæ‰ä¼šåˆ é™¤
 */</span>
<span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">remove</span><span class="o">(</span><span class="nc">Object</span> <span class="n">key</span><span class="o">,</span> <span class="nc">Object</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="nf">removeNode</span><span class="o">(</span><span class="n">hash</span><span class="o">(</span><span class="n">key</span><span class="o">),</span> <span class="n">key</span><span class="o">,</span> <span class="n">value</span><span class="o">,</span> <span class="kc">true</span><span class="o">,</span> <span class="kc">true</span><span class="o">)</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">;</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_å°ç»“"><a class="anchor" href="#_å°ç»“"></a>25.9. å°ç»“</h3>
<div class="paragraph">
<p>æœ¬æ–‡å¯¹JDK1.8 HashMapçš„åŸä»£ç è¿›è¡Œäº†ç®€è¦çš„åˆ†æï¼Œä¸»è¦ç›®çš„æ˜¯äº†è§£å…¶å†…éƒ¨çš„
å­˜å‚¨æœºåˆ¶å’Œå®ç°åŸç†ï¼Œä»è€Œè¾¾åˆ°åœ¨ç¼–ç¨‹ä¸­æ›´é«˜æ•ˆçš„ä½¿ç”¨HashMapã€‚<br></p>
</div>
<div class="paragraph">
<p>HashMap å†…éƒ¨æ˜¯åŸºäºä¸€ä¸ªæ•°ç»„æ¥å®ç°çš„ï¼Œæ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ ç§°ä¸ºä¸€ä¸ªæ¡¶(bucket)ã€‚
å½“æ•°ç»„ä¸­è¢«å ç”¨çš„æ¡¶çš„æ•°é‡è¶…è¿‡äº†è£…è½½å› å­å’Œæ•°ç»„å®¹é‡è®¾å®šçš„é˜ˆå€¼åï¼Œä¼šå¯¹æ•°ç»„è¿›è¡Œæ‰©å®¹ï¼Œ
å®¹é‡å°†æ‰©å±•ä¸ºåŸæ¥çš„2å€ã€‚å“ˆå¸Œè¡¨ä¸­æ‰€æœ‰çš„ Entry ä¼šè¢«é‡æ–°æ•£åˆ—åˆ°æ–°çš„ä½ç½®ä¸­ã€‚<br></p>
</div>
<div class="paragraph">
<p>å› ä¸ºä¸¤ä¸ªä¸åŒçš„keyåœ¨æ•£åˆ—æ—¶æœ‰å¯èƒ½å‘ç”Ÿå†²çªï¼ŒHashMapä¸ºäº†é¿å…å“ˆå¸Œå†²çªå¸¦æ¥çš„å½±å“
åšäº†å‡ ç‚¹ä¼˜åŒ–ã€‚åœ¨è¿›è¡Œæ•£åˆ—å¤„ç†æ—¶ï¼Œå°†é«˜ä½ä¸ä½ä½è¿›è¡Œå¼‚æˆ–ï¼Œä»è€Œå‡å°å†²çªçš„æ¦‚ç‡ã€‚
å½“ä¸åŒçš„nodeè¢«æ•£åˆ—åˆ°åŒä¸€ä¸ªæ¡¶ä¸­æ—¶ï¼Œæ¯ä¸ªæ¡¶ä¸­ä½¿ç”¨å•å‘é“¾è¡¨çš„æ–¹å¼æ¥ä¿å­˜æ•°æ®ã€‚
åœ¨Java 8 çš„å®ç°ä¸­ï¼Œå¦‚æœä¸€ä¸ªæ¡¶ä¸­çš„Nodeæ•°é‡è¶…è¿‡äº†é˜ˆå€¼(TREEIFY_THRESHOLD = 8)ï¼Œ
å°±ä¼šå°†å•é“¾è¡¨è½¬åŒ–ä¸ºçº¢é»‘æ ‘ï¼Œå½“ä½äºé˜ˆå€¼(UNTREEIFY_THRESHOLD = 6)æ—¶é‡æ–°è½¬åŒ–ä¸º
å•é“¾è¡¨ã€‚<br></p>
</div>
<div class="paragraph">
<p>åˆ†æäº†HashMapçš„resizeæ–¹æ³•å¯ä»¥çŸ¥é“ï¼ŒHashMapåœ¨è¿›è¡Œæ‰©å®¹æ—¶æ˜¯éå¸¸è€—æ€§èƒ½çš„æ“ä½œï¼Œ
æ‰€ä»¥åœ¨ä½¿ç”¨HashMapçš„æ—¶å€™ï¼Œåº”è¯¥å…ˆä¼°ç®—ä¸€ä¸‹mapçš„å¤§å°ï¼Œåˆå§‹åŒ–çš„æ—¶å€™ç»™ä¸€ä¸ªå¤§è‡´çš„æ•°å€¼ï¼Œ
é¿å…mapè¿›è¡Œé¢‘ç¹çš„æ‰©å®¹ã€‚</p>
</div>
</div>
<div class="sect2">
<h3 id="_å‚è€ƒ"><a class="anchor" href="#_å‚è€ƒ"></a>25.10. å‚è€ƒ</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="http://blog.jrwang.me/2016/java-collections-hashmap/">Java å®¹å™¨æºç åˆ†æä¹‹ HashMap</a><br></p>
</li>
<li>
<p><a href="http://www.tuicode.com/article/56da289f8e6d72823e30a024">JDK1.8æºç åˆ†æä¹‹HashMapï¼ˆä¸€ï¼‰</a><br></p>
</li>
<li>
<p><a href="http://blog.csdn.net/tuke_tuke/article/details/51588156"> Javaä¸­HashMapåº•å±‚å®ç°åŸç†(JDK1.8)æºç åˆ†æ</a></p>
</li>
<li>
<p><a href="http://www.cnblogs.com/ToBeAProgrammer/p/4787761.html">åŸºäºjdk1.8çš„HashMapæºç å­¦ä¹ ç¬”è®°</a><br></p>
</li>
<li>
<p><a href="http://tech.meituan.com/java-hashmap.html">Java 8ç³»åˆ—ä¹‹é‡æ–°è®¤è¯†HashMap</a></p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_jdk_1_8_çš„å®ç°"><a class="anchor" href="#_jdk_1_8_çš„å®ç°"></a>25.11. JDK 1.8 çš„å®ç°</h3>
<div class="paragraph">
<p><strong>ç»§ä¸Šä¸€ç« ä»‹ç»äº†HashMapçš„ç­¾åã€æ•°æ®ç»“æ„ä»¥åŠå­˜å‚¨åŸç†ä¹‹åï¼Œç›¸ä¿¡å¤§å®¶å¯¹HashMapæœ‰äº†æ›´åŠ æ·±å…¥çš„ç†è§£ï¼Œåœ¨ä½¿ç”¨æ—¶ä¹Ÿä¼šå¾—å¿ƒåº”æ‰‹ã€‚</strong><br>
<strong>æœ¬ç« å°†ç»§ç»­ä»‹ç»HashMapçš„ä½¿ç”¨ï¼Œä¸»è¦æ˜¯åˆ†æHashMapçš„ä¸‰ç§éå†æ–¹å¼ã€‚</strong></p>
</div>
</div>
<div class="sect2">
<h3 id="_hashmapéå†"><a class="anchor" href="#_hashmapéå†"></a>25.12. HashMapéå†</h3>
<hr>
<div class="ulist">
<ul>
<li>
<p><strong>HashMapæä¾›äº†ä¸‰ç§éå†æ–¹å¼ï¼š</strong></p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>éå†æ‰€æœ‰çš„Keyï¼šSet&lt;K&gt; keySet()</p>
</li>
<li>
<p>éå†æ‰€æœ‰çš„Entryï¼šSet&lt;Map.Entry&lt;K,V&gt;&gt; entrySet()</p>
</li>
<li>
<p>éå†æ‰€æœ‰çš„Valueï¼ˆä¸å¸¸ç”¨ï¼‰ï¼šCollection&lt;V&gt; values()</p>
</li>
</ol>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>è¿™ä¸‰ä¸ªæ–¹æ³•çš„åŸºæœ¬ç”¨æ³•å°†ä¸åœ¨è¯¦ç»†ä»‹ç»ï¼Œå®ƒä»¬éƒ½æ˜¯è¿”å›å¯è¿­ä»£çš„Setæˆ–è€…Collectionã€‚è¦å¼„æ¸…æ¥šè¿™ä¸‰ä¸ªæ–¹æ³•
çš„å†…éƒ¨å®ç°æœºåˆ¶ï¼Œé¦–å…ˆä¸»è¦æ¥çœ‹ä¸€ä¸‹å†…éƒ¨æŠ½è±¡ç±»#HashIterator#ã€‚<br></p>
</div>
<div class="ulist">
<ul>
<li>
<p>HashIteratorå†…éƒ¨ç±»ï¼š</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">abstract</span> <span class="kd">class</span> <span class="nc">HashIterator</span> <span class="o">{</span>
    <span class="nc">Node</span><span class="o">&lt;</span><span class="no">K</span><span class="o">,</span><span class="no">V</span><span class="o">&gt;</span> <span class="n">next</span><span class="o">;</span>        <span class="c1">// next entry to return</span>
    <span class="nc">Node</span><span class="o">&lt;</span><span class="no">K</span><span class="o">,</span><span class="no">V</span><span class="o">&gt;</span> <span class="n">current</span><span class="o">;</span>     <span class="c1">// current entry</span>
    <span class="kt">int</span> <span class="n">expectedModCount</span><span class="o">;</span>  <span class="c1">// for fast-fail</span>
    <span class="kt">int</span> <span class="n">index</span><span class="o">;</span>             <span class="c1">// current slot</span>

    <span class="nc">HashIterator</span><span class="o">()</span> <span class="o">{</span>
        <span class="c1">//ç”¨expectedModCountä¿å­˜åˆšåˆ›å»ºè¿­ä»£å™¨æ—¶çš„modCountï¼Œ</span>
        <span class="c1">//å®ç°fail-fastæœºåˆ¶éœ€è¦å¯¹æ¯”è¯¥å€¼å’Œä½¿ç”¨æ—¶çš„modCount</span>
        <span class="n">expectedModCount</span> <span class="o">=</span> <span class="n">modCount</span><span class="o">;</span>
        <span class="nc">Node</span><span class="o">&lt;</span><span class="no">K</span><span class="o">,</span><span class="no">V</span><span class="o">&gt;[]</span> <span class="n">t</span> <span class="o">=</span> <span class="n">table</span><span class="o">;</span>
        <span class="n">current</span> <span class="o">=</span> <span class="n">next</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
        <span class="n">index</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
        <span class="c1">//æ‰¾åˆ°ç¬¬ä¸€ä¸ªæœ‰æ•ˆçš„æ§½</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">t</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="n">size</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span> <span class="c1">// advance to first entry</span>
            <span class="k">do</span> <span class="o">{}</span> <span class="k">while</span> <span class="o">(</span><span class="n">index</span> <span class="o">&lt;</span> <span class="n">t</span><span class="o">.</span><span class="na">length</span> <span class="o">&amp;&amp;</span> <span class="o">(</span><span class="n">next</span> <span class="o">=</span> <span class="n">t</span><span class="o">[</span><span class="n">index</span><span class="o">++])</span> <span class="o">==</span> <span class="kc">null</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">final</span> <span class="kt">boolean</span> <span class="nf">hasNext</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">next</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">final</span> <span class="nc">Node</span><span class="o">&lt;</span><span class="no">K</span><span class="o">,</span><span class="no">V</span><span class="o">&gt;</span> <span class="nf">nextNode</span><span class="o">()</span> <span class="o">{</span>
        <span class="nc">Node</span><span class="o">&lt;</span><span class="no">K</span><span class="o">,</span><span class="no">V</span><span class="o">&gt;[]</span> <span class="n">t</span><span class="o">;</span>
        <span class="nc">Node</span><span class="o">&lt;</span><span class="no">K</span><span class="o">,</span><span class="no">V</span><span class="o">&gt;</span> <span class="n">e</span> <span class="o">=</span> <span class="n">next</span><span class="o">;</span>
        <span class="cm">/*
         * fail-fast æ£€æŸ¥
         * å½“å¦å¤–ä¸€ä¸ªçº¿ç¨‹å¯¹å½“å‰Mapä¿®æ”¹æ—¶ï¼Œä¼šä¿®æ”¹modCountï¼Œ
         * å½“å‰çº¿ç¨‹éå†æ­£åœ¨ï¼Œå¦‚æœexpectedModCountå’ŒmodCount
         * ä¸ç›¸ç­‰ï¼Œå°±ä¼šæŠ›å‡ºConcurrentModificationExceptionå¼‚å¸¸
         */</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">modCount</span> <span class="o">!=</span> <span class="n">expectedModCount</span><span class="o">)</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">ConcurrentModificationException</span><span class="o">();</span>
        <span class="c1">// tableæ•°ç»„ä¸­æ²¡æœ‰å…ƒç´ ï¼ŒæŠ›å‡ºNoSuchElementExceptionå¼‚å¸¸</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">e</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">NoSuchElementException</span><span class="o">();</span>
        <span class="c1">//next = e.next</span>
        <span class="c1">//éå†æ˜¯é€šè¿‡å•é“¾è¡¨çš„æ–¹å¼æ¥è®¿é—®çš„ï¼Œå³ä¾¿æ˜¯çº¢é»‘æ ‘ä¹Ÿå¯ä»¥è¿™æ ·æ¥éå†</span>
        <span class="c1">//TreeNodeä¸­ä¹Ÿå­˜åœ¨nextå¼•ç”¨ï¼Œä¹Ÿå¯ä»¥çœ‹åšå•é“¾è¡¨</span>
        <span class="k">if</span> <span class="o">((</span><span class="n">next</span> <span class="o">=</span> <span class="o">(</span><span class="n">current</span> <span class="o">=</span> <span class="n">e</span><span class="o">).</span><span class="na">next</span><span class="o">)</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="o">(</span><span class="n">t</span> <span class="o">=</span> <span class="n">table</span><span class="o">)</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="c1">//å¦‚æœåˆ°è¾¾å½“å‰é“¾è¡¨æœ«å°¾next == null</span>
            <span class="c1">//å¯»æ‰¾ä¸‹ä¸€ä¸ªæœ‰æ•ˆçš„æ§½</span>
            <span class="k">do</span> <span class="o">{}</span> <span class="k">while</span> <span class="o">(</span><span class="n">index</span> <span class="o">&lt;</span> <span class="n">t</span><span class="o">.</span><span class="na">length</span> <span class="o">&amp;&amp;</span> <span class="o">(</span><span class="n">next</span> <span class="o">=</span> <span class="n">t</span><span class="o">[</span><span class="n">index</span><span class="o">++])</span> <span class="o">==</span> <span class="kc">null</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">e</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">final</span> <span class="kt">void</span> <span class="nf">remove</span><span class="o">()</span> <span class="o">{</span>
        <span class="nc">Node</span><span class="o">&lt;</span><span class="no">K</span><span class="o">,</span><span class="no">V</span><span class="o">&gt;</span> <span class="n">p</span> <span class="o">=</span> <span class="n">current</span><span class="o">;</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">p</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">IllegalStateException</span><span class="o">();</span>
        <span class="c1">//fail-fast æ£€æŸ¥</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">modCount</span> <span class="o">!=</span> <span class="n">expectedModCount</span><span class="o">)</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">ConcurrentModificationException</span><span class="o">();</span>
        <span class="n">current</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
        <span class="no">K</span> <span class="n">key</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="na">key</span><span class="o">;</span>
        <span class="c1">//è°ƒç”¨removeNodeç§»é™¤Entry</span>
        <span class="n">removeNode</span><span class="o">(</span><span class="n">hash</span><span class="o">(</span><span class="n">key</span><span class="o">),</span> <span class="n">key</span><span class="o">,</span> <span class="kc">null</span><span class="o">,</span> <span class="kc">false</span><span class="o">,</span> <span class="kc">false</span><span class="o">);</span>
        <span class="c1">//æ›´æ–°expectedModCount</span>
        <span class="n">expectedModCount</span> <span class="o">=</span> <span class="n">modCount</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="kd">final</span> <span class="kd">class</span> <span class="nc">KeyIterator</span> <span class="kd">extends</span> <span class="nc">HashIterator</span>
    <span class="kd">implements</span> <span class="nc">Iterator</span><span class="o">&lt;</span><span class="no">K</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">final</span> <span class="no">K</span> <span class="nf">next</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">nextNode</span><span class="o">().</span><span class="na">key</span><span class="o">;</span> <span class="o">}</span>  <span class="c1">//è¿”å›Key</span>
<span class="o">}</span>

<span class="kd">final</span> <span class="kd">class</span> <span class="nc">ValueIterator</span> <span class="kd">extends</span> <span class="nc">HashIterator</span>
    <span class="kd">implements</span> <span class="nc">Iterator</span><span class="o">&lt;</span><span class="no">V</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">final</span> <span class="no">V</span> <span class="nf">next</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">nextNode</span><span class="o">().</span><span class="na">value</span><span class="o">;</span> <span class="o">}</span> <span class="c1">// è¿”å›Value</span>
<span class="o">}</span>

<span class="kd">final</span> <span class="kd">class</span> <span class="nc">EntryIterator</span> <span class="kd">extends</span> <span class="nc">HashIterator</span>
    <span class="kd">implements</span> <span class="nc">Iterator</span><span class="o">&lt;</span><span class="nc">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="no">K</span><span class="o">,</span><span class="no">V</span><span class="o">&gt;&gt;</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">final</span> <span class="nc">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="no">K</span><span class="o">,</span><span class="no">V</span><span class="o">&gt;</span> <span class="nf">next</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">nextNode</span><span class="o">();</span> <span class="o">}</span> <span class="c1">// è¿”å›Entry</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>KeyIteratorã€ValueIterator å’Œ EntryIterator éƒ½ç»§æ‰¿äº† HashIteratorï¼ŒåŒºåˆ«åªåœ¨äº next() æ–¹æ³•è¿”å›çš„æ˜¯ Keyã€Value è¿˜æ˜¯ Entryã€‚</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Set&lt;Map.Entry&lt;K,V&gt;&gt; entrySet()</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">public</span> <span class="nc">Set</span><span class="o">&lt;</span><span class="nc">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="no">K</span><span class="o">,</span><span class="no">V</span><span class="o">&gt;&gt;</span> <span class="nf">entrySet</span><span class="o">()</span> <span class="o">{</span>
    <span class="nc">Set</span><span class="o">&lt;</span><span class="nc">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="no">K</span><span class="o">,</span><span class="no">V</span><span class="o">&gt;&gt;</span> <span class="n">es</span><span class="o">;</span>
    <span class="k">return</span> <span class="o">(</span><span class="n">es</span> <span class="o">=</span> <span class="n">entrySet</span><span class="o">)</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">?</span> <span class="o">(</span><span class="n">entrySet</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">EntrySet</span><span class="o">())</span> <span class="o">:</span> <span class="n">es</span><span class="o">;</span>
<span class="o">}</span>

<span class="kd">final</span> <span class="kd">class</span> <span class="nc">EntrySet</span> <span class="kd">extends</span> <span class="nc">AbstractSet</span><span class="o">&lt;</span><span class="nc">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="no">K</span><span class="o">,</span><span class="no">V</span><span class="o">&gt;&gt;</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kd">final</span> <span class="kt">int</span> <span class="nf">size</span><span class="o">()</span>                 <span class="o">{</span> <span class="k">return</span> <span class="n">size</span><span class="o">;</span> <span class="o">}</span>
  <span class="kd">public</span> <span class="kd">final</span> <span class="kt">void</span> <span class="nf">clear</span><span class="o">()</span>               <span class="o">{</span> <span class="nc">HashMap</span><span class="o">.</span><span class="na">this</span><span class="o">.</span><span class="na">clear</span><span class="o">();</span> <span class="o">}</span>
  <span class="c1">//è¿”å›ä¸€ä¸ªè¿­ä»£å™¨</span>
  <span class="kd">public</span> <span class="kd">final</span> <span class="nc">Iterator</span><span class="o">&lt;</span><span class="nc">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="no">K</span><span class="o">,</span><span class="no">V</span><span class="o">&gt;&gt;</span> <span class="nf">iterator</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nf">EntryIterator</span><span class="o">();</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="kd">final</span> <span class="kt">boolean</span> <span class="nf">contains</span><span class="o">(</span><span class="nc">Object</span> <span class="n">o</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(!(</span><span class="n">o</span> <span class="k">instanceof</span> <span class="nc">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">))</span>
      <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
    <span class="nc">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;?,?&gt;</span> <span class="n">e</span> <span class="o">=</span> <span class="o">(</span><span class="nc">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;?,?&gt;)</span> <span class="n">o</span><span class="o">;</span>
    <span class="nc">Object</span> <span class="n">key</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="na">getKey</span><span class="o">();</span>
    <span class="nc">Node</span><span class="o">&lt;</span><span class="no">K</span><span class="o">,</span><span class="no">V</span><span class="o">&gt;</span> <span class="n">candidate</span> <span class="o">=</span> <span class="n">getNode</span><span class="o">(</span><span class="n">hash</span><span class="o">(</span><span class="n">key</span><span class="o">),</span> <span class="n">key</span><span class="o">);</span>
    <span class="k">return</span> <span class="n">candidate</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="n">candidate</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">e</span><span class="o">);</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="kd">final</span> <span class="kt">boolean</span> <span class="nf">remove</span><span class="o">(</span><span class="nc">Object</span> <span class="n">o</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">o</span> <span class="k">instanceof</span> <span class="nc">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">)</span> <span class="o">{</span>
      <span class="nc">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;?,?&gt;</span> <span class="n">e</span> <span class="o">=</span> <span class="o">(</span><span class="nc">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;?,?&gt;)</span> <span class="n">o</span><span class="o">;</span>
      <span class="nc">Object</span> <span class="n">key</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="na">getKey</span><span class="o">();</span>
      <span class="nc">Object</span> <span class="n">value</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="na">getValue</span><span class="o">();</span>
      <span class="k">return</span> <span class="nf">removeNode</span><span class="o">(</span><span class="n">hash</span><span class="o">(</span><span class="n">key</span><span class="o">),</span> <span class="n">key</span><span class="o">,</span> <span class="n">value</span><span class="o">,</span> <span class="kc">true</span><span class="o">,</span> <span class="kc">true</span><span class="o">)</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="kd">final</span> <span class="nc">Spliterator</span><span class="o">&lt;</span><span class="nc">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="no">K</span><span class="o">,</span><span class="no">V</span><span class="o">&gt;&gt;</span> <span class="nf">spliterator</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nc">EntrySpliterator</span><span class="o">&lt;&gt;(</span><span class="nc">HashMap</span><span class="o">.</span><span class="na">this</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="o">-</span><span class="mi">1</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="mi">0</span><span class="o">);</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="kd">final</span> <span class="kt">void</span> <span class="nf">forEach</span><span class="o">(</span><span class="nc">Consumer</span><span class="o">&lt;?</span> <span class="kd">super</span> <span class="nc">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="no">K</span><span class="o">,</span><span class="no">V</span><span class="o">&gt;&gt;</span> <span class="n">action</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">Node</span><span class="o">&lt;</span><span class="no">K</span><span class="o">,</span><span class="no">V</span><span class="o">&gt;[]</span> <span class="n">tab</span><span class="o">;</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">action</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="nf">NullPointerException</span><span class="o">();</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">size</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="o">(</span><span class="n">tab</span> <span class="o">=</span> <span class="n">table</span><span class="o">)</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
      <span class="kt">int</span> <span class="n">mc</span> <span class="o">=</span> <span class="n">modCount</span><span class="o">;</span>
      <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">tab</span><span class="o">.</span><span class="na">length</span><span class="o">;</span> <span class="o">++</span><span class="n">i</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">for</span> <span class="o">(</span><span class="nc">Node</span><span class="o">&lt;</span><span class="no">K</span><span class="o">,</span><span class="no">V</span><span class="o">&gt;</span> <span class="n">e</span> <span class="o">=</span> <span class="n">tab</span><span class="o">[</span><span class="n">i</span><span class="o">];</span> <span class="n">e</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">;</span> <span class="n">e</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="na">next</span><span class="o">)</span>
          <span class="n">action</span><span class="o">.</span><span class="na">accept</span><span class="o">(</span><span class="n">e</span><span class="o">);</span>
      <span class="o">}</span>
      <span class="k">if</span> <span class="o">(</span><span class="n">modCount</span> <span class="o">!=</span> <span class="n">mc</span><span class="o">)</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nf">ConcurrentModificationException</span><span class="o">();</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>ç†è§£äº† HashIterator åå†çœ‹ entrySet() å’Œ EntrySet ç±»å°±æ¯”è¾ƒå®¹æ˜“ç†è§£äº†ï¼Œæ³¨æ„åˆ° HashMap çš„å®ç°ä¸­ä½¿ç”¨äº†ä¸€ä¸ª entrySet æˆå‘˜æ¥ç¼“å­˜ç»“æœã€‚ keySet() å’Œ values() çš„å®ç°ä¹Ÿæ˜¯ç±»ä¼¼çš„ï¼Œåªæ˜¯ values() è¿”å›çš„æ˜¯ Collection ï¼Œå› ä¸ºå€¼ä¸èƒ½ä¿è¯å”¯ä¸€æ€§ï¼Œè€Œé”®æ˜¯å¯ä»¥çš„ã€‚</p>
</div>
</div>
<div class="sect2">
<h3 id="_æ³¨æ„"><a class="anchor" href="#_æ³¨æ„"></a>25.13. æ³¨æ„</h3>
<div class="paragraph">
<p><strong>å¯¹äºMapä¸­çš„Keyæ˜¯åŒ…è£…ç±»å‹æ—¶ï¼Œä»mapæ€»getå…ƒç´ æ—¶è¦ç‰¹åˆ«æ³¨æ„ï¼Œgetå…ƒç´ çš„keyä¹Ÿå¿…é¡»æ˜¯å¯¹åº”çš„åŒ…è£…ç±»å‹ï¼Œå¦è€…ä¸èƒ½è·å¾—åˆ°å¯¹åº”çš„valueã€‚
å› ä¸ºgetæ–¹æ³•å†…éƒ¨é€šè¿‡keyæŸ¥æ‰¾å¯¹åº”çš„valueæ—¶ï¼Œkeyç”¨çš„æ˜¯equalsæ–¹æ³•æ¯”è¾ƒï¼Œæ‰€ä»¥keyçš„æ•°æ®ç±»å‹ä¹Ÿå¿…é¡»ç›¸åŒã€‚<br>
ä¾‹å¦‚ï¼š</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kt">long</span> <span class="n">key</span> <span class="o">=</span> <span class="mi">123</span><span class="o">;</span>
<span class="nc">Map</span><span class="o">&lt;</span><span class="nc">Long</span><span class="o">,</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">map</span> <span class="o">=</span> <span class="nc">Maps</span><span class="o">.</span><span class="na">newHashMap</span><span class="o">();</span>
<span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="mi">123L</span><span class="o">,</span><span class="s">"java"</span><span class="o">);</span>
<span class="nc">String</span> <span class="n">value</span> <span class="o">=</span> <span class="n">map</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">key</span><span class="o">);</span>  <span class="c1">// valueæ˜¯nullï¼Ÿè¿˜æ˜¯javaï¼Ÿ</span></code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_å°ç»“_2"><a class="anchor" href="#_å°ç»“_2"></a>25.13.1. å°ç»“</h4>
<div class="paragraph">
<p>æœ‰å…³HashMapçš„éå†å°±ä»‹ç»è¿™å†™ï¼Œéå†HashMapä¸€å…±æœ‰ä¸‰ç§æ–¹å¼ï¼Œä¸€èˆ¬éå†keyå’Œéå†Entryç”¨çš„æ¯”è¾ƒå¤šï¼Œè€Œä¸”éå†Entryè¦æ¯”éå†
keyæ•ˆç‡è¦æ›´å¿«äº›ã€‚å¯¹äºHashMapçš„æºç æš‚æ—¶å°±åˆ†æè¿™ä¹ˆå¤šï¼Œç”±äºæœ¬äººè¿˜æ˜¯ä¸€ä¸ªèœé¸Ÿï¼Œæ°´å¹³æœ‰é™ï¼Œæœ‰äº›åœ°æ–¹ä¹Ÿè®¸æ²¡æœ‰åˆ†æçš„é€å½»ï¼Œå¸Œæœ›
å¤§å®¶å¯ä»¥è§è°…ï¼ŒåŒæ—¶ï¼Œæœ¬æ¬¡HashMapçš„æºç åˆ†æä¹Ÿæœ‰å¾ˆå¤šåœ°æ–¹æ²¡æœ‰è®²åˆ°ï¼Œæ¯”å¦‚ï¼šHashMapçš„å­˜å‚¨ç»“æ„çº¢é»‘æ ‘ï¼Œä»¥åæœ‰æ—¶é—´å†æ¥ç ”ç©¶ä¸€ä¸‹çº¢é»‘æ ‘
çš„å®ç°åŸç†ï¼Œè¿™é‡Œå…ˆæ¨èä¸€ç¯‡è®²è§£çº¢é»‘æ ‘çš„æ–‡ç« <a href="http://tech.meituan.com/redblack-tree.html">çº¢é»‘æ ‘æ·±å…¥å‰–æåŠJavaå®ç°</a>ã€‚</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_å‚è€ƒ_2"><a class="anchor" href="#_å‚è€ƒ_2"></a>25.14. å‚è€ƒ</h3>
<div class="ulist">
<ul>
<li>
<p><a href="https://blog.jrwang.me/2016/java-collections-hashmap/">Java å®¹å™¨æºç åˆ†æä¹‹ HashMap - JR&#8217;s Blog</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="paragraph nav-footer">
<p>â†Â Previous:Â <a href="java.util.AbstractMap.html">AbstractMap</a>Â | â†‘Â Up:Â <a href="index.html">JDK æºç åˆ†æ</a>Â | Next:Â <a href="java.util.TreeMap.html">TreeMap</a>Â â†’</p>
</div>
<script src="https://giscus.app/client.js" data-repo="diguage/jdk-source-analysis" data-repo-id="MDEwOlJlcG9zaXRvcnk3MjM5MzE5Mw==" data-category="General" data-category-id="MDE4OkRpc2N1c3Npb25DYXRlZ29yeTMyMDM2MDQx" data-mapping="og:title" data-strict="0" data-reactions-enabled="1" data-emit-metadata="1" data-input-position="top" data-theme="preferred_color_scheme" data-lang="zh-CN" data-loading="lazy" crossorigin="anonymous" async></script>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2025-11-25 13:40:54 UTC
</div>
</div>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  messageStyle: "none",
  tex2jax: {
    inlineMath: [["\\(", "\\)"]],
    displayMath: [["\\[", "\\]"]],
    ignoreClass: "nostem|nolatexmath"
  },
  asciimath2jax: {
    delimiters: [["\\$", "\\$"]],
    ignoreClass: "nostem|noasciimath"
  },
  TeX: { equationNumbers: { autoNumber: "none" } }
})
MathJax.Hub.Register.StartupHook("AsciiMath Jax Ready", function () {
  MathJax.InputJax.AsciiMath.postfilterHooks.Add(function (data, node) {
    if ((node = data.script.parentNode) && (node = node.parentNode) && node.classList.contains("stemblock")) {
      data.math.root.display = "block"
    }
    return data
  })
})
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/MathJax.js?config=TeX-MML-AM_CHTML"></script>
<script src="assets/scripts/asciidoctor-tabs.js"></script>
<script src="assets/scripts/scroll-toc.js"></script></body>
</html>