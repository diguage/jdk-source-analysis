<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.26">
<meta name="keywords" content="Java,JDK,Java source,Collection,ArrayList,Map,List,HashMap,ArrayDeque,Deque,Set,HashSet,LinkedList,Queue,TreeMap,TreeSet,Vector,Stack">
<meta name="author" content="Dç“œå“¥">
<meta name="copyright" content="Apache-2.0">
<meta property="og:title" content="java.util.concurrent.locks.AbstractQueuedSynchronizer">
<title>JDK æºç åˆ†æ: 43. AbstractQueuedSynchronizer</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<link rel="stylesheet" href="assets/styles/asciidoctor.css">
<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css">
<link rel="stylesheet" href="assets/styles/rouge-github.css">
<style>
    a {
        text-decoration: none;
    }

    .img_bk {
        text-align: center;
    }

    p > code, strong > code, div.admonitionblock tr > td.content > code {
        color: #d14 !important;
        background-color: #f5f5f5 !important;
        border: 1px solid #e1e1e8;
        white-space: nowrap;
        border-radius: 3px;
    }
</style>
<link rel="stylesheet" href="assets/styles/asciidoctor-tabs.css">
<style>.toc-current{color:#d14;font-size:130%;font-weight: bold;} .toc-root{font-family: "Open Sans","DejaVu Sans",sans-serif;
                       font-size: 0.9em;} #content{display: flex; flex-direction: column; flex: 1 1 auto;}
             .nav-footer{text-align: center; margin-top: auto;}
             .nav-footer > p > a {white-space: nowrap;}</style>
</head>
<body id="java.util.concurrent.locks.AbstractQueuedSynchronizer" class="book toc2 toc-left">
<div id="header">
<h1>JDK æºç åˆ†æ: 43. AbstractQueuedSynchronizer</h1>
<div class="details">
<span id="author" class="author">Dç“œå“¥</span><br>
<span id="email" class="email"><a href="https://www.diguage.com" class="bare">https://www.diguage.com</a></span><br>
<span id="revdate">2025-11-25</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<p><span class="toc-root"><a href="index.html">JDK æºç åˆ†æ</a></span></p><ul class="sectlevel1">
<li><a href="preface.html">å‰è¨€ï¼šJDK &amp; STL æºç åˆ†æè®¡åˆ’</a>
</li>
<li><a href="overview.html">1. é›†åˆç±»æ¦‚è¿°</a>
</li>
<li><a href="java.util.Iterator.html">2. è¿­ä»£å™¨ Iteratorã€ Enumerationã€ Spliterator ä¸ Iterable</a>
</li>
<li><a href="java.util.Collection.html">3. Collection</a>
</li>
<li><a href="java.util.AbstractCollection.html">4. AbstractCollection</a>
</li>
<li><a href="java.util.List.html">5. List</a>
</li>
<li><a href="java.util.AbstractList.html">6. AbstractList</a>
</li>
<li><a href="java.util.AbstractSequentialList.html">7. AbstractSequentialList</a>
</li>
<li><a href="java.util.ArrayList.html">8. <code>ArrayList</code></a>
</li>
<li><a href="java.util.LinkedList.html">9. LinkedList</a>
</li>
<li><a href="java.util.Stack.html">10. Stack</a>
</li>
<li><a href="java.util.Vector.html">11. Vector</a>
</li>
<li><a href="java.util.Set.html">12. Set</a>
</li>
<li><a href="java.util.AbstractSet.html">13. AbstractSet</a>
</li>
<li><a href="java.util.SortedSet.html">14. SortedSet</a>
</li>
<li><a href="java.util.NavigableSet.html">15. NavigableSet</a>
</li>
<li><a href="java.util.HashSet.html">16. HashSet</a>
</li>
<li><a href="java.util.TreeSet.html">17. TreeSet</a>
</li>
<li><a href="java.util.LinkedHashSet.html">18. LinkedHashSet</a>
</li>
<li><a href="java.util.BitSet.html">19. BitSet</a>
</li>
<li><a href="java.util.EnumSet.html">20. EnumSet</a>
</li>
<li><a href="java.util.Map.html">21. Map</a>
</li>
<li><a href="java.util.SortedMap.html">22. SortedMap</a>
</li>
<li><a href="java.util.NavigableMap.html">23. NavigableMap</a>
</li>
<li><a href="java.util.AbstractMap.html">24. AbstractMap</a>
</li>
<li><a href="java.util.HashMap.html">25. HashMap</a>
</li>
<li><a href="java.util.TreeMap.html">26. TreeMap</a>
</li>
<li><a href="java.util.LinkedHashMap.html">27. LinkedHashMap</a>
</li>
<li><a href="java.util.Dictionary.html">28. Dictionary</a>
</li>
<li><a href="java.util.Hashtable.html">29. Hashtable</a>
</li>
<li><a href="java.util.EnumMap.html">30. EnumMap</a>
</li>
<li><a href="java.util.WeakHashMap.html">31. WeakHashMap</a>
</li>
<li><a href="java.util.IdentityHashMap.html">32. IdentityHashMap</a>
</li>
<li><a href="java.util.Queue.html">33. Queue</a>
</li>
<li><a href="java.util.Deque.html">34. Deque</a>
</li>
<li><a href="java.util.AbstractQueue.html">35. AbstractQueue</a>
</li>
<li><a href="java.util.ArrayDeque.html">36. ArrayDeque</a>
</li>
<li><a href="java.util.PriorityQueue.html">37. PriorityQueue</a>
</li>
<li><a href="java.util.Array.html">38. å·¥å…·ç±» <code>Arrays</code></a>
</li>
<li><a href="java.util.Collection.html">39. å·¥å…·ç±» <code>Collections</code></a>
</li>
<li><a href="concurrent.overview.html">40. å¹¶å‘åº“æ¦‚è¿°</a>
</li>
<li><a href="java.lang.Thread.html">41. Thread</a>
</li>
<li><a href="java.util.concurrent.locks.LockSupport.html">42. LockSupport</a>
</li>
<li><a href="java.util.concurrent.locks.AbstractQueuedSynchronizer.html"><span class="toc-current">43. AbstractQueuedSynchronizer</span></a>
</li>
<li><a href="java.util.concurrent.locks.ReentrantLock.html">44. ReentrantLock</a>
</li>
<li><a href="java.util.concurrent.locks.ReentrantReadWriteLock.html">45. ReentrantReadWriteLock</a>
</li>
<li><a href="java.util.concurrent.locks.StampedLock.html">46. StampedLock</a>
</li>
<li><a href="java.util.concurrent.Semaphore.html">47. Semaphore</a>
</li>
<li><a href="java.util.concurrent.CountDownLatch.html">48. CountDownLatch</a>
</li>
<li><a href="java.util.concurrent.CyclicBarrier.html">49. CyclicBarrier</a>
</li>
<li><a href="java.util.concurrent.Phaser.html">50. Phaser</a>
</li>
<li><a href="java.util.concurrent.Exchanger.html">51. Exchanger</a>
</li>
<li><a href="java.lang.ThreadLocal.html">52. ThreadLocal</a>
</li>
<li><a href="java.util.concurrent.atomic.AtomicInteger.html">53. AtomicInteger</a>
</li>
<li><a href="java.util.concurrent.atomic.LongAdder.html">54. LongAdder</a>
</li>
<li><a href="java.util.concurrent.Future.html">55. JUC åŒ…åŸºç¡€ç±»åˆ†æ</a>
</li>
<li><a href="java.util.concurrent.FutureTask.html">56. FutureTask</a>
</li>
<li><a href="java.util.concurrent.CompletableFuture.html">57. CompletableFuture</a>
</li>
<li><a href="java.util.concurrent.ThreadPoolExecutor.html">58. ThreadPoolExecutor æºç åˆ†æ</a>
</li>
<li><a href="java.util.concurrent.ForkJoinTask.html">59. ForkJoinTask</a>
</li>
<li><a href="java.util.concurrent.ForkJoinPool.html">60. ForkJoinPool</a>
</li>
<li><a href="java.util.concurrent.ConcurrentHashMap.html">61. <code>ConcurrentHashMap</code></a>
</li>
<li><a href="java.util.concurrent.ConcurrentSkipListMap.html">62. <code>ConcurrentSkipListMap</code></a>
</li>
<li><a href="java.util.concurrent.CopyOnWriteArrayList.html">63. CopyOnWriteArrayList</a>
</li>
<li><a href="java.util.concurrent.ConcurrentLinkedQueue.html">64. ConcurrentLinkedQueue</a>
</li>
<li><a href="java.util.concurrent.ArrayBlockingQueue.html">65. ArrayBlockingQueue</a>
</li>
<li><a href="java.util.concurrent.LinkedBlockingQueue.html">66. LinkedBlockingQueue</a>
</li>
<li><a href="java.util.concurrent.PriorityBlockingQueue.html">67. PriorityBlockingQueue</a>
</li>
<li><a href="java.util.concurrent.DelayQueue.html">68. DelayQueue</a>
</li>
<li><a href="java.util.concurrent.ScheduledThreadPoolExecutor.html">69. <code>ScheduledThreadPoolExecutor</code></a>
</li>
<li><a href="java.util.concurrent.Flow.html">70. <code>Flow</code></a>
</li>
<li><a href="java.lang.ClassLoader.html">71. ClassLoader</a>
</li>
<li><a href="java.lang.reflect.Field.html">72. Field</a>
</li>
<li><a href="java.lang.reflect.Proxy.html">73. Proxy</a>
</li>
<li><a href="java.net.ServerSocket.html">74. ServerSocket</a>
</li>
<li><a href="java.util.ServiceLoader.html">75. <code>ServiceLoader</code></a>
</li>
<li><a href="java.lang.String.html">76. <code>String</code></a>
</li>
<li><a href="java.util.Date.html">77. <code>Date</code></a>
</li>
<li><a href="java.io.Serializable.html">78. <code>Serializable</code></a>
</li>
<li><a href="java.regex.Pattern.html">79. <code>Pattern</code></a>
</li>
<li><a href="_netty.html">80. Netty</a>
</li>
</ul>
</div>
</div>
<div id="content"><div class="sect2"><h3 id="_å‹æƒ…æ”¯æŒ">å‹æƒ…æ”¯æŒ</h3><div class="paragraph"><p>å¦‚æœæ‚¨è§‰å¾—è¿™ä¸ªç¬”è®°å¯¹æ‚¨æœ‰æ‰€å¸®åŠ©ï¼Œçœ‹åœ¨Dç“œå“¥ç è¿™ä¹ˆå¤šå­—çš„è¾›è‹¦ä¸Šï¼Œè¯·å‹æƒ…æ”¯æŒä¸€ä¸‹ï¼ŒDç“œå“¥æ„Ÿæ¿€ä¸å°½ï¼ŒğŸ˜œ</p></div><table class="tableblock frame-none grid-all stretch"><colgroup><col style="width: 50%;"><col style="width: 50%;"></colgroup><tbody><tr><td class="tableblock halign-center valign-top"><p class="tableblock"><span class="image"><img src="assets/images/alipay.png" alt="æ”¯ä»˜å®" width="85%" title="æ”¯ä»˜å®"></span></p></td><td class="tableblock halign-center valign-top"><p class="tableblock"><span class="image"><img src="assets/images/wxpay.jpg" alt="å¾®ä¿¡" width="85%" title="å¾®ä¿¡"></span></p></td></tr></tbody></table><div class="paragraph"><p>æœ‰äº›æ‰“èµçš„æœ‹å‹å¸Œæœ›å¯ä»¥åŠ ä¸ªå¥½å‹ï¼Œæ¬¢è¿å…³æ³¨D ç“œå“¥çš„å¾®ä¿¡å…¬ä¼—å·ï¼Œè¿™æ ·å°±å¯ä»¥é€šè¿‡å…¬ä¼—å·çš„å›å¤ç›´æ¥ç»™æˆ‘å‘ä¿¡æ¯ã€‚</p></div><div class="paragraph"><p><span class="image"><img src="assets/images/wx-jikerizhi.png" alt="wx jikerizhi" width="98%"></span></p></div><div class="admonitionblock tip"><table><tbody><tr><td class="icon"><i class="fa icon-tip" title="Tip"></i></td><td class="content"><strong>å…¬ä¼—å·çš„å¾®ä¿¡å·æ˜¯: <code>jikerizhi</code></strong>ã€‚<em>å› ä¸ºä¼—æ‰€å‘¨çŸ¥çš„åŸå› ï¼Œæœ‰æ—¶å›¾ç‰‡åŠ è½½ä¸å‡ºæ¥ã€‚ å¦‚æœå›¾ç‰‡åŠ è½½ä¸å‡ºæ¥å¯ä»¥ç›´æ¥é€šè¿‡æœç´¢å¾®ä¿¡å·æ¥æŸ¥æ‰¾æˆ‘çš„å…¬ä¼—å·ã€‚</em></td></tr></tbody></table></div></div>
<div class="sect1">
<h2 id="java.util.concurrent.locks.AbstractQueuedSynchronizer"><a class="anchor" href="#java.util.concurrent.locks.AbstractQueuedSynchronizer"></a>43. AbstractQueuedSynchronizer</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Doug Lea</p>
</div>
<div class="paragraph">
<p>åœ¨ Java 5 ä¹‹åï¼ŒJDK å†…ç½®äº†å¤§é‡çš„å¹¶å‘å·¥å…·ç±»ã€‚ç²—ç•¥å»çœ‹è¿™äº›å·¥å…·ç±»çš„æºç ï¼Œä½ ä¼šå‘ç°ï¼Œå¤§å¤šæ•°éƒ½åœ¨å†…éƒ¨ç»§æ‰¿äº† <code>AbstractQueuedSynchronizer</code>ã€‚ç”±æ­¤å¯è§ï¼Œ<code>AbstractQueuedSynchronizer</code> çš„æ ¸å¿ƒåœ°ä½ã€‚æƒ³ææ¸…æ¥šè¿™äº›å¹¶å‘å·¥å…·ç±»çš„åŸç†ï¼Œ<code>AbstractQueuedSynchronizer</code> çš„æºç å¯ä»¥è¯´æ˜¯ä¸å¯ä¸çœ‹ã€‚</p>
</div>
<div class="sect2">
<h3 id="_clh_lock_queue_ä»‹ç»"><a class="anchor" href="#_clh_lock_queue_ä»‹ç»"></a>43.1. CLH lock queue ä»‹ç»</h3>
<div class="imageblock">
<div class="content">
<img src="./assets/images/AbstractQueuedSynchronizer-CLH-queue.png" alt="AbstractQueuedSynchronizer CLH queue">
</div>
</div>
<div class="paragraph">
<p>ç»ˆäºçœ‹æ˜ç™½äº† CLH lock queueã€‚CLH é€šè¿‡è‡ªæ—‹æ¥é”å®šå½“å‰èŠ‚ç‚¹ã€‚è‡ªæ—‹çš„å¥½å¤„æ˜¯çº¿ç¨‹ä¸éœ€è¦ç¡çœ å’Œå”¤é†’ï¼Œå‡å°äº†ç³»ç»Ÿè°ƒç”¨çš„å¼€é”€ã€‚</p>
</div>
<div class="paragraph">
<p>AQS ä¸­çº¿ç¨‹ä¸æ˜¯ä¸€ç›´åœ¨è‡ªæ—‹çš„ï¼Œè€Œå¯èƒ½ä¼šåå¤çš„ç¡çœ å’Œå”¤é†’ï¼Œè¿™å°±éœ€è¦å‰ç»§é‡Šæ”¾é”çš„æ—¶å€™é€šè¿‡ next æŒ‡é’ˆæ‰¾åˆ°å…¶åç»§å°†å…¶å”¤é†’ï¼Œä¹Ÿå°±æ˜¯ AQS çš„ç­‰å¾…é˜Ÿåˆ—ä¸­åç»§æ˜¯è¢«å‰ç»§å”¤é†’çš„ã€‚AQS ç»“åˆäº†è‡ªæ—‹å’Œç¡çœ /å”¤é†’ä¸¤ç§æ–¹æ³•çš„ä¼˜ç‚¹ã€‚</p>
</div>
<div class="paragraph">
<p><em>AQS ç»“åˆäº†è‡ªæ—‹å’Œç¡çœ /å”¤é†’ä¸¤ç§æ–¹æ³•çš„ä¼˜ç‚¹ã€‚</em> è¿™å¥è¯è¯¥å¦‚ä½•ç†è§£ï¼Ÿåˆšåˆšæƒ³åˆ°çš„ä¸€ç‚¹ï¼š AQS ä¸­ä¼šå…ˆè‡ªæ—‹ä¸¤æ¬¡ï¼Œå¦‚æœä¸æˆåŠŸåˆ™ä¼‘çœ ã€‚åº”è¯¥æ˜¯è¿™æ ·æ¥ä½¿ç”¨ä¸¤è€…çš„å¥½å¤„ï¼</p>
</div>
<div class="paragraph">
<p>è‡ªå·±å®ç°ä¸€ä¸ª CLH é”ï¼</p>
</div>
</div>
<div class="sect2">
<h3 id="_æ ¸å¿ƒç‚¹"><a class="anchor" href="#_æ ¸å¿ƒç‚¹"></a>43.2. æ ¸å¿ƒç‚¹</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>æ¨¡æ¿æ–¹æ³•æ¨¡å¼</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p><code>boolean tryAcquire(int arg)</code></p>
</li>
<li>
<p><code>boolean tryRelease(int arg)</code></p>
</li>
<li>
<p><code>int tryAcquireShared(int arg)</code></p>
</li>
<li>
<p><code>boolean tryReleaseShared(int arg)</code></p>
</li>
<li>
<p><code>boolean isHeldExclusively()</code></p>
</li>
</ol>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>åŸºäº <code>AbstractQueuedSynchronizer</code>ï¼Œæˆ‘ä»¬å®ç°ä¸€ä¸ªäº’æ–¥é”ï¼š</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="java"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
</pre></td><td class="code"><pre><span class="kn">package</span> <span class="nn">com.diguage.truman.concurrent</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.concurrent.TimeUnit</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.concurrent.locks.AbstractQueuedSynchronizer</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.concurrent.locks.Condition</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.concurrent.locks.Lock</span><span class="o">;</span>

<span class="cm">/**
 * @author Dç“œå“¥, https://www.diguage.com/
 * @since 2020-03-31 10:27
 */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Mutex</span> <span class="kd">implements</span> <span class="nc">Lock</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Sync</span> <span class="kd">extends</span> <span class="nc">AbstractQueuedSynchronizer</span> <span class="o">{</span>
        <span class="nd">@Override</span>
        <span class="kd">protected</span> <span class="kt">boolean</span> <span class="nf">tryAcquire</span><span class="o">(</span><span class="kt">int</span> <span class="n">arg</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">compareAndSetState</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="mi">1</span><span class="o">))</span> <span class="o">{</span>
                <span class="n">setExclusiveOwnerThread</span><span class="o">(</span><span class="nc">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">());</span>
                <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
            <span class="o">}</span>
            <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="nd">@Override</span>
        <span class="kd">protected</span> <span class="kt">boolean</span> <span class="nf">tryRelease</span><span class="o">(</span><span class="kt">int</span> <span class="n">arg</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">getState</span><span class="o">()</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">throw</span> <span class="k">new</span> <span class="nf">IllegalMonitorStateException</span><span class="o">();</span>
            <span class="o">}</span>
            <span class="n">setExclusiveOwnerThread</span><span class="o">(</span><span class="kc">null</span><span class="o">);</span>
            <span class="n">setState</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
            <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="nd">@Override</span>
        <span class="kd">protected</span> <span class="kt">boolean</span> <span class="nf">isHeldExclusively</span><span class="o">()</span> <span class="o">{</span>
            <span class="k">return</span> <span class="nf">getState</span><span class="o">()</span> <span class="o">==</span> <span class="mi">1</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="nc">Condition</span> <span class="nf">newCodition</span><span class="o">()</span> <span class="o">{</span>
            <span class="k">return</span> <span class="k">new</span> <span class="nf">ConditionObject</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">Sync</span> <span class="n">sync</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Sync</span><span class="o">();</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">lock</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">sync</span><span class="o">.</span><span class="na">acquire</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">lockInterruptibly</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">InterruptedException</span> <span class="o">{</span>
        <span class="n">sync</span><span class="o">.</span><span class="na">acquireInterruptibly</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">tryLock</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">sync</span><span class="o">.</span><span class="na">tryAcquire</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">tryLock</span><span class="o">(</span><span class="kt">long</span> <span class="n">time</span><span class="o">,</span> <span class="nc">TimeUnit</span> <span class="n">unit</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">InterruptedException</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">sync</span><span class="o">.</span><span class="na">tryAcquireSharedNanos</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="n">unit</span><span class="o">.</span><span class="na">toNanos</span><span class="o">(</span><span class="n">time</span><span class="o">));</span>
    <span class="o">}</span>
    
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">unlock</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">sync</span><span class="o">.</span><span class="na">release</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="nc">Condition</span> <span class="nf">newCondition</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">sync</span><span class="o">.</span><span class="na">newCodition</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">isLocked</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">sync</span><span class="o">.</span><span class="na">isHeldExclusively</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">hasQueuedThreads</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">sync</span><span class="o">.</span><span class="na">hasQueuedThreads</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>äº’æ–¥é”ï¼Œä¹Ÿå¯ä»¥ç§°ä¸ºç‹¬å é”ï¼Œé¡¾åæ€ä¹‰å°±æ˜¯åŒä¸€ä¸ªæ—¶åˆ»åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹è·å–åˆ°é”ï¼Œè€Œå…¶ä»–è·å–é”çš„çº¿ç¨‹åªèƒ½åœ¨åŒæ­¥é˜Ÿåˆ—ä¸­ç­‰å¾…ï¼Œåªæœ‰è·å–é”çš„çº¿ç¨‹é‡Šæ”¾äº†é”ï¼Œåç»§çš„çº¿ç¨‹æ‰èƒ½è·å–é”ã€‚</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="java"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
</pre></td><td class="code"><pre><span class="kn">package</span> <span class="nn">com.diguage.truman.concurrent</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.junit.jupiter.api.Test</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.lang.invoke.MethodHandles</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.lang.invoke.VarHandle</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.ArrayList</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Random</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.concurrent.ExecutorService</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.concurrent.Executors</span><span class="o">;</span>

<span class="cm">/**
 * @author Dç“œå“¥, https://www.diguage.com/
 * @since 2020-03-31 11:41
 */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">AbstractQueuedSynchronizerTest</span> <span class="o">{</span>

    <span class="nd">@Test</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">testNode</span><span class="o">()</span> <span class="o">{</span>
        <span class="nc">AqsNode</span> <span class="n">head</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">AqsNode</span><span class="o">();</span>
        <span class="nc">AqsNode</span> <span class="n">next</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">AqsNode</span><span class="o">(</span><span class="nc">AqsNode</span><span class="o">.</span><span class="na">EXCLUSIVE</span><span class="o">);</span>
        <span class="n">head</span><span class="o">.</span><span class="na">next</span> <span class="o">=</span> <span class="n">next</span><span class="o">;</span>
        <span class="n">next</span><span class="o">.</span><span class="na">prev</span> <span class="o">=</span> <span class="n">head</span><span class="o">;</span>
        <span class="nc">AqsNode</span> <span class="n">tail</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">AqsNode</span><span class="o">(</span><span class="nc">AqsNode</span><span class="o">.</span><span class="na">EXCLUSIVE</span><span class="o">);</span>
        <span class="n">next</span><span class="o">.</span><span class="na">next</span> <span class="o">=</span> <span class="n">tail</span><span class="o">;</span>
        <span class="n">tail</span><span class="o">.</span><span class="na">prev</span> <span class="o">=</span> <span class="n">next</span><span class="o">;</span>
        <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Thread</span><span class="o">&gt;</span> <span class="n">threads</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;&gt;();</span>
        <span class="k">for</span> <span class="o">(</span><span class="nc">AqsNode</span> <span class="n">node</span> <span class="o">=</span> <span class="n">head</span><span class="o">;</span> <span class="n">node</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">;</span> <span class="n">node</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="na">next</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">threads</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">node</span><span class="o">.</span><span class="na">thread</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">threads</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">AqsNode</span> <span class="o">{</span>

        <span class="kd">static</span> <span class="kd">final</span> <span class="nc">AqsNode</span> <span class="no">SHARED</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">AqsNode</span><span class="o">();</span>
        <span class="kd">static</span> <span class="kd">final</span> <span class="nc">AqsNode</span> <span class="no">EXCLUSIVE</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>

        <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="no">CANCELLED</span> <span class="o">=</span> <span class="mi">1</span><span class="o">;</span>
        <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="no">SIGNAL</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="o">;</span>
        <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="no">CONDITION</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span><span class="o">;</span>
        <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="no">PROPAGATE</span> <span class="o">=</span> <span class="o">-</span><span class="mi">3</span><span class="o">;</span>

        <span class="kd">volatile</span> <span class="kt">int</span> <span class="n">waitStatus</span><span class="o">;</span>

        <span class="kd">volatile</span> <span class="nc">AqsNode</span> <span class="n">prev</span><span class="o">;</span>

        <span class="kd">volatile</span> <span class="nc">AqsNode</span> <span class="n">next</span><span class="o">;</span>

        <span class="kd">volatile</span> <span class="nc">Thread</span> <span class="n">thread</span><span class="o">;</span>

        <span class="nc">AqsNode</span> <span class="n">nextWaiter</span><span class="o">;</span>

        <span class="kd">final</span> <span class="kt">boolean</span> <span class="nf">isShared</span><span class="o">()</span> <span class="o">{</span>
            <span class="k">return</span> <span class="n">nextWaiter</span> <span class="o">==</span> <span class="no">SHARED</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="kd">final</span> <span class="nc">AqsNode</span> <span class="nf">predecessor</span><span class="o">()</span> <span class="o">{</span>
            <span class="nc">AqsNode</span> <span class="n">p</span> <span class="o">=</span> <span class="n">prev</span><span class="o">;</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">p</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span>
                <span class="k">throw</span> <span class="k">new</span> <span class="nf">NullPointerException</span><span class="o">();</span>
            <span class="k">else</span>
                <span class="k">return</span> <span class="n">p</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="nc">AqsNode</span><span class="o">()</span> <span class="o">{</span>
        <span class="o">}</span>

        <span class="nc">AqsNode</span><span class="o">(</span><span class="nc">AqsNode</span> <span class="n">nextWaiter</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">this</span><span class="o">.</span><span class="na">nextWaiter</span> <span class="o">=</span> <span class="n">nextWaiter</span><span class="o">;</span>
            <span class="no">THREAD</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="nc">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">());</span>
        <span class="o">}</span>

        <span class="nc">AqsNode</span><span class="o">(</span><span class="kt">int</span> <span class="n">waitStatus</span><span class="o">)</span> <span class="o">{</span>
            <span class="no">WAITSTATUS</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="n">waitStatus</span><span class="o">);</span>
            <span class="no">THREAD</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="nc">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">());</span>
        <span class="o">}</span>

        <span class="kd">final</span> <span class="kt">boolean</span> <span class="nf">compareAndSetWaitStatus</span><span class="o">(</span><span class="kt">int</span> <span class="n">expect</span><span class="o">,</span> <span class="kt">int</span> <span class="n">update</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="no">WAITSTATUS</span><span class="o">.</span><span class="na">compareAndSet</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="n">expect</span><span class="o">,</span> <span class="n">update</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="kd">final</span> <span class="kt">boolean</span> <span class="nf">compareAndSetNext</span><span class="o">(</span><span class="nc">AqsNode</span> <span class="n">expect</span><span class="o">,</span> <span class="nc">AqsNode</span> <span class="n">update</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="no">NEXT</span><span class="o">.</span><span class="na">compareAndSet</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="n">expect</span><span class="o">,</span> <span class="n">update</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="kd">final</span> <span class="kt">void</span> <span class="nf">setPrevRelaxed</span><span class="o">(</span><span class="nc">AqsNode</span> <span class="n">p</span><span class="o">)</span> <span class="o">{</span>
            <span class="no">PREV</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="n">p</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">VarHandle</span> <span class="no">NEXT</span><span class="o">;</span>
        <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">VarHandle</span> <span class="no">PREV</span><span class="o">;</span>
        <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">VarHandle</span> <span class="no">THREAD</span><span class="o">;</span>
        <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">VarHandle</span> <span class="no">WAITSTATUS</span><span class="o">;</span>

        <span class="kd">static</span> <span class="o">{</span>
            <span class="k">try</span> <span class="o">{</span>
                <span class="nc">MethodHandles</span><span class="o">.</span><span class="na">Lookup</span> <span class="n">l</span> <span class="o">=</span> <span class="nc">MethodHandles</span><span class="o">.</span><span class="na">lookup</span><span class="o">();</span>
                <span class="no">NEXT</span> <span class="o">=</span> <span class="n">l</span><span class="o">.</span><span class="na">findVarHandle</span><span class="o">(</span><span class="nc">AqsNode</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="s">"next"</span><span class="o">,</span> <span class="nc">AqsNode</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
                <span class="no">PREV</span> <span class="o">=</span> <span class="n">l</span><span class="o">.</span><span class="na">findVarHandle</span><span class="o">(</span><span class="nc">AqsNode</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="s">"prev"</span><span class="o">,</span> <span class="nc">AqsNode</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
                <span class="no">THREAD</span> <span class="o">=</span> <span class="n">l</span><span class="o">.</span><span class="na">findVarHandle</span><span class="o">(</span><span class="nc">AqsNode</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="s">"thread"</span><span class="o">,</span> <span class="nc">Thread</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
                <span class="no">WAITSTATUS</span> <span class="o">=</span> <span class="n">l</span><span class="o">.</span><span class="na">findVarHandle</span><span class="o">(</span><span class="nc">AqsNode</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="s">"waitStatus"</span><span class="o">,</span> <span class="kt">int</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
            <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">ReflectiveOperationException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">throw</span> <span class="k">new</span> <span class="nf">ExceptionInInitializerError</span><span class="o">(</span><span class="n">e</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="nd">@Test</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">testCustomLock</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">InterruptedException</span> <span class="o">{</span>
        <span class="nc">Mutex</span> <span class="n">mutex</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Mutex</span><span class="o">();</span>
        <span class="nc">ExecutorService</span> <span class="n">executorService</span> <span class="o">=</span> <span class="nc">Executors</span><span class="o">.</span><span class="na">newFixedThreadPool</span><span class="o">(</span><span class="mi">5</span><span class="o">);</span>
        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
            <span class="n">executorService</span><span class="o">.</span><span class="na">execute</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="o">{</span>
                <span class="k">try</span> <span class="o">{</span>
                    <span class="kt">int</span> <span class="n">time</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Random</span><span class="o">().</span><span class="na">nextInt</span><span class="o">(</span><span class="mi">5000</span><span class="o">);</span>
                    <span class="n">mutex</span><span class="o">.</span><span class="na">lock</span><span class="o">();</span>
                    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">"thread=%d running time=%d%n"</span><span class="o">,</span>
                            <span class="nc">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">().</span><span class="na">getId</span><span class="o">(),</span> <span class="n">time</span><span class="o">);</span>
                    <span class="nc">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="n">time</span><span class="o">);</span>
                    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">"thread=%d finished%n"</span><span class="o">,</span>
                            <span class="nc">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">().</span><span class="na">getId</span><span class="o">());</span>
                <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                    <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
                <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
                    <span class="n">mutex</span><span class="o">.</span><span class="na">unlock</span><span class="o">();</span>

                <span class="o">}</span>
            <span class="o">});</span>
        <span class="o">}</span>
        <span class="n">executorService</span><span class="o">.</span><span class="na">shutdown</span><span class="o">();</span>
        <span class="k">while</span> <span class="o">(</span><span class="n">executorService</span><span class="o">.</span><span class="na">isTerminated</span><span class="o">())</span> <span class="o">{</span>
        <span class="o">}</span>
        <span class="nc">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="mi">50000</span><span class="o">);</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"All task were finished."</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>è¿è¡Œç»“æœæ˜¾ç¤ºï¼ŒæŒ‡å®šæ—¶åˆ»ï¼Œåªæœ‰ä¸€ä¸ªçº¿ç¨‹åœ¨è¿è¡Œã€‚</p>
</div>
<div class="paragraph">
<p>æŸ¥çœ‹ <code>AbstractQueuedSynchronizer</code> ç»§æ‰¿å…³ç³»å¯ä»¥çœ‹å‡ºï¼Œåœ¨ <code>ReentrantLock</code>ï¼Œ<code>ReentrantReadWriteLock</code> å’Œ <code>Semaphore</code> ä¸‰ä¸ªç±»ä¸­å®ç°äº†å…¬å¹³é”å’Œéå…¬å¹³é”ã€‚</p>
</div>
</div>
<div class="sect2">
<h3 id="_node_è¯¦è§£"><a class="anchor" href="#_node_è¯¦è§£"></a>43.3. <code>Node</code> è¯¦è§£</h3>
<div class="ulist">
<ul>
<li>
<p><code>waitStatus</code>ï¼šå½“å‰ <code>Node</code> çš„ç­‰å¾…çŠ¶æ€ï¼Œæœ‰äº”ä¸ªå¯é€‰å€¼ã€‚</p>
</li>
<li>
<p><code>prev</code>ï¼šå½“å‰ <code>Node</code> å®ä¾‹çš„å‰é©±èŠ‚ç‚¹å¼•ç”¨ã€‚</p>
</li>
<li>
<p><code>next</code>ï¼šå½“å‰ <code>Node</code> å®ä¾‹çš„åç»§èŠ‚ç‚¹å¼•ç”¨ã€‚</p>
</li>
<li>
<p><code>thread</code>ï¼šå½“å‰ <code>Node</code> å®ä¾‹æŒæœ‰çš„çº¿ç¨‹å®ä¾‹å¼•ç”¨ã€‚</p>
</li>
<li>
<p><code>nextWaiter</code>ï¼šè¿™ä¸ªå€¼æ˜¯ä¸€ä¸ªæ¯”è¾ƒå®¹æ˜“ä»¤äººç”Ÿç–‘çš„å€¼ï¼Œè™½ç„¶è¡¨é¢ä¸Šå®ƒç§°ä¸º"ä¸‹ä¸€ä¸ªç­‰å¾…çš„èŠ‚ç‚¹"ï¼Œä½†æ˜¯å®é™…ä¸Šå®ƒæœ‰ä¸‰ç§å–å€¼çš„æƒ…å†µã€‚</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>å€¼ä¸ºé™æ€å®ä¾‹ <code>Node.EXCLUSIVE</code>(ä¹Ÿå°±æ˜¯ <code>null</code>)ï¼Œä»£è¡¨å½“å‰çš„ <code>Node</code> å®ä¾‹æ˜¯ç‹¬å æ¨¡å¼ã€‚</p>
</li>
<li>
<p>å€¼ä¸ºé™æ€å®ä¾‹ <code>Node.SHARED</code>ï¼Œä»£è¡¨å½“å‰çš„ <code>Node</code> å®ä¾‹æ˜¯å…±äº«æ¨¡å¼ã€‚</p>
</li>
<li>
<p>å€¼ä¸ºé <code>Node.EXCLUSIVE</code> å’Œ <code>Node.SHARED</code> çš„å…¶ä»–èŠ‚ç‚¹å®ä¾‹ï¼Œä»£è¡¨ <code>Condition</code> ç­‰å¾…é˜Ÿåˆ—ä¸­å½“å‰èŠ‚ç‚¹çš„ä¸‹ä¸€ä¸ªç­‰å¾…èŠ‚ç‚¹ã€‚</p>
</li>
</ol>
</div>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_node_ä¸­ä¸€äº›å¸¸é‡å®šä¹‰"><a class="anchor" href="#_node_ä¸­ä¸€äº›å¸¸é‡å®šä¹‰"></a>43.3.1. <code>Node</code> ä¸­ä¸€äº›å¸¸é‡å®šä¹‰</h4>
<div class="paragraph">
<p>åŒºåˆ†å…±äº«é”è¿˜æ˜¯ç‹¬å å¼é”çš„å¸¸é‡ï¼Œæ˜¯å¦‚ä½•è¢«ä½¿ç”¨çš„ï¼Ÿç‹¬å é”ä¸ºä½•æ²¡æœ‰åˆå§‹åŒ–ï¼Ÿ</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>static final Node SHARED = new Node();</code></p>
</li>
<li>
<p><code>static final Node EXCLUSIVE = null;</code>&#8201;&#8212;&#8201;ä¸ºä½•æ²¡æœ‰è¢«åˆå§‹åŒ–ï¼Ÿ</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>å…±äº«é”çš„è¯ï¼Œå¤§å®¶ä½¿ç”¨åŒä¸€ä¸ª <code>Node</code> å®ä¾‹ï¼Œè€Œç‹¬è‡ªé”åˆ™æ˜¯æ¯ä¸ªä»»åŠ¡ä½¿ç”¨ä¸€ä¸ª <code>Node</code> å®ä¾‹ã€‚å¯ä»¥è¿™æ ·ç†è§£å—ï¼Ÿ</p>
</div>
<div class="paragraph">
<p>èŠ‚ç‚¹çš„çŠ¶æ€</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>static final int CANCELLED =  1;</code>&#8201;&#8212;&#8201;è¡¨ç¤ºå½“å‰çš„çº¿ç¨‹è¢«å–æ¶ˆï¼›</p>
</li>
<li>
<p><code>static final int SIGNAL    = -1;</code>&#8201;&#8212;&#8201;è¡¨ç¤ºå½“å‰èŠ‚ç‚¹çš„åç»§èŠ‚ç‚¹åŒ…å«çš„çº¿ç¨‹éœ€è¦è¿è¡Œï¼Œä¹Ÿå°±æ˜¯unparkï¼›</p>
</li>
<li>
<p><code>static final int CONDITION = -2;</code>&#8201;&#8212;&#8201;è¡¨ç¤ºå½“å‰èŠ‚ç‚¹åœ¨ç­‰å¾…conditionï¼Œä¹Ÿå°±æ˜¯åœ¨conditioné˜Ÿåˆ—ä¸­ï¼›</p>
</li>
<li>
<p><code>static final int PROPAGATE = -3;</code>&#8201;&#8212;&#8201;è¡¨ç¤ºå½“å‰åœºæ™¯ä¸‹åç»­çš„acquireSharedèƒ½å¤Ÿå¾—ä»¥æ‰§è¡Œï¼›</p>
</li>
<li>
<p><code>0</code>&#8201;&#8212;&#8201;è¡¨ç¤ºå½“å‰èŠ‚ç‚¹åœ¨syncé˜Ÿåˆ—ä¸­ï¼Œç­‰å¾…ç€è·å–é”ã€‚</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>æ¨¡æ¿æ–¹æ³•ï¼š</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>isHeldExclusively()</code>&#8201;&#8212;&#8201;è¯¥çº¿ç¨‹æ˜¯å¦æ­£åœ¨ç‹¬å èµ„æºã€‚åªæœ‰ç”¨åˆ°conditionæ‰éœ€è¦å»å®ç°å®ƒã€‚</p>
</li>
<li>
<p><code>tryAcquire(int)</code>&#8201;&#8212;&#8201;ç‹¬å æ–¹å¼ã€‚å°è¯•è·å–èµ„æºï¼ŒæˆåŠŸåˆ™è¿”å›trueï¼Œå¤±è´¥åˆ™è¿”å›falseã€‚</p>
</li>
<li>
<p><code>tryRelease(int)</code>&#8201;&#8212;&#8201;ç‹¬å æ–¹å¼ã€‚å°è¯•é‡Šæ”¾èµ„æºï¼ŒæˆåŠŸåˆ™è¿”å›trueï¼Œå¤±è´¥åˆ™è¿”å›falseã€‚</p>
</li>
<li>
<p><code>tryAcquireShared(int)</code>&#8201;&#8212;&#8201;å…±äº«æ–¹å¼ã€‚å°è¯•è·å–èµ„æºã€‚è´Ÿæ•°è¡¨ç¤ºå¤±è´¥ï¼›0è¡¨ç¤ºæˆåŠŸï¼Œä½†æ²¡æœ‰å‰©ä½™å¯ç”¨èµ„æºï¼›æ­£æ•°è¡¨ç¤ºæˆåŠŸï¼Œä¸”æœ‰å‰©ä½™èµ„æºã€‚</p>
</li>
<li>
<p><code>tryReleaseShared(int)</code>&#8201;&#8212;&#8201;å…±äº«æ–¹å¼ã€‚å°è¯•é‡Šæ”¾èµ„æºï¼ŒæˆåŠŸåˆ™è¿”å›trueï¼Œå¤±è´¥åˆ™è¿”å›falseã€‚</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ç‹¬å æ¨¡å¼"><a class="anchor" href="#_ç‹¬å æ¨¡å¼"></a>43.4. ç‹¬å æ¨¡å¼</h3>
<div class="paragraph">
<p>ç‹¬å æ¨¡å¼çš„åŒæ­¥å™¨çš„ä¸€ä¸ªæ˜¾è‘—ç‰¹ç‚¹å°±æ˜¯ï¼šå¤´èŠ‚ç‚¹çš„ç¬¬ä¸€ä¸ªæœ‰æ•ˆ(éå–æ¶ˆ)çš„åç»§èŠ‚ç‚¹ï¼Œæ€»æ˜¯å°è¯•è·å–èµ„æºï¼Œä¸€æ—¦è·å–èµ„æºæˆåŠŸå°±ä¼šè§£é™¤é˜»å¡å¹¶ä¸”æ™‹å‡ä¸ºå¤´èŠ‚ç‚¹ï¼ŒåŸæ¥æ‰€åœ¨èŠ‚ç‚¹ä¼šç§»é™¤å‡ºåŒæ­¥ç­‰å¾…é˜Ÿåˆ—ï¼ŒåŸæ¥çš„é˜Ÿåˆ—é•¿åº¦å°±ä¼šå‡å°‘1ï¼Œç„¶åå¤´ç»“ç‚¹çš„ç¬¬ä¸€ä¸ªæœ‰æ•ˆçš„åç»§èŠ‚ç‚¹ç»§ç»­å¼€å§‹ç«äº‰èµ„æºã€‚</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="java"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
</pre></td><td class="code"><pre>    <span class="cm">/**
     * Checks and updates status for a node that failed to acquire.
     * Returns true if thread should block. This is the main signal
     * control in all acquire loops.  Requires that pred == node.prev.
     *
     * @param pred node's predecessor holding status
     * @param node the node
     * @return {@code true} if thread should block
     */</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kt">boolean</span> <span class="nf">shouldParkAfterFailedAcquire</span><span class="o">(</span><span class="nc">Node</span> <span class="n">pred</span><span class="o">,</span> <span class="nc">Node</span> <span class="n">node</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// å¦‚æœå‰ä¸€ä¸ªèŠ‚ç‚¹å·²ç»åœ¨æ’é˜Ÿï¼Œåˆ™æ–°åŠ å…¥çš„èŠ‚ç‚¹å°±åº”è¯¥ park</span>
        <span class="kt">int</span> <span class="n">ws</span> <span class="o">=</span> <span class="n">pred</span><span class="o">.</span><span class="na">waitStatus</span><span class="o">;</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">ws</span> <span class="o">==</span> <span class="nc">Node</span><span class="o">.</span><span class="na">SIGNAL</span><span class="o">)</span>
            <span class="cm">/*
             * This node has already set status asking a release
             * to signal it, so it can safely park.
             */</span>
            <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
        <span class="c1">// å¦‚æœå‰ä¸€ä¸ªèŠ‚ç‚¹å·²ç»å–æ¶ˆï¼Œåˆ™åˆ é™¤å–æ¶ˆèŠ‚ç‚¹</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">ws</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
            <span class="cm">/*
             * Predecessor was cancelled. Skip over predecessors and
             * indicate retry.
             */</span>
            <span class="c1">// è·³è¿‡å·²ç»å–æ¶ˆçš„èŠ‚ç‚¹</span>
            <span class="k">do</span> <span class="o">{</span>
                <span class="n">node</span><span class="o">.</span><span class="na">prev</span> <span class="o">=</span> <span class="n">pred</span> <span class="o">=</span> <span class="n">pred</span><span class="o">.</span><span class="na">prev</span><span class="o">;</span>
            <span class="o">}</span> <span class="k">while</span> <span class="o">(</span><span class="n">pred</span><span class="o">.</span><span class="na">waitStatus</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">);</span>
            <span class="c1">// åŠ å…¥é˜Ÿåˆ—</span>
            <span class="n">pred</span><span class="o">.</span><span class="na">next</span> <span class="o">=</span> <span class="n">node</span><span class="o">;</span>
        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
            <span class="cm">/*
             * waitStatus must be 0 or PROPAGATE.  Indicate that we
             * need a signal, but don't park yet.  Caller will need to
             * retry to make sure it cannot acquire before parking.
             */</span>
            <span class="c1">// å¦‚æœå‰ä¸€ä¸ªèŠ‚ç‚¹æ²¡æœ‰å–æ¶ˆï¼Œåˆ™å°è¯•å°†å‰ä¸€ä¸ªèŠ‚ç‚¹è®¾ç½®ä¸º Node.SIGNAL</span>
            <span class="n">pred</span><span class="o">.</span><span class="na">compareAndSetWaitStatus</span><span class="o">(</span><span class="n">ws</span><span class="o">,</span> <span class="nc">Node</span><span class="o">.</span><span class="na">SIGNAL</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="cm">/**
     * Convenience method to interrupt current thread.
     */</span>
    <span class="kd">static</span> <span class="kt">void</span> <span class="nf">selfInterrupt</span><span class="o">()</span> <span class="o">{</span>
        <span class="nc">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">().</span><span class="na">interrupt</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="cm">/**
     * Convenience method to park and then check if interrupted.
     *
     * @return {@code true} if interrupted
     */</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="kt">boolean</span> <span class="nf">parkAndCheckInterrupt</span><span class="o">()</span> <span class="o">{</span>
        <span class="nc">LockSupport</span><span class="o">.</span><span class="na">park</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
        <span class="k">return</span> <span class="nc">Thread</span><span class="o">.</span><span class="na">interrupted</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="cm">/*
     * Various flavors of acquire, varying in exclusive/shared and
     * control modes.  Each is mostly the same, but annoyingly
     * different.  Only a little bit of factoring is possible due to
     * interactions of exception mechanics (including ensuring that we
     * cancel if tryAcquire throws exception) and other control, at
     * least not without hurting performance too much.
     */</span>

    <span class="cm">/**
     * Acquires in exclusive uninterruptible mode for thread already in
     * queue. Used by condition wait methods as well as acquire.
     *
     * @param node the node
     * @param arg the acquire argument
     * @return {@code true} if interrupted while waiting
     */</span>
    <span class="kd">final</span> <span class="kt">boolean</span> <span class="nf">acquireQueued</span><span class="o">(</span><span class="kd">final</span> <span class="nc">Node</span> <span class="n">node</span><span class="o">,</span> <span class="kt">int</span> <span class="n">arg</span><span class="o">)</span> <span class="o">{</span>
        <span class="kt">boolean</span> <span class="n">interrupted</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="k">for</span> <span class="o">(;;)</span> <span class="o">{</span>
                <span class="kd">final</span> <span class="nc">Node</span> <span class="n">p</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="na">predecessor</span><span class="o">();</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">p</span> <span class="o">==</span> <span class="n">head</span> <span class="o">&amp;&amp;</span> <span class="n">tryAcquire</span><span class="o">(</span><span class="n">arg</span><span class="o">))</span> <span class="o">{</span>
                    <span class="n">setHead</span><span class="o">(</span><span class="n">node</span><span class="o">);</span>
                    <span class="n">p</span><span class="o">.</span><span class="na">next</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span> <span class="c1">// help GC</span>
                    <span class="k">return</span> <span class="n">interrupted</span><span class="o">;</span>
                <span class="o">}</span>
                <span class="c1">// æ­¤æ—¶ node èŠ‚ç‚¹å·²ç»é€šè¿‡ addWaiter æ–¹æ³•åŠ å…¥åˆ°é˜Ÿåˆ—ä¸­</span>
                <span class="c1">// 1ã€å¦‚æœå‰ä¸€ä¸ªèŠ‚ç‚¹æ˜¯ SIGNALï¼Œåˆ™è¿”å› trueï¼Œpark è¯¥çº¿ç¨‹</span>
                <span class="c1">// 2.1 å¦‚æœå‰ä¸€ä¸ªèŠ‚ç‚¹å–æ¶ˆï¼Œåˆ™é€šè¿‡éå†å°†ä¹‹å‰çš„è¿ç»­çš„å–æ¶ˆèŠ‚ç‚¹å…¨éƒ¨åˆ é™¤ï¼Œ</span>
                <span class="c1">//     è¿”å› falseï¼Œå†æ¬¡è‡ªæ—‹å°è¯•è·å–é”</span>
                <span class="c1">// 2.2 å¦‚æœå‰ä¸€ä¸ªèŠ‚ç‚¹æ²¡æœ‰å–æ¶ˆï¼Œåˆ™å°†å‰ä¸€ä¸ªèŠ‚ç‚¹å°è¯•ä¿®æ”¹ä¸º SIGNALã€‚</span>
                <span class="c1">//     é‚£ä¹ˆä¸‹ä¸€æ¬¡å¾ªç¯æ—¶ï¼Œèµ°ç¬¬ä¸€ä¸ªåˆ¤æ–­ï¼Œè¿”å› trueï¼Œpark è¯¥çº¿ç¨‹ã€‚</span>
                <span class="c1">//     æˆ–è€…å‰é©±èŠ‚ç‚¹å·²ç»å¼¹å‡ºé˜Ÿåˆ—ï¼Œåˆ™è¯¥çº¿ç¨‹å°è¯•è·å–é”ã€‚</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">shouldParkAfterFailedAcquire</span><span class="o">(</span><span class="n">p</span><span class="o">,</span> <span class="n">node</span><span class="o">))</span>
                    <span class="n">interrupted</span> <span class="o">|=</span> <span class="n">parkAndCheckInterrupt</span><span class="o">();</span>
            <span class="o">}</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Throwable</span> <span class="n">t</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">cancelAcquire</span><span class="o">(</span><span class="n">node</span><span class="o">);</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">interrupted</span><span class="o">)</span>
                <span class="n">selfInterrupt</span><span class="o">();</span>
            <span class="k">throw</span> <span class="n">t</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>å¯ä»¥ç”»ä¸€ä¸‹æµç¨‹å›¾ï¼š</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>ä»¥ <code>ReentrantLock</code> ä¸ºä¾‹ï¼Œåœ¨ç‹¬å æ¨¡å¼ä¸‹ï¼Œè·å–é”çš„è¿‡ç¨‹</p>
</li>
<li>
<p>ä»¥ <code>ReentrantLock</code> ä¸ºä¾‹ï¼Œåœ¨ç‹¬å æ¨¡å¼ä¸‹ï¼Œé‡Šæ”¾é”çš„è¿‡ç¨‹</p>
</li>
<li>
<p>ä½¿ç”¨ <code>Condition</code> å¯¹è±¡ï¼Œ<code>await()</code> çš„è¿‡ç¨‹</p>
</li>
<li>
<p>ä½¿ç”¨ <code>Condition</code> å¯¹è±¡ï¼Œ<code>signal()</code> çš„è¿‡ç¨‹</p>
</li>
<li>
<p>ä»¥ <code>Semaphore</code> ä¸ºä¾‹ï¼Œåœ¨å…±äº«æ¨¡å¼ä¸‹ï¼Œè·å–é”çš„è¿‡ç¨‹</p>
</li>
<li>
<p>ä»¥ <code>Semaphore</code> ä¸ºä¾‹ï¼Œåœ¨å…±äº«æ¨¡å¼ä¸‹ï¼Œé‡Šæ”¾é”çš„è¿‡ç¨‹</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_å…±äº«æ¨¡å¼"><a class="anchor" href="#_å…±äº«æ¨¡å¼"></a>43.5. å…±äº«æ¨¡å¼</h3>
<div class="paragraph">
<p>å…±äº«æ¨¡å¼çš„åŒæ­¥å™¨çš„ä¸€ä¸ªæ˜¾è‘—ç‰¹ç‚¹å°±æ˜¯ï¼šå¤´èŠ‚ç‚¹çš„ç¬¬ä¸€ä¸ªæœ‰æ•ˆ(éå–æ¶ˆ)çš„åç»§èŠ‚ç‚¹ï¼Œæ€»æ˜¯å°è¯•è·å–èµ„æºï¼Œä¸€æ—¦è·å–èµ„æºæˆåŠŸå°±ä¼šè§£é™¤é˜»å¡å¹¶ä¸”æ™‹å‡ä¸ºå¤´èŠ‚ç‚¹ï¼ŒåŸæ¥æ‰€åœ¨èŠ‚ç‚¹ä¼šç§»é™¤å‡ºåŒæ­¥ç­‰å¾…é˜Ÿåˆ—ï¼ŒåŸæ¥çš„é˜Ÿåˆ—é•¿åº¦å°±ä¼šå‡å°‘1ï¼Œé‡æ–°è®¾ç½®å¤´èŠ‚ç‚¹çš„è¿‡ç¨‹ä¼šä¼ æ’­å”¤é†’çš„çŠ¶æ€ï¼Œç®€å•æ¥è¯´å°±æ˜¯å”¤é†’ä¸€ä¸ªæœ‰æ•ˆçš„åç»§èŠ‚ç‚¹ï¼Œåªè¦ä¸€ä¸ªèŠ‚ç‚¹å¯ä»¥æ™‹å‡ä¸ºå¤´èŠ‚ç‚¹ï¼Œå®ƒçš„åç»§èŠ‚ç‚¹å°±èƒ½è¢«å”¤é†’ã€‚èŠ‚ç‚¹çš„å”¤é†’é¡ºåºéµå¾ªç±»ä¼¼äºFIFOçš„åŸåˆ™ï¼Œé€šä¿—è¯´å°±æ˜¯å…ˆé˜»å¡æˆ–è€…é˜»å¡æ—¶é—´æœ€é•¿åˆ™å…ˆè¢«å”¤é†’ã€‚</p>
</div>
</div>
<div class="sect2">
<h3 id="_conditionobject"><a class="anchor" href="#_conditionobject"></a>43.6. <code>ConditionObject</code></h3>
<div class="paragraph">
<p>å…³äºè¿™æ®µä»£ç çš„ç ”ç©¶ï¼Œå¯ä»¥å‚çœ‹ <a href="#"><code>java.util.concurrent.ArrayBlockingQueue</code></a>ã€‚<code>ArrayBlockingQueue</code> åœ¨å®ç° <code>poll(long, java.util.concurrent.TimeUnit)</code> æ–¹æ³•æ—¶ï¼Œä½¿ç”¨äº† <code>Condition notEmpty</code> å¯¹è±¡æ¥è°ƒç”¨ <code>ConditionObject.awaitNanos(long)</code> æ–¹æ³•ã€‚</p>
</div>
</div>
<div class="sect2">
<h3 id="_å‚è€ƒèµ„æ–™_9"><a class="anchor" href="#_å‚è€ƒèµ„æ–™_9"></a>43.7. å‚è€ƒèµ„æ–™</h3>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
è®¿é—®ä¸€äº›é¡µé¢æ—¶å‘ç°ä¸€äº›é¡µé¢å·²ç»ä¸èƒ½è®¿é—®äº†ï¼Œåç»­å†æœç´¢è¡¥ä¸Šå§ã€‚
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="http://www.throwable.club/2019/04/07/java-juc-aqs-source-code/">JUCåŒæ­¥å™¨æ¡†æ¶AbstractQueuedSynchronizeræºç å›¾æ–‡åˆ†æ - Throwable&#8217;s Blog</a></p>
</li>
<li>
<p><a href="https://www.cnblogs.com/dennyzhangdd/p/7218510.html">ã€ŠThe java.util.concurrent Synchronizer Frameworkã€‹ JUCåŒæ­¥å™¨æ¡†æ¶ï¼ˆAQSæ¡†æ¶ï¼‰åŸæ–‡ç¿»è¯‘ - åªä¼šä¸€ç‚¹java - åšå®¢å›­</a></p>
</li>
<li>
<p><a href="https://www.cnblogs.com/waterystone/p/4920797.html">Javaå¹¶å‘ä¹‹AQSè¯¦è§£ - waterystone - åšå®¢å›­</a></p>
</li>
<li>
<p><a href="https://www.cnblogs.com/chengxiao/archive/2017/07/24/7141160.html">Javaå¹¶å‘åŒ…åŸºçŸ³-AQSè¯¦è§£ - dreamcatcher-cx - åšå®¢å›­</a></p>
</li>
<li>
<p><a href="http://www.cnblogs.com/leesf456/p/5350186.html">ã€JUCã€‘JDK1.8æºç åˆ†æä¹‹AbstractQueuedSynchronizerï¼ˆäºŒï¼‰ - leesf - åšå®¢å›­</a></p>
</li>
<li>
<p><a href="http://www.infoq.com/cn/articles/jdk1.8-abstractqueuedsynchronizer">æ·±åº¦è§£æJava 8ï¼šJDK1.8 AbstractQueuedSynchronizerçš„å®ç°åˆ†æï¼ˆä¸Šï¼‰</a></p>
</li>
<li>
<p><a href="http://www.infoq.com/cn/articles/java8-abstractqueuedsynchronizer">æ·±åº¦è§£æJava 8ï¼šAbstractQueuedSynchronizerçš„å®ç°åˆ†æï¼ˆä¸‹ï¼‰</a></p>
</li>
<li>
<p><a href="http://www.molotang.com/articles/480.html">Lockã€ReentrantLockå’ŒAbstractQueuedSynchronizerçš„æºç è¦ç‚¹åˆ†ææ•´ç† | ä¸‰çŸ³Â·é“</a></p>
</li>
<li>
<p><a href="http://zhanjindong.com/2015/03/10/java-concurrent-package-aqs-overview">Javaå¹¶å‘åŒ…æºç å­¦ä¹ ä¹‹AQSæ¡†æ¶ï¼ˆä¸€ï¼‰æ¦‚è¿° - Jindong Zhan</a></p>
</li>
<li>
<p><a href="http://zhanjindong.com/2015/03/11/java-concurrent-package-aqs-clh-and-spin-lock">Javaå¹¶å‘åŒ…æºç å­¦ä¹ ä¹‹AQSæ¡†æ¶ï¼ˆäºŒï¼‰CLH lock queueå’Œè‡ªæ—‹é” - Jindong Zhan</a></p>
</li>
<li>
<p><a href="http://zhanjindong.com/2015/03/14/java-concurrent-package-aqs-locksupport-and-thread-interrupt">Javaå¹¶å‘åŒ…æºç å­¦ä¹ ä¹‹AQSæ¡†æ¶ï¼ˆä¸‰ï¼‰LockSupportå’Œinterrupt - Jindong Zhan</a></p>
</li>
<li>
<p><a href="http://zhanjindong.com/2015/03/15/java-concurrent-package-aqs-AbstractQueuedSynchronizer">Javaå¹¶å‘åŒ…æºç å­¦ä¹ ä¹‹AQSæ¡†æ¶ï¼ˆå››ï¼‰AbstractQueuedSynchronizeræºç åˆ†æ - Jindong Zhan</a></p>
</li>
<li>
<p><a href="http://ifeve.com/introduce-abstractqueuedsynchronizer/">AbstractQueuedSynchronizerçš„ä»‹ç»å’ŒåŸç†åˆ†æ | å¹¶å‘ç¼–ç¨‹ç½‘ - ifeve.com</a></p>
</li>
<li>
<p><a href="http://coderbee.net/index.php/concurrent/20131209/614">JUC æºç åˆ†æ ä¸€ AbstractQueuedSynchronizer | ç èœ‚ç¬”è®°</a></p>
</li>
<li>
<p><a href="http://www.hiyangqi.com/java%20concurrency/java-concurrency-AQS.html">Java å¤šçº¿ç¨‹åŸºæœ¬å·¥å…·çš„åŸç†AQS</a></p>
</li>
<li>
<p><a href="http://www.tqcto.com/article/internet/5807.html">JUC æºç åˆ†æ 3 AbstractQueuedSynchronizer å…±äº«æ¨¡å¼ ä¸ CountDownLatch - äº’è”ç½‘ - çˆ±ä¸Šç¼–ç¨‹æŠ€æœ¯åšå®¢</a></p>
</li>
<li>
<p><a href="http://jiangwenfeng762.iteye.com/blog/1293814">é€šè¿‡CountDownLatchæ¥åˆ†æAbstractQueuedSynchronizerçš„æºç  - - ITeyeæŠ€æœ¯ç½‘ç«™</a></p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="paragraph nav-footer">
<p>â†Â Previous:Â <a href="java.util.concurrent.locks.LockSupport.html">LockSupport</a>Â | â†‘Â Up:Â <a href="index.html">JDK æºç åˆ†æ</a>Â | Next:Â <a href="java.util.concurrent.locks.ReentrantLock.html">ReentrantLock</a>Â â†’</p>
</div>
<script src="https://giscus.app/client.js" data-repo="diguage/jdk-source-analysis" data-repo-id="MDEwOlJlcG9zaXRvcnk3MjM5MzE5Mw==" data-category="General" data-category-id="MDE4OkRpc2N1c3Npb25DYXRlZ29yeTMyMDM2MDQx" data-mapping="og:title" data-strict="0" data-reactions-enabled="1" data-emit-metadata="1" data-input-position="top" data-theme="preferred_color_scheme" data-lang="zh-CN" data-loading="lazy" crossorigin="anonymous" async></script>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2025-11-25 13:40:54 UTC
</div>
</div>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  messageStyle: "none",
  tex2jax: {
    inlineMath: [["\\(", "\\)"]],
    displayMath: [["\\[", "\\]"]],
    ignoreClass: "nostem|nolatexmath"
  },
  asciimath2jax: {
    delimiters: [["\\$", "\\$"]],
    ignoreClass: "nostem|noasciimath"
  },
  TeX: { equationNumbers: { autoNumber: "none" } }
})
MathJax.Hub.Register.StartupHook("AsciiMath Jax Ready", function () {
  MathJax.InputJax.AsciiMath.postfilterHooks.Add(function (data, node) {
    if ((node = data.script.parentNode) && (node = node.parentNode) && node.classList.contains("stemblock")) {
      data.math.root.display = "block"
    }
    return data
  })
})
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/MathJax.js?config=TeX-MML-AM_CHTML"></script>
<script src="assets/scripts/asciidoctor-tabs.js"></script>
<script src="assets/scripts/scroll-toc.js"></script></body>
</html>